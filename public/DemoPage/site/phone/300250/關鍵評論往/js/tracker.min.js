!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var n=e();for(var o in n)("object"==typeof exports?exports:t)[o]=n[o]}}(this,function(){return function(t){function e(o){if(n[o])return n[o].exports;var i=n[o]={exports:{},id:o,loaded:!1};return t[o].call(i.exports,i,i.exports,e),i.loaded=!0,i.exports}var n={};return e.m=t,e.c=n,e.p="/",e(0)}([function(t,e,n){"use strict";function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}();n(1);var r=e.Tracker=function(){function t(e,n,i,r){if(o(this,t),this.trackerID=e,"string"!=typeof e)throw console.log("ERROR: NO TRACKER ID."),"no trackerID";this.pvTattoos=i||[],this.clickTattoos=n||[],this.impressionTattoos=r||[]}return i(t,null,[{key:"genID",value:function(){for(var t,e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),n=e,o=new Array(36),i=0,r=0;r<36;r++)8===r||13===r||18===r||23===r?o[r]="-":14===r?o[r]="4":(i<=2&&(i=33554432+16777216*Math.random()|0),t=15&i,i>>=4,o[r]=n[19===r?3&t|8:t]);return o.join("")}},{key:"createCookie",value:function(t,e,n){var o="";if(n){var i=new Date;i.setTime(i.getTime()+60*n*1e3),o="; expires="+i.toGMTString()}document.cookie=t+"="+e+o+"; path=/; domain=.thenewslens.com"}},{key:"getCookie",value:function(t){for(var e=t+"=",n=document.cookie.split(";"),o=0;o<n.length;o++){for(var i=n[o];" "===i.charAt(0);)i=i.substring(1);if(0===i.indexOf(e))return i.substring(e.length,i.length)}}},{key:"get_uf_id",value:function(){var e=t.cached_data.uf_last_time;e||(e=t.getCookie("uf_last_time"));var n=t.cached_data.uf_id;n||(n=t.getCookie("uf_id"));var o=(new Date).getTime();return t.cached_data.uf_last_time=o.toString(),t.createCookie("uf_last_time",t.cached_data.uf_last_time,60),e&&n&&(e=parseInt(e,10),o-e<18e5)?n:(n=t.genID(),t.cached_data.uf_id=n,t.createCookie("uf_id",n,60),n)}},{key:"get_uu_id",value:function(){var e=t.cached_data.ta_uuid;return e||(e=t.getCookie("ta_uuid")),e||(e=t.genID(),t.cached_data.ta_uuid=e),t.createCookie("ta_uuid",e,2628e3),e}},{key:"sendTrack",value:function(e,n){var o=window.location.host.split(".")[0];if(e.action+="."+o,e.url=window.location.href,e.uf_id=t.get_uf_id(),e.uu_id=t.get_uu_id(),e.ref=document.referrer,"_"==n[0]||"_"==e.action[0])return void console.log(e);var i=Object.keys(e).map(function(t){return t+"="+encodeURIComponent(e[t])}).join("&"),r=new XMLHttpRequest;r.open("GET","https://analytics.thenewslens.com/tattoo/"+n+"?"+i),r.send()}}]),i(t,[{key:"checkClickTattoos",value:function(t){this.clickTattoos.map(function(e){if(t.srcElement.matches(e[1])){if(e.length>2&&window.location.href.indexOf(e[2])==-1)return!1;var n={};return"function"==typeof e[3]&&(n=e[3](t.srcElement)),n.action=e[0],this.sendTrack(n),!0}return!1}.bind(this))}},{key:"checkPVTattoos",value:function(){this.pvTattoos.map(function(t){return window.location.href.indexOf(t[1])!=-1&&(!(t.length>2&&null==document.querySelector(t[2]))&&(this.sendTrack({action:t[0]}),!0))}.bind(this))}},{key:"subscribeImpression",value:function(){var t=0,e=this;e.sendTattoo={},e.addedObserver={},e.tattooFunc={},e.tattooNameDict={};var n=function(n,o){n.forEach(function(n){if(n.intersectionRatio>t){var o=JSON.parse(n.target.dataset.triggerIDs);o.forEach(function(t){var o=e.tattooNameDict[t],i={};"function"==typeof e.tattooFunc[t]&&(i=e.tattooFunc[t](n.target));var r=i.subname||"",s=i.layout||"",a=o+r+s;e.sendTattoo[a]||(e.sendTattoo[a]=!0,console.log("send tattoo impression",a),i.action=o,e.sendTrack(i))})}})},o=new IntersectionObserver(n,{threshold:[t]});e.impressionTattoos.forEach(function(t,n){var o=t[0]+"_"+n;e.addedObserver[o]=!1,e.tattooFunc[o]=t[3],e.tattooNameDict[o]=t[0]});var i=function(){e.impressionTattoos.forEach(function(t,n){var i=(t[0],t[0]+"_"+n),r=t[1];if(!e.addedObserver[i]){var s=document.querySelectorAll(r);0!=s.length&&(s.forEach(function(t){if(t.dataset.triggerIDs){var e=JSON.parse(t.dataset.triggerIDs);e.push(i),t.dataset.triggerIDs=JSON.stringify(e)}else t.dataset.triggerIDs=JSON.stringify([i]);o.observe(t)}),e.addedObserver[i]=!0)}})};i(),document.addEventListener("DOMNodeInserted",i)}},{key:"start",value:function(){document.addEventListener("click",this.checkClickTattoos.bind(this),!1),this.checkPVTattoos(),this.subscribeImpression()}},{key:"sendTrack",value:function(e){t.sendTrack(e,this.trackerID)}}]),t}();r.cached_data={uf_id:null,uf_last_time:null,ta_uuid:null}},function(t,e){!function(t,e){function n(t){this.time=t.time,this.rootBounds=t.rootBounds,this.boundingClientRect=t.boundingClientRect,this.intersectionRect=t.intersectionRect,this.target=t.target;var e=this.boundingClientRect,n=e.width*e.height,o=this.intersectionRect,i=o.width*o.height;this.intersectionRatio=n?i/n:0}function o(t,e){var n=e||{};if("function"!=typeof t)throw new Error("callback must be a function");if(n.root&&1!=n.root.nodeType)throw new Error("root must be an Element");this._checkForIntersections=r(this._checkForIntersections.bind(this),this.THROTTLE_TIMEOUT),this._callback=t,this._observationTargets=[],this._queuedEntries=[],this._rootMarginValues=this._parseRootMargin(n.rootMargin),this.thresholds=this._initThresholds(n.threshold),this.root=n.root||null,this.rootMargin=this._rootMarginValues.map(function(t){return t.value+t.unit}).join(" ")}function i(){return t.performance&&performance.now&&performance.now()}function r(t,e){var n=null;return function(){n||(n=setTimeout(function(){t(),n=null},e))}}function s(t,e,n,o){"function"==typeof t.addEventListener?t.addEventListener(e,n,o||!1):"function"==typeof t.attachEvent&&t.attachEvent(e,n)}function a(t,e,n,o){"function"==typeof t.removeEventListener?t.addEventListener(e,n,o||!1):"function"==typeof t.detatchEvent&&t.detatchEvent(e,n)}function c(t,e){var n=Math.max(t.top,e.top),o=Math.min(t.bottom,e.bottom),i=Math.max(t.left,e.left),r=Math.min(t.right,e.right),s=r-i,a=o-n;return s<0||a<0?f():{top:n,bottom:o,left:i,right:r,width:s,height:a}}function u(t){return t.top>0||t.bottom>0||t.left>0||t.right>0}function h(t){var e=t.getBoundingClientRect();if(e)return e.width&&e.height||(e={top:e.top,right:e.right,bottom:e.bottom,left:e.left,width:e.right-e.left,height:e.bottom-e.top}),e}function f(){return{top:0,bottom:0,left:0,right:0,width:0,height:0}}function l(t,e){for(var n=e.parentNode;n;){if(t==n)return!0;n=n.parentNode}}function d(t){return"[object Array]"==Object.prototype.toString.call(t)}if(!("IntersectionObserver"in t&&"IntersectionObserverEntry"in t&&"intersectionRatio"in t.IntersectionObserverEntry.prototype)){var p=[];o.prototype.THROTTLE_TIMEOUT=100,o.prototype.POLL_INTERVAL=null,o.prototype.observe=function(t){if(!this._observationTargets.some(function(e){return e.element==t})){if(!t||1!=t.nodeType)throw new Error("target must be an Element");this._registerInstance(),this._observationTargets.push({element:t,entry:null}),this._monitorIntersections()}},o.prototype.unobserve=function(t){this._observationTargets=this._observationTargets.filter(function(e){return e.element!=t}),this._observationTargets.length||(this._unmonitorIntersections(),this._unregisterInstance())},o.prototype.disconnect=function(){this._observationTargets=[],this._unmonitorIntersections(),this._unregisterInstance()},o.prototype.takeRecords=function(){var t=this._queuedEntries.slice();return this._queuedEntries=[],t},o.prototype._initThresholds=function(t){var e=t||[0];return d(e)||(e=[e]),e.sort().filter(function(t,e,n){if("number"!=typeof t||isNaN(t)||t<0||t>1)throw new Error("threshold must be a number between 0 and 1 inclusively");return t!==n[e-1]})},o.prototype._parseRootMargin=function(t){var e=t||"0px",n=e.split(/\s+/).map(function(t){var e=/^(-?\d*\.?\d+)(px|%)$/.exec(t);if(!e)throw new Error("rootMargin must be specified in pixels or percent");return{value:parseFloat(e[1]),unit:e[2]}});return n[1]=n[1]||n[0],n[2]=n[2]||n[0],n[3]=n[3]||n[1],n},o.prototype._monitorIntersections=function(){this._monitoringIntersections||(this._monitoringIntersections=!0,this._checkForIntersections(),this.POLL_INTERVAL?this._monitoringInterval=setInterval(this._checkForIntersections,this.POLL_INTERVAL):(s(t,"resize",this._checkForIntersections,!0),s(e,"scroll",this._checkForIntersections,!0),"MutationObserver"in t&&(this._domObserver=new MutationObserver(this._checkForIntersections),this._domObserver.observe(e,{attributes:!0,childList:!0,characterData:!0,subtree:!0}))))},o.prototype._unmonitorIntersections=function(){this._monitoringIntersections&&(this._monitoringIntersections=!1,clearInterval(this._monitoringInterval),this._monitoringInterval=null,a(t,"resize",this._checkForIntersections,!0),a(e,"scroll",this._checkForIntersections,!0),this._domObserver&&(this._domObserver.disconnect(),this._domObserver=null))},o.prototype._checkForIntersections=function(){var t=this._rootIsInDom(),e=t?this._getRootRect():f();this._observationTargets.forEach(function(o){var r=o.element,s=h(r),a=this._rootContainsTarget(r),c=o.entry,l=o.entry=new n({time:i(),target:r,boundingClientRect:s,rootBounds:e,intersectionRect:t&&a?this._computeTargetAndRootIntersection(r,e):f()});t&&a?this._hasCrossedThreshold(c,l)&&this._queuedEntries.push(l):c&&u(c.intersectionRect)&&this._queuedEntries.push(l)}.bind(this)),this._queuedEntries.length&&this._callback(this.takeRecords(),this)},o.prototype._computeTargetAndRootIntersection=function(e,n){for(var o=h(e),i=o,r=e.parentNode,s=!1;!s;){var a=null;if(r==this.root||1!=r.nodeType)s=!0,a=n;else{var f=t.getComputedStyle(r);"visible"!=f.overflow&&(a=h(r))}if(a&&(i=c(a,i),!u(i)))break;r=r.parentNode}return i},o.prototype._getRootRect=function(){var t;if(this.root)t=h(this.root);else{var n=e.documentElement,o=e.body;t={top:0,left:0,right:n.clientWidth||o.clientWidth,width:n.clientWidth||o.clientWidth,bottom:n.clientHeight||o.clientHeight,height:n.clientHeight||o.clientHeight}}return this._expandRectByRootMargin(t)},o.prototype._expandRectByRootMargin=function(t){var e=this._rootMarginValues.map(function(e,n){return"px"==e.unit?e.value:e.value*(n%2?t.width:t.height)/100}),n={top:t.top-e[0],right:t.right+e[1],bottom:t.bottom+e[2],left:t.left-e[3]};return n.width=n.right-n.left,n.height=n.bottom-n.top,n},o.prototype._hasCrossedThreshold=function(t,e){var n=t&&u(t.intersectionRect)?t.intersectionRatio||0:-1,o=u(e.intersectionRect)?e.intersectionRatio||0:-1;if(n!==o)for(var i=0;i<this.thresholds.length;i++){var r=this.thresholds[i];if(r==n||r==o||r<n!=r<o)return!0}},o.prototype._rootIsInDom=function(){return!this.root||l(e,this.root)},o.prototype._rootContainsTarget=function(t){return l(this.root||e,t)},o.prototype._registerInstance=function(){p.indexOf(this)<0&&p.push(this)},o.prototype._unregisterInstance=function(){p=p.filter(function(t){return t!==this}.bind(this))},t.IntersectionObserver=o,t.IntersectionObserverEntry=n}}(window,document)}])});