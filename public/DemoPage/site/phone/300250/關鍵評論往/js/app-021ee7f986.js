var tnlInfo={};!function(e){e.$=e.$||{},e.master=e.master||{},e.$={$document:$(document),$window:$(window),$body:$("body"),$canonical:null},e.$.$canonical=e.$.$document.find("#canonical-url-link"),e.variable={member:{tutorial_article_id:51338}};try{var n=$("#tnl_info").html()||"{}";tnlInfo=JSON.parse(n)}catch(e){console.log(e)}e.master={bind:function(){$.ajaxSetup({cache:!1,headers:{"X-CSRF-Token":$("meta[name=_token]").attr("content")},xhrFields:{withCredentials:!0}}),e.$.$document.on("click",".menu-btn, .menu-menuBtn",function(){$(".menu-btn").toggleClass("rotate-out"),$(".menu-menuBtn").toggleClass("menu-menuBtn-rotate"),$("#tnl-menu").fadeToggle(400)}),e.$.$document.on("scroll",function(){var e=$(window).scrollTop();e>50&&($(".top-zone").addClass("short-top-zone"),$(".menu-menuBtn").addClass("short-top-menuBtn")),e<50&&($(".top-zone").removeClass("short-top-zone"),$(".menu-menuBtn").removeClass("short-top-menuBtn"))}),e.$.$document.on("click",".select .placeholder",function(){var e=$(this).closest(".select");e.hasClass("is-open")?e.removeClass("is-open"):(e.addClass("is-open"),$(".select.is-open").not(e).removeClass("is-open"))}),e.$.$document.on("click",".select ul>li",function(){$(this).closest(".select").removeClass("is-open").find(".placeholder").text($(this).text())}),e.$.$document.on("mouseover",".select",function(){$(this).addClass("is-open")}),e.$.$document.on("mouseleave",".select",function(){$(this).removeClass("is-open")}),e.$.$document.on("keypress",".search-input",function(e){13==e.which&&window.open("/search?query="+$(this).val(),"_self")})}},e.$.$document.ready(function(){e.master.bind()})}("undefined"!=typeof Tnl?Tnl:this.Tnl={});
!function(t){t.Util=t.Util||{},t.Util={getImgSize:function(t,e){var n=new Image;n.onload=function(){var t=n.height,r=n.width,o={height:t,width:r};e&&e(o)},n.src=t},merge:function(e,n,r,o){var i,a=o||[],u=void 0===r?2:r,e=e||{};for(i in n)n.hasOwnProperty(i)&&t.Util.indexOf(a,i)<0&&("object"==typeof e[i]&&u?t.Util.merge(e[i],n[i],u-1,a):(e[i]=n[i],a.push(n[i])));return e},mixin:function(e,n){t.Util.merge(e.prototype,n.prototype)},indexOf:function(t,e,n){for(var r=t.length,n=n<0?n+r<0?0:n+r:n||0;n<r&&t[n]!==e;n++);return r<=n?-1:n},inArray:function(t,e){return!(void 0===t||"string"==typeof t&&"number"==typeof t||!this.isArray(e))&&e.indexOf(t)>=0},isArray:Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},isNumber:function(t){return!isNaN(t)},diffArray:function(t,e){var n=[];if(this.isArray(t)&&this.isArray(e))for(var r in t){var o=t[r];this.inArray(o,e)||n.push(o)}return n},splice:function(t,e){if(void 0!==t&&this.isArray(e)){var n=e.indexOf(t);n>=0&&e.splice(n,1)}return e},isObject:function(t){return"[object Object]"===Object.prototype.toString.call(t)},isEmptyObject:function(t){return 0===Object.keys(t).length&&t.constructor===Object},cloneObject:function(t){var e=this.isObject(t),n=this.isArray(t);return e||n?JSON.parse(JSON.stringify(t)):{}},ObjectSize:function(t){var e,n=0;for(e in t)t.hasOwnProperty(e)&&n++;return n},paddingLeft:function(t,e){return t.toString().length>=e?t:"0"+t},eventStop:function(t){return!!t&&(t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation(),!0)},convertFloatPercentFormat:function(t,e,n){n=n||100,e=e||2;var r=parseFloat(t)||0;return r*=n,r.toFixed(e)+" %"},uuid:function(){function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()},pointerEventToXY:function(t){var e={x:0,y:0};if("touchstart"==t.type||"touchmove"==t.type||"touchend"==t.type||"touchcancel"==t.type){var n=t.originalEvent.touches[0]||t.originalEvent.changedTouches[0];e.x=n.pageX,e.y=n.pageY}else"mousedown"!=t.type&&"mouseup"!=t.type&&"mousemove"!=t.type&&"mouseover"!=t.type&&"mouseout"!=t.type&&"mouseenter"!=t.type&&"mouseleave"!=t.type||(e.x=t.pageX,e.y=t.pageY);return e},sleep:function(t){for(var e=(new Date).getTime();e+t>=(new Date).getTime(););},forceRefreshInitScrollTop:function(){$(window).on("unload",function(){$(window).scrollTop(0)}),"scrollRestoration"in history&&(history.scrollRestoration="manual")},getArticleWordCount:function(t){function e(t){ret="";for(var n=t.childNodes.length,r=0;r<n;r++){var o=t.childNodes[r];8!=o.nodeType&&"SCRIPT"!==o.nodeName&&(ret+=1!=o.nodeType?o.nodeValue:e(o))}return ret}try{if(t=t||0,0===document.getElementsByClassName("article-content").length)return 0;var n=e(document.getElementsByClassName("article-content")[t]).replace(/(?:\r\n|\r|\n)/g,"");return(n.trim().match(/\w+/g)||[]).length+n.trim().replace(/\w+/g,"").split(" ").join("").length}catch(t){return console.log(t),0}}}}("undefined"!=typeof Tnl?Tnl:this.Tnl={});
!function(e){e.device=e.device||{},e.device={getDeviceType:function(){return e.$.$window.width()>=777?"desktops":"phones"}}}("undefined"!=typeof Tnl?Tnl:this.Tnl={});
!function(e){e.dom=e.dom||{},e.dom={resetHeight:function(n){if("desktops"==e.device.getDeviceType()){var o=$(n),t=o.map(function(){return $(this).height()}).get(),i=Math.max.apply(null,t),l="<style>"+n+"{height:"+i+"px}</style>";$("head").append(l)}},scrollTo:function(e,n,o){return e.animate({scrollTop:e.scrollTop()-e.offset().top+n.offset().top},void 0==o?1e3:o),this},scrollGuard:function(e){return e.on("wheel",function(e){var n=$(this);return e.originalEvent.deltaY<0?n.scrollTop()>0:n.scrollTop()+n.innerHeight()<n[0].scrollHeight}),this},stopScrollGuard:function(e){e.off("wheel")},disableScroll:function(){window.addEventListener&&window.addEventListener("DOMMouseScroll",e.dom.preventDefault,!1),window.onwheel=e.dom.preventDefault,window.onmousewheel=document.onmousewheel=e.dom.preventDefault,window.ontouchmove=e.dom.preventDefault,document.onkeydown=e.dom.preventDefaultForScrollKeys},preventDefault:function(e){e=e||window.event,e.preventDefault&&e.preventDefault(),e.returnValue=!1},preventDefaultForScrollKeys:function(n){if({37:1,38:1,39:1,40:1}[n.keyCode])return e.dom.preventDefault(n),!1},enableScroll:function(){window.removeEventListener&&window.removeEventListener("DOMMouseScroll",e.dom.preventDefault,!1),window.onmousewheel=document.onmousewheel=null,window.onwheel=null,window.ontouchmove=null,document.onkeydown=null},PopupCenter:function(e,n,o,t){var i=void 0!=window.screenLeft?window.screenLeft:screen.left,l=void 0!=window.screenTop?window.screenTop:screen.top;width=window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width,height=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height;var r=width/2-o/2+i,d=height/2-t/2+l,u=window.open(e,n,"scrollbars=yes, width="+o+", height="+t+", top="+d+", left="+r);return window.focus&&u.focus(),u},getBody:function(){return window.opera?"CSS1Compat"==document.compatMode?$("html"):$("body"):$("html,body")},isInFrame:function(){try{return window.self!==window.top}catch(e){return!0}}}}("undefined"!=typeof Tnl?Tnl:this.Tnl={});
!function(t){t.social=t.social||{},t.social={bind:function(){t.$.$document.on("click",".sharepopup",function(n){var i=$(this),a=i.attr("data-title"),e=i.attr("data-url"),o=i.attr("data-type"),c=i.attr("name");a=encodeURIComponent(a),e=encodeURIComponent(e),window.open("/sharepage?title="+a+"&url="+e+"&type="+o,c,"width=600,height=500,scrollbars=yes"),t.analytics.getInfo("share")})},init:function(){t.social.bind()}},t.social.init()}("undefined"!=typeof Tnl?Tnl:this.Tnl={});
!function(e){e.advertisement=e.advertisement||{};e.advertisement={dfp:{show:function(e){var g,t,a,o,i,l,n,s,d;t=e.slot_name,a=e.ad_size_list,n=e.ad_slot_id,s=e.add_size_list||[],o=e.target||[],i=o.tag||[],l=o.author||[],d=o.feature||"",googletag.cmd.push(function(){if(s.length){var e,o=googletag.sizeMapping();for(var r in s)s.hasOwnProperty(r)&&(e=s[r],o=o.addSize(e[0],e[1]));o=o.build(),g=googletag.defineSlot(t,a,n).defineSizeMapping(o).addService(googletag.pubads())}else g=googletag.defineSlot(t,a,n).addService(googletag.pubads());i.length&&(g=g.setTargeting("tag",i)),l.length&&(g=g.setTargeting("author",l)),d.length&&(g=g.setTargeting("feature",d)),googletag.pubads().enableSingleRequest(),googletag.pubads().collapseEmptyDivs(),googletag.enableServices(),googletag.display(n),googletag.pubads().refresh([g])})}}}}("undefined"!=typeof Tnl?Tnl:this.Tnl={});
!function(n){n.lazyLoading=n.lazyLoading||{},n.lazyLoading={init:function(){function t(){function t(t){t.forEach(function(t){if(t.intersectionRatio>0){var e=$(t.target);"desktops"!=n.device.getDeviceType()&&e.attr("src-sm")?e.attr("src",e.attr("src-sm")):e.attr("src",e.attr("src-lg")),o.unobserve(t.target)}})}var e=n.$.$document.find(".lazy_loading_container:not(.active.render) img");const i={rootMargin:"50px 0px",threshold:.01};var o=new IntersectionObserver(t,i);e.each(function(n,t){o.observe(t)})}t(),n.$.$document.ajaxSuccess(function(){t()})}},n.$.$document.ready(function(){n.lazyLoading.init()})}("undefined"!=typeof Tnl?Tnl:this.Tnl={});
!function(t){t.url=t.url||{},t.url=function(){},t.url.prototype={constructor:t.url,variable:{path:"",subDomain:"",domain:"",url:""},init:function(){var t,i,e;t=window.location.host.split("."),i=t[0],t.splice(0,1),e=t.join("."),this.variable.path=window.location.pathname,this.variable.subDomain=i,this.variable.domain=e},getAjaxUrl:function(){return this.variable.url="//api."+this.variable.domain+"/web/"+this.variable.subDomain+this.variable.path,sessionStorage.getItem("type")&&(this.variable.url+="/"+sessionStorage.getItem("type")),sessionStorage.getItem("type")&&sessionStorage.getItem("date")&&(this.variable.url+="/"+sessionStorage.getItem("date")),this.variable.url},getNotDomainAjaxUrl:function(){return this.variable.url="//api."+this.variable.domain+"/web"+this.variable.path,sessionStorage.getItem("type")&&(this.variable.url+="/"+sessionStorage.getItem("type")),sessionStorage.getItem("type")&&sessionStorage.getItem("date")&&(this.variable.url+="/"+sessionStorage.getItem("date")),this.variable.url},getApiDomainUrl:function(){return"//api."+this.variable.domain},getDomain:function(){return this.variable.domain},getSubDomain:function(){return this.variable.subDomain},getCookieDomain:function(){return"."+this.variable.domain}},t.url=new t.url,t.url.init()}("undefined"!=typeof Tnl?Tnl:this.Tnl={});
var TnlAnalyticsData;!function(t){t.analytics=t.analytics||{},t.analytics={variable:{parseLyCount:0,parseLyMaxCount:5,parseLyRequest:!1,parseLyFunction:[]},sendPreparationAnalytics:function(){if("thenewslens.com"!=t.url.getDomain())return!1;$.post("https://analytics.thenewslens.com/analytics",JSON.stringify({data:{agent:navigator.userAgent,platform:navigator.platform,host:window.location.host,path:window.location.pathname}})),t.analytics.getInfo("view")},sendEvent:function(t,e,a,i){try{ga("send","event",t,e,a,i,{nonInteraction:!0})}catch(t){console.log(t)}},sendMemberTrackPageView:function(t){try{ga("memberTracker.send","pageview",t),document.sendTrack({action:t})}catch(t){console.log(t)}},sendSignUpEvent:function(e,a,i){if("thenewslens.com"!=t.url.getDomain())return!1;i=i||"";var n={type:a,value:i,uid:e,uuid:TnlAnalyticsData.uuid,ssid:TnlAnalyticsData.ssid};$.post("https://analytics.thenewslens.com/signup",JSON.stringify({data:n}))},getInfo:function(e,a,i){e=e||"view",a=a||1;try{if(!i){var n=$("#tnl_info").html()||"{}";i=JSON.parse(n)}}catch(t){console.log(t)}a=a.toString(),window.url=function(){function t(t){return decodeURIComponent(t.replace(/\+/g," "))}function e(t,e){var a=t.charAt(0),i=e.split(a);return a===t?i:(t=parseInt(t.substring(1),10),i[0>t?i.length+t:t-1])}function a(e,a){for(var i=e.charAt(0),n=a.split("&"),o=[],r={},s=[],c=e.substring(1),l=0,u=n.length;u>l;l++)if(o=n[l].match(/(.*?)=(.*)/),o||(o=[n[l],n[l],""]),""!==o[1].replace(/\s/g,"")){if(o[2]=t(o[2]||""),c===o[1])return o[2];s=o[1].match(/(.*)\[([0-9]+)\]/),s?(r[s[1]]=r[s[1]]||[],r[s[1]][s[2]]=o[2]):r[o[1]]=o[2]}return i===e?r:r[c]}return function(t,i){var n,o={};if("tld?"!==t){if(i=i||window.location.toString(),!t)return i;if(t=t.toString(),n=i.match(/^mailto:([^\/].+)/))o.protocol="mailto",o.email=n[1];else{if((n=i.match(/(.*?)\/#\!(.*)/))&&(i=n[1]+n[2]),(n=i.match(/(.*?)#(.*)/))&&(o.hash=n[2],i=n[1]),o.hash&&t.match(/^#/))return a(t,o.hash);if((n=i.match(/(.*?)\?(.*)/))&&(o.query=n[2],i=n[1]),o.query&&t.match(/^\?/))return a(t,o.query);if((n=i.match(/(.*?)\:?\/\/(.*)/))&&(o.protocol=n[1].toLowerCase(),i=n[2]),(n=i.match(/(.*?)(\/.*)/))&&(o.path=n[2],i=n[1]),o.path=(o.path||"").replace(/^([^\/])/,"/$1").replace(/\/$/,""),t.match(/^[\-0-9]+$/)&&(t=t.replace(/^([^\/])/,"/$1")),t.match(/^\//))return e(t,o.path.substring(1));if(n=e("/-1",o.path.substring(1)),n&&(n=n.match(/(.*?)\.(.*)/))&&(o.file=n[0],o.filename=n[1],o.fileext=n[2]),(n=i.match(/(.*)\:([0-9]+)$/))&&(o.port=n[2],i=n[1]),(n=i.match(/(.*?)@(.*)/))&&(o.auth=n[1],i=n[2]),o.auth&&(n=o.auth.match(/(.*)\:(.*)/),o.user=n?n[1]:o.auth,o.pass=n?n[2]:void 0),o.hostname=i.toLowerCase(),"."===t.charAt(0))return e(t,o.hostname);o.port=o.port||("https"===o.protocol?"443":"80"),o.protocol=o.protocol||("443"===o.port?"https":"http")}return t in o?o[t]:"{}"===t?o:void 0}}}(),"undefined"!=typeof jQuery&&jQuery.extend({url:function(t,e){return window.url(t,e)}});var o=url("hostname"),r=document.title,s=document.referrer,c=document.referrer,l=""!=s?url("hostname",s):"",u=void 0===url("?utm_source")?"":url("?utm_source"),m=void 0===url("?utm_medium")?"":url("?utm_medium"),d=void 0===url("?utm_term")?"":url("?utm_term"),p=void 0===url("?utm_campaign")?"":url("?utm_campaign"),h=void 0===url("?utm_content")?"":url("?utm_content"),g="3";(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(navigator.userAgent)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(navigator.userAgent.substr(0,4)))&&(g="2");var v="0";switch(o){case"www.thenewslens.com":v="1";break;case"hk.thenewslens.com":v="2";break;case"international.thenewslens.com":v="3";break;case"asean.thenewslens.com":v="4"}var w="",y="",f="";void 0!==i&&(void 0!==i.post_type_id&&(w=i.post_type_id.toString()),void 0!==i.main_category_id&&(y=i.main_category_id.toString()),void 0!==i.page_id&&(f=i.page_id.toString()));var k=void 0===url("?q")?"":url("?q"),b=void 0===url("?query")?"":url("?query");l==o&&(s="",l="");var _="",x="";Cookies&&(_=Cookies.get("_thenewslens_analytic_ssid")||_,_||(_=t.Util.uuid(),Cookies.set("_thenewslens_analytic_ssid",_,{expires:.25,domain:t.url.getCookieDomain(),path:"/"})),x=Cookies.get("ta_uuid")||"",x.length||(x=t.Util.uuid(),x=x.toUpperCase(),Cookies.set("ta_uuid",x,{expires:2628e3,domain:t.url.getCookieDomain(),path:"/"})));var C={ssid:_,ta_uuid:x,hostname:o,title:r,ds:g,position:a,edition:v,type:w,act:e,cat:y,page_id:f,url:url(),ref_url:s,ref_host:l,preurl:c,utm_source:u,utm_medium:m,utm_campaign:p,utm_content:h,utm_term:d,kw_inside:b,kw_outside:k,agent:navigator.userAgent};if("thenewslens.com"!=t.url.getDomain())return console.log("追蹤資料：",C),!1;$.ajax({url:"//api.thenewslens.com/getSession",xhrFields:{withCredentials:!0},success:function(t){C.uuid=t.uuid,C.uid=t.uid,C.ip=t.ip,C.ssid||(C.ssid=t.ssid),TnlAnalyticsData=C,$.post("https://analytics.thenewslens.com/track",JSON.stringify({data:C}))}})},sendParseLyCallback:function(t){var e=this;try{t(),this.variable.parseLyCount=0}catch(a){if(this.variable.parseLyCount>this.variable.parseLyMaxCount)return this.variable.parseLyCount=0,!1;this.variable.parseLyCount++,setTimeout(function(){e.sendParseLyCallback(t)},3e3)}},sendGreedySnakeTrack:function(t,e,a){try{a=a||{};var i={};i.action=t,i=_.extend(i,a),Tracker.sendTrack(i,e)}catch(t){console.log(t)}}},t.analytics.sendPreparationAnalytics()}("undefined"!=typeof Tnl?Tnl:this.Tnl={});
!function(t){t.auth=t.auth||{},t.auth=function(){},t.auth.prototype={constructor:t.auth,$:{},variable:{login_type:"normal",member:{}},init:function(){this.$.actionItem=null,this.variable.member=JSON.parse($("meta[name='tnl:member']").attr("content")),this.bind()},bind:function(){var e=this;t.$.$document.on("click",".tnl-submit-btn:not(.disabled)",function(){$(this).parents("form").submit()}),t.$.$document.on("click",".login-modal",function(){e.variable.login_type="normal",e.fetchTemplate(function(){e.settingLoginModalInfo(),$.when(e.showLoginModal()).then(function(){e.$.signupModal.hide()})})}),t.$.$document.on("click","#tnl-login .member-remove",function(){e.$.loginModal.fadeOut(400)}),t.$.$document.on("click","#tnl-terms .member-remove",function(){e.$.termsModal.fadeOut(400)}),t.$.$document.on("click",".sign-up-modal",function(){e.fetchTemplate(function(){e.showSignupModal()})}),t.$.$document.on("click","#tnl-sign-up .member-remove",function(){e.fetchTemplate(function(){e.$.signupModal.fadeOut(400)})}),t.$.$document.on("click",".tnl-btn",function(){e.fetchTemplate(function(){$.when(e.showSignupModal()).then(function(){e.$.loginModal.hide()})})}),t.$.$document.on("click",".fb-sign-in-process-btn",function(){t.dom.PopupCenter("/auth/member/login/fb","Facebook Login","600","450")}),t.$.$document.on("click",".google-sign-in-process-btn",function(){t.dom.PopupCenter("/auth/member/login/google","Google Login","600","450")}),t.$.$document.on("click","#tnl-terms-check",function(t){$(this).is(":checked")?e.$.termsNext.removeClass("disabled"):e.$.termsNext.addClass("disabled")}),t.$.$document.on("click",".tnl-subscribe-article",function(t){e.variable.login_type="article";var n=$(this),i=n.data("id");n.prev(".tnl-subscribe-loader").length&&n.hide().prev(".tnl-subscribe-loader").fadeIn(300),n.hasClass("unscribe")?$.ajax({url:"/favorite/article/"+i,type:"POST",success:function(t){if(n.fadeIn(300).prev(".tnl-subscribe-loader").hide(),"error"==t.status)return e.$.actionItem=n,e.ajaxError(t),!1;if(n.removeClass("unscribe"),"article-top"==n.data("position"))n.find("span").text(n.data("unfollow")),n.parents(".article-zone").find("span.tnl-subscribe-article").removeClass("unscribe");else if("article-bottom"==n.data("position")){var i=n.parents(".article-zone").find("a.tnl-subscribe-article");i.removeClass("unscribe").find("span").text(i.data("unfollow"))}}}):$.ajax({url:"/favorite/article/"+i,type:"DELETE",success:function(t){if(n.fadeIn(300).prev(".tnl-subscribe-loader").hide(),"error"==t.status)return e.$.actionItem=n,e.ajaxError(t),!1;if(n.addClass("unscribe"),"article-top"==n.data("position"))n.find("span").text(n.data("follow")),n.parents(".article-zone").find("span.tnl-subscribe-article").addClass("unscribe");else if("article-bottom"==n.data("position")){var i=n.parents(".article-zone").find("a.tnl-subscribe-article");i.addClass("unscribe").find("span").text(i.data("follow"))}}})}),t.$.$document.on("click",".tnl-subscribe-author",function(t){e.variable.login_type="author";var n=$(this),i=n.data("id");n.prev(".tnl-subscribe-loader").length&&n.hide().prev(".tnl-subscribe-loader").fadeIn(300),n.hasClass("unfollow-author")?$.ajax({url:"/favorite/author/"+i,type:"POST",success:function(t){if(n.fadeIn(300).prev(".tnl-subscribe-loader").hide(),"error"==t.status)return e.$.actionItem=n,e.ajaxError(t),!1;if(n.removeClass("unfollow-author"),"article-top"==n.data("position"))n.find("span").text(n.data("unfollow")),n.parents(".article-zone").find("span.tnl-subscribe-author").removeClass("unfollow-author");else if("article-bottom"==n.data("position")){var i=n.parents(".article-zone").find("a.tnl-subscribe-author");i.removeClass("unfollow-author").find("span").text(i.data("unfollow"))}}}):$.ajax({url:"/favorite/author/"+i,type:"DELETE",success:function(t){if(n.fadeIn(300).prev(".tnl-subscribe-loader").hide(),"error"==t.status)return e.$.actionItem=n,e.ajaxError(t),!1;if(n.addClass("unfollow-author"),"article-top"==n.data("position"))n.find("span").text(n.data("follow")),n.parents(".article-zone").find("span.tnl-subscribe-author").addClass("unfollow-author");else if("article-bottom"==n.data("position")){var i=n.parents(".article-zone").find("a.tnl-subscribe-author");i.addClass("unfollow-author").find("span").text(i.data("follow"))}}})}),t.$.$document.on("click","#tnl-terms-return",function(t){e.$.termsModal.fadeOut(400)}),t.$.$document.on("click","#tnl-terms-next",function(t){var n=$(this);if(n.hasClass("disabled"))return!1;n.parent().find(".tnl-terms-loader").fadeIn(300),$.ajax({url:"/auth/member/agree/privacy",type:"POST",success:function(t){if(n.parent().find(".tnl-terms-loader").fadeOut(300),"error"==t.status)return!1;e.registerPrivacy()},error:function(t){console.log(t)}})}),t.$.$document.on("click","#tnl-register-return, #tnl-register-go-further, #tnl-register-privacy .member-remove",function(n){if("tnl-register-go-further"!=$(this).attr("id")){if(null!=e.$.actionItem){var i=e.$.actionItem.data("id"),a=e.variable.login_type;t.analytics.sendSignUpEvent(e.variable.member.id,a,i),e.$.actionItem.trigger("click")}else t.analytics.sendSignUpEvent(e.variable.member.id,"normal");e.$.registerPrivacyModal.fadeOut(400)}else if(null!=e.$.actionItem){var i=e.$.actionItem.data("id"),a=e.variable.login_type;$.when(t.analytics.sendSignUpEvent(e.variable.member.id,a,i)).then(function(){$.ajax({url:"/favorite/"+a+"/"+i,type:"POST",success:function(t){if("error"==t.status)return!1;window.location.href="https://www.thenewslens.com/article/51338"}})})}else t.analytics.sendSignUpEvent(e.variable.member.id,"normal"),window.location.href="https://www.thenewslens.com/article/51338"}),t.$.$document.on("submit","#tnl-sign-up-form",function(n){t.Util.eventStop(n);var i=$(this);i.find(".tnl-sign-up-loader").fadeIn(300),$.ajax({url:i.attr("action"),method:i.attr("method"),data:{full_name:i.find("input[name='full-name']").val(),email:i.find("input[name='email']").val(),password:i.find("input[name='password']").val(),password_confirmation:i.find("input[name='password-confirmation']").val()},success:function(t){if(i.find(".tnl-sign-up-loader").fadeOut(300),"error"==t.status)return e.signupFail(t),!1;e.login(t)}})}),t.$.$document.on("submit","#tnl-login-form",function(n){t.Util.eventStop(n);var i=$(this);i.find(".tnl-login-loader").fadeIn(300),$.ajax({url:i.attr("action"),method:i.attr("method"),data:{email:i.find("input[name='email']").val(),password:i.find("input[name='password']").val()},success:function(t){if(i.find(".tnl-login-loader").fadeOut(300),"error"==t.status)return e.loginFail(t),!1;e.login(t)}})}),t.$.$document.on("click",".tnl-resend-confirmation",function(n){t.Util.eventStop(n);var i=$(this);e.$.registerEmailVerifyError.find(".tnl-register-email-verify-loader").fadeIn(300),i.parent().hide(),$.ajax({url:"/auth/member/confirmation/resend",method:"POST",success:function(t){if(e.$.registerEmailVerifyError.find(".tnl-register-email-verify-loader").fadeOut(300),i.parent().show(),"error"==t.status)return e.ajaxError(t),!1;e.$.registerEmailVerifyError.find("p:eq(0)").text(t.message)}})}),window.addEventListener("message",function(n){~n.origin.indexOf(t.url.variable.domain)&&("login_success"==n.data.status&&e.login(n.data),"login_error"==n.data.status&&e.loginFail(n.data))})},ajaxError:function(t){var e=t.error_code,n=this;switch(e){case 100001002:n.fetchTemplate(function(){n.settingLoginModalInfo(),n.showLoginModal()});break;case 100001004:n.fetchTemplate(function(){this.showTermsModal()})}},fetchTemplate:function(e){var n=this;this.$.loginModal?e&&e():t.API.Setting.Template.getTemplate("member-login",function(i){i&&i.result&&i.result.view&&(t.$.$body.append(i.result.view),n.$.registerEmailVerifyError=t.$.$document.find("#tnl-register-email-verify-error"),n.$.registerPrivacyModal=t.$.$document.find("#tnl-register-privacy"),n.$.loginModal=t.$.$document.find("#tnl-login"),n.$.loginError=t.$.$document.find("#tnl-login-error"),n.$.loginRightTop=t.$.$document.find("#tnl-login-right-top"),n.$.loginHamburger=t.$.$document.find("#tnl-login-hamburger"),n.$.loginMobileHamburger=t.$.$document.find("#tnl-login-mobile-hamburger"),n.$.signupModal=t.$.$document.find("#tnl-sign-up"),n.$.signupError=t.$.$document.find("#tnl-sign-up-error"),n.$.termsModal=t.$.$document.find("#tnl-terms"),n.$.termsReturn=t.$.$document.find("#tnl-terms-return"),n.$.termsNext=t.$.$document.find("#tnl-terms-next"),n.$.registerRegisterReturn=t.$.$document.find("#tnl-register-return"),n.$.registerGoFurther=t.$.$document.find("#tnl-register-go-further")),e&&e()})},registerPrivacy:function(){var t=this,e=t.$.registerPrivacyModal.find("h1");e.text(e.data(t.variable.login_type)),"Y"!=t.variable.member.email_verify_status&&t.$.registerEmailVerifyError.show(),$.when(t.showSuccessModal()).then(function(){t.$.termsModal.hide()})},terms:function(){var t=this;$.when(t.showTermsModal()).then(function(){t.$.loginModal.hide(),t.$.signupModal.hide()})},storeMemberInfo:function(t){this.variable.member=t},login:function(e){var n=e.member;console.log(e),this.storeMemberInfo(n),this.$.loginRightTop.html('<a href="/favorite/article"><li style="color:#fff;">'+n.full_name+'</li></a><li> | </li><a href="/auth/member/logout"><li style="color:#fff;">'+e.translation.logout+"</li></a>"),this.$.loginHamburger.html('<a href="/favorite/article"><li>'+n.full_name+'</li></a><li> | </li><a href="/auth/member/logout"><li>'+e.translation.logout+"</li></a>"),this.$.loginMobileHamburger.html('<a href="/favorite/article"><li><img src="'+n.avatar+'" alt=""></li><li>'+n.full_name+'</li></a><a href="/auth/member/logout"><li style="padding-left:10px;">'+e.translation.logout+"</li></a>"),"Y"!=this.variable.member.privacy_status?this.terms():(null!=this.$.actionItem&&this.$.actionItem.trigger("click"),this.$.loginModal.fadeOut(400),this.$.signupModal.fadeOut(400)),void 0!==t.subscribe.changeEmail&&t.subscribe.changeEmail(e.email)},loginFail:function(t){console.log(t),this.$.loginModal.is(":visible")?(this.$.loginError.find("ul li").text(t.error_message),this.$.loginError.show()):this.$.signupModal.is(":visible")&&(this.$.signupError.find("ul li").text(t.error_message),this.$.signupError.show())},settingLoginModalInfo:function(){var t=this.$.loginModal.find("h1");t.text(t.data(this.variable.login_type));var e=this.$.loginModal.find("p.tnl-login-message"),n=this.$.loginError.find("ul li");"normal"!=this.variable.login_type?(this.$.loginModal.find(".fa-check").show(),n.text(n.data(this.variable.login_type)),e.text(""),this.$.loginError.show()):(this.$.loginModal.find(".fa-check").hide(),e.text(e.data(this.variable.login_type)),n.text(""),this.$.loginError.hide())},signupFail:function(t){console.log(t),this.$.signupError.find("ul li").text(t.error_message),this.$.signupError.show()},showLoginModal:function(){this.$.loginModal.fadeIn(400)},showSignupModal:function(){this.$.signupModal.fadeIn(400)},showTermsModal:function(){this.$.termsModal.fadeIn(400)},showSuccessModal:function(){this.$.registerPrivacyModal.fadeIn(400)}},t.$.$document.ready(function(){t.auth=new t.auth,t.auth.init()})}("undefined"!=typeof Tnl?Tnl:this.Tnl={});
!function t(e,i,n){function s(o,a){if(!i[o]){if(!e[o]){var l="function"==typeof require&&require;if(!a&&l)return l(o,!0);if(r)return r(o,!0);var h=new Error("Cannot find module '"+o+"'");throw h.code="MODULE_NOT_FOUND",h}var c=i[o]={exports:{}};e[o][0].call(c.exports,function(t){var i=e[o][1][t];return s(i||t)},c,c.exports,t,e,i,n)}return i[o].exports}for(var r="function"==typeof require&&require,o=0;o<n.length;o++)s(n[o]);return s}({1:[function(t,e,i){e.exports={VERSION:"1.0.0",DEV_ID:"i5iSjo",VERSION_PARAM:"&_av",USAGE_PARAM:"&_au",NULL_DIMENSION:"(not set)"}},{}],2:[function(t,e,i){function n(){console.error("Warning! Requiring the `autotrack` plugin no longer requires  all sub-plugins by default.\nSee https://goo.gl/XsXPg5 for details.")}t("../provide")("autotrack",n)},{"../provide":12}],3:[function(t,e,i){function n(t,e){l.track(t,l.plugins.CLEAN_URL_TRACKER),this.opts=s({stripQuery:!1,queryDimensionIndex:null,indexFilename:null,trailingSlash:null},e),this.tracker=t,this.overrideTrackerBuildHitTask()}var s=t("object-assign"),r=t("dom-utils/lib/parse-url"),o=t("../constants"),a=t("../provide"),l=t("../usage");n.prototype.cleanUrlTask=function(t){var e=t.get("location"),i=t.get("page"),n=r(i||e),s=n.pathname,a=s;if(this.opts.indexFilename){var l=a.split("/");this.opts.indexFilename==l[l.length-1]&&(l[l.length-1]="",a=l.join("/"))}if("remove"==this.opts.trailingSlash)a=a.replace(/\/+$/,"");else if("add"==this.opts.trailingSlash){var h=/\.\w+$/.test(a);h||"/"==a.substr(-1)||(a+="/")}this.opts.stripQuery&&this.opts.queryDimensionIndex&&t.set("dimension"+this.opts.queryDimensionIndex,n.query||o.NULL_DIMENSION),t.set("page",a+(this.opts.stripQuery?"":n.search))},n.prototype.overrideTrackerBuildHitTask=function(){this.originalTrackerBuildHitTask=this.tracker.get("buildHitTask"),this.tracker.set("buildHitTask",function(t){this.cleanUrlTask(t),this.originalTrackerBuildHitTask(t)}.bind(this))},n.prototype.remove=function(){this.tracker.set("sendHitTask",this.originalTrackerSendHitTask)},a("cleanUrlTracker",n)},{"../constants":1,"../provide":12,"../usage":13,"dom-utils/lib/parse-url":22,"object-assign":23}],4:[function(t,e,i){function n(t,e){if(a.track(t,a.plugins.EVENT_TRACKER),window.addEventListener){this.opts=s({events:["click"],fieldsObj:{},attributePrefix:"ga-",hitFilter:null},e),this.tracker=t,this.handleEvents=this.handleEvents.bind(this);var i="["+this.opts.attributePrefix+"on]";this.delegates={},this.opts.events.forEach(function(t){this.delegates[t]=r(document,t,i,this.handleEvents,{composed:!0,useCapture:!0})}.bind(this))}}var s=t("object-assign"),r=t("dom-utils/lib/delegate"),o=t("../provide"),a=t("../usage"),l=t("../utilities").createFieldsObj,h=t("../utilities").getAttributeFields;n.prototype.handleEvents=function(t,e){var i=this.opts.attributePrefix;if(t.type==e.getAttribute(i+"on")){var n={transport:"beacon"},r=h(e,i),o=s({},this.opts.fieldsObj,r),a=r.hitType||"event";this.tracker.send(a,l(n,o,this.tracker,this.opts.hitFilter,e))}},n.prototype.remove=function(){Object.keys(this.delegates).forEach(function(t){this.delegates[t].destroy()}.bind(this))},o("eventTracker",n)},{"../provide":12,"../usage":13,"../utilities":14,"dom-utils/lib/delegate":18,"object-assign":23}],5:[function(t,e,i){function n(t,e){l.track(t,l.plugins.IMPRESSION_TRACKER),window.IntersectionObserver&&window.MutationObserver&&(this.opts=o({elements:null,rootMargin:"0px",fieldsObj:{},attributePrefix:"ga-",hitFilter:null},e),this.tracker=t,this.handleDomMutations=this.handleDomMutations.bind(this),this.handleIntersectionChanges=this.handleIntersectionChanges.bind(this),this.handleDomElementAdded=this.handleDomElementAdded.bind(this),this.handleDomElementRemoved=this.handleDomElementRemoved.bind(this),this.items=[],this.elementMap={},this.thresholdMap={},c(function(){this.observeElements(this.opts.elements)}.bind(this)))}function s(t,e){if(0===t){var i=e.intersectionRect;return i.top>0||i.bottom>0||i.left>0||i.right>0}return e.intersectionRatio>=t}function r(t){return o({threshold:0,trackFirstImpressionOnly:!0},"string"==typeof t?{id:t}:t)}var o=t("object-assign"),a=t("../provide"),l=t("../usage"),h=t("../utilities").createFieldsObj,c=t("../utilities").domReady,d=t("../utilities").getAttributeFields;n.prototype.observeElements=function(t){var e=this.deriveDataFromElements(t);this.items=this.items.concat(e.items),this.elementMap=o({},e.elementMap,this.elementMap),this.thresholdMap=o({},e.thresholdMap,this.thresholdMap),e.items.forEach(function(t){var e=this.thresholdMap[t.threshold]=this.thresholdMap[t.threshold]||new IntersectionObserver(this.handleIntersectionChanges,{rootMargin:this.opts.rootMargin,threshold:[+t.threshold]}),i=this.elementMap[t.id]||(this.elementMap[t.id]=document.getElementById(t.id));i&&e.observe(i)}.bind(this)),this.mutationObserver||(this.mutationObserver=new MutationObserver(this.handleDomMutations),this.mutationObserver.observe(document.body,{childList:!0,subtree:!0})),requestAnimationFrame(function(){})},n.prototype.unobserveElements=function(t){var e=[],i=[];if(this.items.forEach(function(n){t.some(function(t){var e=r(t);return e.id===n.id&&e.threshold===n.threshold&&e.trackFirstImpressionOnly===n.trackFirstImpressionOnly})?i.push(n):e.push(n)}),!e.length)return this.unobserveAllElements();var n=this.deriveDataFromElements(e),s=this.deriveDataFromElements(i);this.items=n.items,this.elementMap=n.elementMap,this.thresholdMap=n.thresholdMap,i.forEach(function(t){if(!n.elementMap[t.id]){var e=s.thresholdMap[t.threshold],i=s.elementMap[t.id];i&&e.unobserve(i),n.thresholdMap[t.threshold]||s.thresholdMap[t.threshold].disconnect()}})},n.prototype.unobserveAllElements=function(){Object.keys(this.thresholdMap).forEach(function(t){this.thresholdMap[t].disconnect()}.bind(this)),this.mutationObserver.disconnect(),this.mutationObserver=null,this.items=[],this.elementMap={},this.thresholdMap={}},n.prototype.deriveDataFromElements=function(t){var e=[],i={},n={};return t.length&&t.forEach(function(t){var s=r(t);e.push(s),n[s.id]=this.elementMap[s.id]||null,i[s.threshold]=this.thresholdMap[s.threshold]||null}.bind(this)),{items:e,elementMap:n,thresholdMap:i}},n.prototype.observeElement=function(t){var e=this.elementMap[t]||(this.elementMap[t]=document.getElementById(t));e&&this.intersectionObserver.observe(e)},n.prototype.handleDomMutations=function(t){for(var e,i=0;e=t[i];i++){for(var n,s=0;n=e.removedNodes[s];s++)this.walkNodeTree(n,this.handleDomElementRemoved);for(var r,o=0;r=e.addedNodes[o];o++)this.walkNodeTree(r,this.handleDomElementAdded)}},n.prototype.walkNodeTree=function(t,e){1==t.nodeType&&t.id in this.elementMap&&e(t.id);for(var i,n=0;i=t.childNodes[n];n++)this.walkNodeTree(i,e)},n.prototype.handleIntersectionChanges=function(t){for(var e,i=[],n=0;e=t[n];n++)for(var r,o=0;r=this.items[o];o++)e.target.id===r.id&&s(r.threshold,e)&&(this.handleImpression(r.id),r.trackFirstImpressionOnly&&i.push(r));i.length&&this.unobserveElements(i)},n.prototype.handleImpression=function(t){var e=document.getElementById(t),i={transport:"beacon",eventCategory:"Viewport",eventAction:"impression",eventLabel:t},n=o({},this.opts.fieldsObj,d(e,this.opts.attributePrefix));this.tracker.send("event",h(i,n,this.tracker,this.opts.hitFilter,e))},n.prototype.handleDomElementAdded=function(t){var e=this.elementMap[t]=document.getElementById(t);this.items.forEach(function(i){t==i.id&&this.thresholdMap[i.threshold].observe(e)}.bind(this))},n.prototype.handleDomElementRemoved=function(t){var e=this.elementMap[t];this.items.forEach(function(i){t==i.id&&this.thresholdMap[i.threshold].unobserve(e)}.bind(this)),this.elementMap[t]=null},n.prototype.remove=function(){this.unobserveAllElements()},a("impressionTracker",n)},{"../provide":12,"../usage":13,"../utilities":14,"object-assign":23}],6:[function(t,e,i){function n(t,e){h.track(t,h.plugins.MEDIA_QUERY_TRACKER),window.matchMedia&&(this.opts=r({definitions:null,changeTemplate:this.changeTemplate,changeTimeout:1e3,fieldsObj:{},hitFilter:null},e),d(this.opts.definitions)&&(this.opts.definitions=u(this.opts.definitions),this.tracker=t,this.changeListeners=[],this.processMediaQueries()))}function s(t){return p[t]?p[t]:(p[t]=window.matchMedia(t),p[t])}var r=t("object-assign"),o=t("debounce"),a=t("../constants"),l=t("../provide"),h=t("../usage"),c=t("../utilities").createFieldsObj,d=t("../utilities").isObject,u=t("../utilities").toArray,p={};n.prototype.processMediaQueries=function(){this.opts.definitions.forEach(function(t){if(t.name&&t.dimensionIndex){var e=this.getMatchName(t);this.tracker.set("dimension"+t.dimensionIndex,e),this.addChangeListeners(t)}}.bind(this))},n.prototype.getMatchName=function(t){var e;return t.items.forEach(function(t){s(t.media).matches&&(e=t)}),e?e.name:a.NULL_DIMENSION},n.prototype.addChangeListeners=function(t){t.items.forEach(function(e){var i=s(e.media),n=o(function(){this.handleChanges(t)}.bind(this),this.opts.changeTimeout);i.addListener(n),this.changeListeners.push({mql:i,fn:n})}.bind(this))},n.prototype.handleChanges=function(t){var e=this.getMatchName(t),i=this.tracker.get("dimension"+t.dimensionIndex);if(e!==i){this.tracker.set("dimension"+t.dimensionIndex,e);var n={eventCategory:t.name,eventAction:"change",eventLabel:this.opts.changeTemplate(i,e)};this.tracker.send("event",c(n,this.opts.fieldsObj,this.tracker,this.opts.hitFilter))}},n.prototype.remove=function(){for(var t,e=0;t=this.changeListeners[e];e++)t.mql.removeListener(t.fn)},n.prototype.changeTemplate=function(t,e){return t+" => "+e},l("mediaQueryTracker",n)},{"../constants":1,"../provide":12,"../usage":13,"../utilities":14,debounce:16,"object-assign":23}],7:[function(t,e,i){function n(t,e){l.track(t,l.plugins.OUTBOUND_FORM_TRACKER),window.addEventListener&&(this.opts=s({formSelector:"form",shouldTrackOutboundForm:this.shouldTrackOutboundForm,fieldsObj:{},attributePrefix:"ga-",hitFilter:null},e),this.tracker=t,this.delegate=r(document,"submit","form",this.handleFormSubmits.bind(this),{composed:!0,useCapture:!0}))}var s=t("object-assign"),r=t("dom-utils/lib/delegate"),o=t("dom-utils/lib/parse-url"),a=t("../provide"),l=t("../usage"),h=t("../utilities").createFieldsObj,c=t("../utilities").getAttributeFields,d=t("../utilities").withTimeout;n.prototype.handleFormSubmits=function(t,e){var i=o(e.action).href,n={transport:"beacon",eventCategory:"Outbound Form",eventAction:"submit",eventLabel:i};if(this.opts.shouldTrackOutboundForm(e,o)){navigator.sendBeacon||(t.preventDefault(),n.hitCallback=d(function(){e.submit()}));var r=s({},this.opts.fieldsObj,c(e,this.opts.attributePrefix));this.tracker.send("event",h(n,r,this.tracker,this.opts.hitFilter,e))}},n.prototype.shouldTrackOutboundForm=function(t,e){var i=e(t.action);return i.hostname!=location.hostname&&"http"==i.protocol.slice(0,4)},n.prototype.remove=function(){this.delegate.destroy()},a("outboundFormTracker",n)},{"../provide":12,"../usage":13,"../utilities":14,"dom-utils/lib/delegate":18,"dom-utils/lib/parse-url":22,"object-assign":23}],8:[function(t,e,i){function n(t,e){l.track(t,l.plugins.OUTBOUND_LINK_TRACKER),window.addEventListener&&(this.opts=s({events:["click"],linkSelector:"a, area",shouldTrackOutboundLink:this.shouldTrackOutboundLink,fieldsObj:{},attributePrefix:"ga-",hitFilter:null},e),this.tracker=t,this.handleLinkInteractions=this.handleLinkInteractions.bind(this),this.delegates={},this.opts.events.forEach(function(t){this.delegates[t]=r(document,t,this.opts.linkSelector,this.handleLinkInteractions,{composed:!0,useCapture:!0})}.bind(this)))}var s=t("object-assign"),r=t("dom-utils/lib/delegate"),o=t("dom-utils/lib/parse-url"),a=t("../provide"),l=t("../usage"),h=t("../utilities").createFieldsObj,c=t("../utilities").getAttributeFields;n.prototype.handleLinkInteractions=function(t,e){if(this.opts.shouldTrackOutboundLink(e,o)){navigator.sendBeacon||(e.target="_blank");var i=e.getAttribute("href")||e.getAttribute("xlink:href"),n=o(i),r={transport:"beacon",eventCategory:"Outbound Link",eventAction:t.type,eventLabel:n.href},a=s({},this.opts.fieldsObj,c(e,this.opts.attributePrefix));this.tracker.send("event",h(r,a,this.tracker,this.opts.hitFilter,e))}},n.prototype.shouldTrackOutboundLink=function(t,e){var i=t.getAttribute("href")||t.getAttribute("xlink:href"),n=e(i);return n.hostname!=location.hostname&&"http"==n.protocol.slice(0,4)},n.prototype.remove=function(){Object.keys(this.delegates).forEach(function(t){this.delegates[t].destroy()}.bind(this))},a("outboundLinkTracker",n)},{"../provide":12,"../usage":13,"../utilities":14,"dom-utils/lib/delegate":18,"dom-utils/lib/parse-url":22,"object-assign":23}],9:[function(t,e,i){function n(t,e){o.track(t,o.plugins.PAGE_VISIBILITY_TRACKER),window.addEventListener&&(this.opts=s({sessionTimeout:h,changeTemplate:this.changeTemplate,hiddenMetricIndex:null,visibleMetricIndex:null,fieldsObj:{},hitFilter:null},e),this.tracker=t,this.visibilityState=document.visibilityState,this.lastVisibilityChangeTime=+new Date,this.handleVisibilityStateChange=this.handleVisibilityStateChange.bind(this),this.overrideTrackerSendMethod(),this.overrideTrackerSendHitTask(),document.addEventListener("visibilitychange",this.handleVisibilityStateChange))}var s=t("object-assign"),r=t("../provide"),o=t("../usage"),a=t("../utilities").createFieldsObj,l=t("../utilities").isObject,h=30;n.prototype.handleVisibilityStateChange=function(){var t;if(this.prevVisibilityState=this.visibilityState,this.visibilityState=document.visibilityState,this.sessionHasTimedOut()){if("hidden"==this.visibilityState)return;"visible"==this.visibilityState&&(t={transport:"beacon"},this.tracker.send("pageview",a(t,this.opts.fieldsObj,this.tracker,this.opts.hitFilter)))}else{var e=Math.round((new Date-this.lastVisibilityChangeTime)/1e3)||1;t={transport:"beacon",eventCategory:"Page Visibility",eventAction:"change",eventLabel:this.opts.changeTemplate(this.prevVisibilityState,this.visibilityState),eventValue:e},"hidden"==this.visibilityState&&(t.nonInteraction=!0);var i=this.opts[this.prevVisibilityState+"MetricIndex"];i&&(t["metric"+i]=e),this.tracker.send("event",a(t,this.opts.fieldsObj,this.tracker,this.opts.hitFilter))}this.lastVisibilityChangeTime=+new Date},n.prototype.sessionHasTimedOut=function(){var t=(new Date-this.lastHitTime)/6e4;return this.opts.sessionTimeout<t},n.prototype.overrideTrackerSendMethod=function(){this.originalTrackerSendMethod=this.tracker.send,this.tracker.send=function(){var t=Array.prototype.slice.call(arguments),e=t[0];if("pageview"!=(l(e)?e.hitType:e)&&this.sessionHasTimedOut()){var i={transport:"beacon"};this.originalTrackerSendMethod.call(this.tracker,"pageview",a(i,this.opts.fieldsObj,this.tracker,this.opts.hitFilter))}this.originalTrackerSendMethod.apply(this.tracker,t)}.bind(this)},n.prototype.overrideTrackerSendHitTask=function(){this.originalTrackerSendHitTask=this.tracker.get("sendHitTask"),this.lastHitTime=+new Date,this.tracker.set("sendHitTask",function(t){this.originalTrackerSendHitTask(t),this.lastHitTime=+new Date}.bind(this))},n.prototype.changeTemplate=function(t,e){return t+" => "+e},n.prototype.remove=function(){this.tracker.set("sendHitTask",this.originalTrackerSendHitTask),this.tracker.send=this.originalTrackerSendMethod,document.removeEventListener("visibilitychange",this.handleVisibilityStateChange)},r("pageVisibilityTracker",n)},{"../provide":12,"../usage":13,"../utilities":14,"object-assign":23}],10:[function(t,e,i){function n(t,e){o.track(t,o.plugins.SOCIAL_WIDGET_TRACKER),window.addEventListener&&(this.opts=s({fieldsObj:{},hitFilter:null},e),this.tracker=t,this.addWidgetListeners=this.addWidgetListeners.bind(this),this.addTwitterEventHandlers=this.addTwitterEventHandlers.bind(this),this.handleTweetEvents=this.handleTweetEvents.bind(this),this.handleFollowEvents=this.handleFollowEvents.bind(this),this.handleLikeEvents=this.handleLikeEvents.bind(this),this.handleUnlikeEvents=this.handleUnlikeEvents.bind(this),"complete"!=document.readyState?window.addEventListener("load",this.addWidgetListeners):this.addWidgetListeners())}var s=t("object-assign"),r=t("../provide"),o=t("../usage"),a=t("../utilities").createFieldsObj;n.prototype.addWidgetListeners=function(){window.FB&&this.addFacebookEventHandlers(),window.twttr&&this.addTwitterEventHandlers()},n.prototype.addTwitterEventHandlers=function(){try{twttr.ready(function(){twttr.events.bind("tweet",this.handleTweetEvents),twttr.events.bind("follow",this.handleFollowEvents)}.bind(this))}catch(t){}},n.prototype.removeTwitterEventHandlers=function(){try{twttr.ready(function(){twttr.events.unbind("tweet",this.handleTweetEvents),twttr.events.unbind("follow",this.handleFollowEvents)}.bind(this))}catch(t){}},n.prototype.addFacebookEventHandlers=function(){try{FB.Event.subscribe("edge.create",this.handleLikeEvents),FB.Event.subscribe("edge.remove",this.handleUnlikeEvents)}catch(t){}},n.prototype.removeFacebookEventHandlers=function(){try{FB.Event.unsubscribe("edge.create",this.handleLikeEvents),FB.Event.unsubscribe("edge.remove",this.handleUnlikeEvents)}catch(t){}},n.prototype.handleTweetEvents=function(t){if("tweet"==t.region){var e=t.data.url||t.target.getAttribute("data-url")||location.href,i={transport:"beacon",socialNetwork:"Twitter",socialAction:"tweet",socialTarget:e};this.tracker.send("social",a(i,this.opts.fieldsObj,this.tracker,this.opts.hitFilter))}},n.prototype.handleFollowEvents=function(t){if("follow"==t.region){var e=t.data.screen_name||t.target.getAttribute("data-screen-name"),i={transport:"beacon",socialNetwork:"Twitter",socialAction:"follow",socialTarget:e};this.tracker.send("social",a(i,this.opts.fieldsObj,this.tracker,this.opts.hitFilter))}},n.prototype.handleLikeEvents=function(t){var e={transport:"beacon",socialNetwork:"Facebook",socialAction:"like",socialTarget:t};this.tracker.send("social",a(e,this.opts.fieldsObj,this.tracker,this.opts.hitFilter))},n.prototype.handleUnlikeEvents=function(t){var e={transport:"beacon",socialNetwork:"Facebook",socialAction:"unlike",socialTarget:t};this.tracker.send("social",a(e,this.opts.fieldsObj,this.tracker,this.opts.hitFilter))},n.prototype.remove=function(){window.removeEventListener("load",this.addWidgetListeners),this.removeFacebookEventHandlers(),this.removeTwitterEventHandlers()},r("socialWidgetTracker",n)},{"../provide":12,"../usage":13,"../utilities":14,"object-assign":23}],11:[function(t,e,i){function n(t,e){a.track(t,a.plugins.URL_CHANGE_TRACKER),history.pushState&&window.addEventListener&&(this.opts=r({shouldTrackUrlChange:this.shouldTrackUrlChange,fieldsObj:{},hitFilter:null},e),this.tracker=t,this.path=s(),this.updateTrackerData=this.updateTrackerData.bind(this),this.originalPushState=history.pushState,history.pushState=function(t,e){h(t)&&e&&(t.title=e),this.originalPushState.apply(history,arguments),this.updateTrackerData()}.bind(this),this.originalReplaceState=history.replaceState,history.replaceState=function(t,e){h(t)&&e&&(t.title=e),this.originalReplaceState.apply(history,arguments),this.updateTrackerData(!1)}.bind(this),window.addEventListener("popstate",this.updateTrackerData))}function s(){return location.pathname+location.search}var r=t("object-assign"),o=t("../provide"),a=t("../usage"),l=t("../utilities").createFieldsObj,h=t("../utilities").isObject;n.prototype.updateTrackerData=function(t){t=t!==!1,setTimeout(function(){var e=this.path,i=s();if(e!=i&&this.opts.shouldTrackUrlChange.call(this,i,e)&&(this.path=i,this.tracker.set({page:i,title:h(history.state)&&history.state.title||document.title}),t)){var n={transport:"beacon"};this.tracker.send("pageview",l(n,this.opts.fieldsObj,this.tracker,this.opts.hitFilter))}}.bind(this),0)},n.prototype.shouldTrackUrlChange=function(t,e){return t&&e},n.prototype.remove=function(){window.removeEventListener("popstate",this.updateTrackerData),history.replaceState=this.originalReplaceState,history.pushState=this.originalPushState,this.tracker=null,this.opts=null,this.path=null,this.updateTrackerData=null,this.originalReplaceState=null,this.originalPushState=null},o("urlChangeTracker",n)},{"../provide":12,"../usage":13,"../utilities":14,"object-assign":23}],12:[function(t,e,i){var n=t("./constants"),s=t("./utilities");(window.gaDevIds=window.gaDevIds||[]).push(n.DEV_ID),e.exports=function(t,e){var i=window.GoogleAnalyticsObject||"ga";window[i]=window[i]||function(){(window[i].q=window[i].q||[]).push(arguments)},window[i]("provide",t,e),window.gaplugins=window.gaplugins||{},window.gaplugins[s.capitalize(t)]=e}},{"./constants":1,"./utilities":14}],13:[function(t,e,i){function n(t){return parseInt(t||"0",16).toString(2)}function s(t){return parseInt(t||"0",2).toString(16)}function r(t,e){if(t.length<e)for(var i=e-t.length;i;)t="0"+t,i--;return t}function o(t,e){return t.substr(0,e)+1+t.substr(e+1)}function a(t,e){var i=t.get(h.USAGE_PARAM),a=r(n(i),d);a=o(a,d-e),t.set(h.USAGE_PARAM,s(a))}function l(t){t.set(h.VERSION_PARAM,h.VERSION)}var h=t("./constants"),c={CLEAN_URL_TRACKER:1,EVENT_TRACKER:2,IMPRESSION_TRACKER:3,MEDIA_QUERY_TRACKER:4,OUTBOUND_FORM_TRACKER:5,OUTBOUND_LINK_TRACKER:6,PAGE_VISIBILITY_TRACKER:7,SOCIAL_WIDGET_TRACKER:8,URL_CHANGE_TRACKER:9},d=9;e.exports={track:function(t,e){l(t),a(t,e)},plugins:c}},{"./constants":1}],14:[function(t,e,i){var n=t("object-assign"),s=t("dom-utils/lib/get-attributes"),r={createFieldsObj:function(t,e,i,s,r){if("function"==typeof s){var o=i.get("buildHitTask");return{buildHitTask:function(i){i.set(t,null,!0),i.set(e,null,!0),s(i,r),o(i)}}}return n({},t,e)},getAttributeFields:function(t,e){var i=s(t),n={};return Object.keys(i).forEach(function(t){if(0===t.indexOf(e)&&t!=e+"on"){var s=i[t];"true"==s&&(s=!0),"false"==s&&(s=!1);var o=r.camelCase(t.slice(e.length));n[o]=s}}),n},domReady:function(t){"loading"==document.readyState?document.addEventListener("DOMContentLoaded",function e(){document.removeEventListener("DOMContentLoaded",e),t()}):t()},withTimeout:function(t,e){var i=!1,n=function(){i||(i=!0,t())};return setTimeout(n,e||2e3),n},camelCase:function(t){return t.replace(/[\-\_]+(\w?)/g,function(t,e){return e.toUpperCase()})},capitalize:function(t){return t.charAt(0).toUpperCase()+t.slice(1)},isObject:function(t){return"object"==typeof t&&null!==t},isArray:Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},toArray:function(t){return r.isArray(t)?t:[t]}};e.exports=r},{"dom-utils/lib/get-attributes":19,"object-assign":23}],15:[function(t,e,i){function n(){return(new Date).getTime()}e.exports=Date.now||n},{}],16:[function(t,e,i){var n=t("date-now");e.exports=function(t,e,i){function s(){var c=n()-l;c<e&&c>0?r=setTimeout(s,e-c):(r=null,i||(h=t.apply(a,o),r||(a=o=null)))}var r,o,a,l,h;return null==e&&(e=100),function(){a=this,o=arguments,l=n();var c=i&&!r;return r||(r=setTimeout(s,e)),c&&(h=t.apply(a,o),a=o=null),h}}},{"date-now":15}],17:[function(t,e,i){var n=t("./matches"),s=t("./parents");e.exports=function(t,e,i){if(t&&1==t.nodeType&&e)for(var r,o=(i?[t]:[]).concat(s(t)),a=0;r=o[a];a++)if(n(r,e))return r}},{"./matches":20,"./parents":21}],18:[function(t,e,i){var n=t("./closest"),s=t("./matches");e.exports=function(t,e,i,r,o){o=o||{};var a=function(t){if(o.composed&&"function"==typeof t.composedPath)for(var e,a=t.composedPath(),l=0;e=a[l];l++)1==e.nodeType&&s(e,i)&&(h=e);else var h=n(t.target,i,!0);h&&r.call(h,t,h)};return t.addEventListener(e,a,o.useCapture),{destroy:function(){t.removeEventListener(e,a,o.useCapture)}}}},{"./closest":17,"./matches":20}],19:[function(t,e,i){e.exports=function(t){var e={};if(!t||1!=t.nodeType)return e;var i=t.attributes;if(0===i.length)return{};for(var n,s=0;n=i[s];s++)e[n.name]=n.value;return e}},{}],20:[function(t,e,i){function n(t,e){if("string"!=typeof e)return!1;if(r)return r.call(t,e);for(var i,n=t.parentNode.querySelectorAll(e),s=0;i=n[s];s++)if(i==t)return!0;return!1}var s=window.Element.prototype,r=s.matches||s.matchesSelector||s.webkitMatchesSelector||s.mozMatchesSelector||s.msMatchesSelector||s.oMatchesSelector;e.exports=function(t,e){if(t&&1==t.nodeType&&e){if("string"==typeof e||1==e.nodeType)return t==e||n(t,e);if("length"in e)for(var i,s=0;i=e[s];s++)if(t==i||n(t,i))return!0}return!1}},{}],21:[function(t,e,i){e.exports=function(t){for(var e=[];t&&t.parentNode&&1==t.parentNode.nodeType;)e.push(t=t.parentNode);return e}},{}],22:[function(t,e,i){var n=RegExp(":(80|443)$"),s=document.createElement("a"),r={};e.exports=function t(e){if(e=e&&"."!=e?e:location.href,r[e])return r[e];if(s.href=e,"."==e.charAt(0))return t(s.href);var i=s.protocol&&":"!=s.protocol?s.protocol:location.protocol,o="80"==s.port||"443"==s.port?"":s.port;o="0"==o?"":o;var a=""==s.host?location.host:s.host,l=""==s.hostname?location.hostname:s.hostname;a=a.replace(n,"");var h=s.origin?s.origin:i+"//"+a,c="/"==s.pathname.charAt(0)?s.pathname:"/"+s.pathname;return r[e]={hash:s.hash,host:a,hostname:l,href:s.href,origin:h,pathname:c,port:o,protocol:i,search:s.search,fragment:s.hash.slice(1),path:c+s.search,query:s.search.slice(1)}}},{}],23:[function(t,e,i){"use strict";function n(t){if(null===t||void 0===t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}var s=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable;e.exports=function(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de","5"===Object.getOwnPropertyNames(t)[0])return!1;for(var e={},i=0;i<10;i++)e["_"+String.fromCharCode(i)]=i;if("0123456789"!==Object.getOwnPropertyNames(e).map(function(t){return e[t]}).join(""))return!1;var n={};return"abcdefghijklmnopqrst".split("").forEach(function(t){n[t]=t}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},n)).join("")}catch(t){return!1}}()?Object.assign:function(t,e){for(var i,o,a=n(t),l=1;l<arguments.length;l++){i=Object(arguments[l]);for(var h in i)s.call(i,h)&&(a[h]=i[h]);if(Object.getOwnPropertySymbols){o=Object.getOwnPropertySymbols(i);for(var c=0;c<o.length;c++)r.call(i,o[c])&&(a[o[c]]=i[o[c]])}}return a}},{}],24:[function(t,e,i){t("./plugins/clean-url-tracker"),t("./plugins/event-tracker"),t("./plugins/impression-tracker"),t("./plugins/media-query-tracker"),t("./plugins/outbound-form-tracker"),t("./plugins/outbound-link-tracker"),t("./plugins/page-visibility-tracker"),t("./plugins/social-widget-tracker"),t("./plugins/url-change-tracker"),t("./plugins/autotrack")},{"./plugins/autotrack":2,"./plugins/clean-url-tracker":3,"./plugins/event-tracker":4,"./plugins/impression-tracker":5,"./plugins/media-query-tracker":6,"./plugins/outbound-form-tracker":7,"./plugins/outbound-link-tracker":8,"./plugins/page-visibility-tracker":9,"./plugins/social-widget-tracker":10,"./plugins/url-change-tracker":11}]},{},[24]);
window.fbAsyncInit=function(){var e=$("meta[property='fb:app_id']").attr("content");FB.init({appId:e,xfbml:!0,version:"v2.8"}),FB.Event.subscribe("comment.create",function(e){var n=null;e&&e.href&&(n=e.href),ga("send",{hitType:"event",eventCategory:"WebFacebookCommentCreate",eventAction:n,eventLabel:null,nonInteraction:!0}),document.sendTrack({action:"web_facebook_comment_create"})})},function(e,n,t){var o,c=e.getElementsByTagName(n)[0];e.getElementById(t)||(o=e.createElement(n),o.id=t,o.src="//connect.facebook.net/zh_TW/sdk.js",c.parentNode.insertBefore(o,c))}(document,"script","facebook-jssdk");
!function(e,t,n,a,o,s,i){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,s=t.createElement(n),i=t.getElementsByTagName(n)[0],s.async=1,s.src="//www.google-analytics.com/analytics.js",i.parentNode.insertBefore(s,i)}(window,document,"script",0,"ga"),ga("create","UA-41537444-1","thenewslens.com"),ga("require","displayfeatures"),"undefined"!=typeof Tracker&&ga("set","dimension9",Tracker.get_uu_id()),ga("send","pageview"),ga("create","UA-41537444-5","thenewslens.com","memberTracker");var testAd=document.createElement("div");testAd.innerHTML="&nbsp;",testAd.className="adsbox",document.body.appendChild(testAd),window.setTimeout(function(){if(0===testAd.offsetHeight&&(ga("send","event","Blocking Ads","Yes","ADBlock",{nonInteraction:!0}),"international"!=Tnl.url.getSubDomain()))for(var e,t,n=[".help-tnl-container-970_250",".help-tnl-container-300_250",".help-tnl-container-728_90"],a=0;a<n.length;a++)t=n[a],e=$(t),e.each(function(e,t){t.innerHTML='<a href="https://goo.gl/QffWXx" target="_blank"><div class="help-tnl"></div></a>'});"function"==typeof testAd.remove?testAd.remove():testAd.outerHTML=""},100);
!function(e,t,a,n,g){e[n]=e[n]||[],e[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var m=t.getElementsByTagName(a)[0],r=t.createElement(a);r.async=!0,r.src="//www.googletagmanager.com/gtm.js?id=GTM-TSZ536",m.parentNode.insertBefore(r,m)}(window,document,"script","dataLayer"),function(e,t,a,n,g){e[n]=e[n]||[],e[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var m=t.getElementsByTagName(a)[0],r=t.createElement(a);r.async=!0,r.src="https://www.googletagmanager.com/gtm.js?id=GTM-TSR7ZS2",m.parentNode.insertBefore(r,m)}(window,document,"script","dataLayer");
!function(t){t.track=t.track||{},t.track.tnla=t.track.tnla||{},t.track.tnla={variable:{},getInfiniteCode:function(){return 1},getProjectCode:function(){return{www:1,hk:2,international:3,asean:4}[window.location.hostname.split(".")[0]]},getContentTypeCode:function(t){return t.page_id?1:0},getCanonicalUrlCode:function(t){return t.page_url_canonical},getAuthorCode:function(t){return t.author_name},getCategoryCode:function(t){return t.all_category_list[t.all_category_list.length-1]},getPublichTimeCode:function(t){return t.publish_time_iso_8601},getTitleCode:function(){return document.title},getSponsorCode:function(t){return t.page_id?t.is_sponsor?1:0:""},sendTrack:function(n){if("thenewslens.com"!=t.url.getDomain())return!1;n=n||tnlInfo;var e=this.getPVTrackMeta(n);tnla("track",e)},getPVTrackMeta:function(t){return{name:"pv",ct:this.getContentTypeCode(t),sp:this.getSponsorCode(t)}},sendInfiniteTrack:function(n){if("thenewslens.com"!=t.url.getDomain())return!1;n=n||tnlInfo;var e=this.getInfinitePVTrackMeta(n);tnla("track",e)},getInfinitePVTrackMeta:function(t){return{name:"pv",inf:this.getInfiniteCode(),ct:this.getContentTypeCode(t),curl:this.getCanonicalUrlCode(t),title:this.getTitleCode(),au:this.getAuthorCode(t),ca:this.getCategoryCode(t),dp:this.getPublichTimeCode(t),sp:this.getSponsorCode(t)}},addMainScript:function(){!function(t,n,e,i,o,a,r){t.tnla_object=o,t[o]=t[o]||function(){(t[o].q=t[o].q||[]).push(arguments)},a=n.createElement(e),r=n.getElementsByTagName(e)[0],a.async=1,a.src="//tnla.thenewslens.com/static/tnla.min.js?v=1.2",r.parentNode.insertBefore(a,r)}(window,document,"script",0,"tnla"),tnla("init","tnl",this.getProjectCode()),t.track.tnla.sendTrack()}},t.track.tnla.addMainScript()}("undefined"!=typeof Tnl?Tnl:this.Tnl={});
try{var ln_data_setting={account:"2e38728",domain:"thenewslens.com",cm_tid:"3829"},_smq=_smq||[];_smq.push(["_setAccount",ln_data_setting.account,new Date]),_smq.push(["_setDomainName",ln_data_setting.domain]),_smq.push(["pageview"]),function(){var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src=("https:"==document.location.protocol?"https://":"http://")+"cdn.lndata.com/collect.js",t.onload=function(){tnla("id",function(t){var n=ln_data_setting.cm_tid,e="https://tnla.thenewslens.com/lndata-cm?tnla="+t.uuid+"&host="+location.hostname,a="https://cm.lndata.com/?tid="+n+"&uid="+t.uuid+"&redir="+encodeURIComponent(e);(new Image).src=a})};var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(t,n)}()}catch(t){console.log("== LnData Error ==",t)}
!function(t){t.track=t.track||{},t.track.mediaLab={variable:{uuid:"",ssid:""},init:function(){},getEditionCode:function(){return{www:"TW",hk:"HK",international:"INTL",asean:"ASEAN"}[window.location.hostname.split(".")[0]]},getCategoryCode:function(t){return{1:"NEWS",3:"HEALTH",4:"CELEBRITY",5:"WORLD",6:"PHOTO",7:"BLOG",8:"VIDEOS",9:"ILLUSTRATION",10:"POLITICS",11:"EDUCATION",12:"PRESS",13:"ASEAN",14:"LIVING",15:"BOOKDIGEST",16:"SOCIETY",17:"TECH",18:"DIGEST",19:"CAREER",20:"ART",21:"BUSINESS",22:"SPORTS",23:"ASEANPOLITICS",24:"ASEANCULTURE",25:"ASEANIMMIGRANT",26:"ASEANTEN",27:"SCIENCE",28:"GREEN",29:"ANIMAL",30:"MILITARY",31:"ENVIRONMENT",32:"STYLE",33:"CRAFTSMANSHIP",34:"CITY",35:"ARTDESIGN",36:"OUTDOOR",37:"ABORIGINAL",38:"URBAN",39:"LABOUR",40:"GENDER",41:"HUMANITY"}[t]},getSectionCode:function(t){return{1:"NEWS",2:"VOICES",3:"VIDEOS",4:"PRESS",5:"DIGEST",6:"PHOTO",7:"ILLUSTRATION",8:"FEATURES",9:"INTERVIEW",10:"DETAIL"}[t]},getContentCode:function(t){return"/"===document.location.pathname?"home":"index"},getTitleCode:function(){return"/"===document.location.pathname?null:document.title.split(" - ")[0]},getSiteCode:function(){return window.location.hostname},getPublishDateCode:function(t){return t.split(" ")[0]},getReferrerCode:function(){return document.referrer},getActionCode:function(){return"pageview"},getSizeCode:function(){return t.$.$window.width()+"x"+t.$.$window.height()},getUuidCode:function(){return this.variable.uuid||Cookies.get("tnla_uuid")},getSessionIdCode:function(){return this.variable.ssid||Cookies.get("tnl_tnla_ssid")},getTimestampCode:function(){return+new Date},getQueryCode:function(t,e){switch(t){case"postId":case"title":case"author":return e}},getQueryStringByQueries:function(t){var e=[];return Object.keys(t).map(function(i){var n=t[i];n&&e.push(i+"="+encodeURIComponent(n))}),e.join("&")},getArticlePageQueryString:function(t){var e={PRD:"NEWSLENS",ED:this.getEditionCode(),CHCAT:this.getCategoryCode(t.main_category_id),SECTION:this.getSectionCode(t.post_type_id),CONTENT:"article",SITE:this.getSiteCode(),PUBDATE:this.getPublishDateCode(t.publish_time),CID:t.page_id,TITLE:t.post_title,AUTH:t.author_name,REF:this.getReferrerCode(),ACTION:this.getActionCode(),SZ:this.getSizeCode(),UID:this.getUuidCode(),SID:this.getSessionIdCode(),TS:this.getTimestampCode()};return this.getQueryStringByQueries(e)},getMiddlePageQueryString:function(){var t={PRD:"NEWSLENS",ED:this.getEditionCode(),SITE:this.getSiteCode(),CONTENT:this.getContentCode(),TITLE:this.getTitleCode(),REF:this.getReferrerCode(),ACTION:this.getActionCode(),SZ:this.getSizeCode(),UID:this.getUuidCode(),SID:this.getSessionIdCode(),TS:this.getTimestampCode()};return this.getQueryStringByQueries(t)},getScript:function(t){var e;return'<script>$ready_mlab(function(){mLabGrp.pglog("'+(e=t.page_id?this.getArticlePageQueryString(t):this.getMiddlePageQueryString())+'")})</script><noscript><img src="https://imp-media-lab.thenewslens.com/1x1.gif?'+e+'" style="display:none" height="1" width="1" alt="" /></noscript>'},sendPixelTrack:function(e){if("thenewslens.com"!=t.url.getDomain())return!1;e=e||tnlInfo;var i=this.getScript(e);t.$.$body.append(i)},addMainScript:function(){var e=document.createElement("script");e.type="text/javascript";var i="https:"==document.location.protocol;e.src=(i?"https:":"http:")+"//imp-media-lab.thenewslens.com/mlab_tnl.min.js?v1.0.1";var n=document.getElementsByTagName("script")[0];tnla("id",function(i){t.track.mediaLab.variable.uuid=i.uuid,t.track.mediaLab.variable.ssid=i.ssid,n.parentNode.insertBefore(e,n)}),e.addEventListener("load",function(){t.track.mediaLab.sendPixelTrack()})}},t.track.mediaLab.addMainScript()}("undefined"!=typeof Tnl?Tnl:this.Tnl={});
!function(n){n.Config=n.Config||{},n.Config=function(){},n.Config.prototype={constructor:n.Config,variable:{wineLegalTagName:"未滿十八歲請勿飲酒"},init:function(){}},n.$.$document.ready(function(){n.Config=new n.Config,n.Config.init()})}("undefined"!=typeof Tnl?Tnl:this.Tnl={});
!function(t){t.Bind=t.Bind||{},t.Bind=function(){},t.Bind.prototype={constructor:t.Bind,$:{template:{}},variable:{},init:function(){this.CategoryList.init()},CategoryList:{$:{template:{}},init:function(){return this.bind(),this},initDom:function(){},bind:function(){t.$.$document.on("click",".more-tags-btn",function(n){t.Util.eventStop(n),$(this).parent().parent().addClass("show-tags-box")})}},Progressbar:{$:{template:{}},init:function(){return this.initDom(),this.bind(),this},initDom:function(){this.$.$ScrollProgressBarContainer=t.$.$document.find("#scroll_progress_bar_container"),this.$.$ScrollProgressBarRate=this.$.$ScrollProgressBarContainer.find("#scroll_progress_bar_rate"),this.$.$TitleBar=t.$.$document.find("#title-bar")},bind:function(){var n,r=this,i=0;t.$.$document.on("scroll",function(){n=t.$.$window.scrollTop(),n>i?r.showProgressBar():r.hideProgressBar(),n<=0&&r.hideProgressBar(),i=n})},setReadPercent:function(t){t=parseInt(t),t<=0&&(t=0),t>=100&&(t=100),this.$.$ScrollProgressBarRate.css("width",t+"%")},setReadTitle:function(t){this.$.$TitleBar.html(t)},showProgressBar:function(){this.$.$ScrollProgressBarContainer.hasClass("fadeOut")||this.$.$ScrollProgressBarContainer.addClass("fadeOut")},hideProgressBar:function(){this.$.$ScrollProgressBarContainer.hasClass("fadeOut")&&this.$.$ScrollProgressBarContainer.removeClass("fadeOut")}}},t.$.$document.ready(function(){t.Bind=new t.Bind,t.Bind.init()})}("undefined"!=typeof Tnl?Tnl:this.Tnl={});
!function(t){t.API=t.API||{},t.API=function(){},t.API.prototype={constructor:t.API,$:{template:{}},variable:{},init:function(){},Setting:{Template:{getTemplate:function(n,e){$.ajax({type:"get",url:t.url.getApiDomainUrl()+"/web/"+t.url.getSubDomain()+"/setting/template/"+n,data:{},success:function(t){e&&e(t)},error:function(t){console.log(t)}})}}}},t.$.$document.ready(function(){t.API=new t.API,t.API.init()})}("undefined"!=typeof Tnl?Tnl:this.Tnl={});
!function(t){t.article=t.article||{},t.article.tools={notAllowSponsorContent:["businesses","business","official-blog"],getSessionStorage:function(t){return sessionStorage.getItem(t)},hasSessionStorage:function(t){return null!==sessionStorage.getItem(t)},isNotAllowSponsorContent:function(){return t.Util.inArray(this.getSessionStorage("page"),this.notAllowSponsorContent)},getInfiniteScrollUrl:function(t,e,o){o=o||!1;var i,n,s;if(i=window.location.host.split("."),n=i[0],i.splice(0,1),s=i.join("."),o&&!this.isNotAllowSponsorContent())return"//api."+s+"/web/"+n+"/specialInfinite/"+t;if(!this.isNotAllowSponsorContent())return"//api."+s+"/web/"+n+"/infinite/"+t+"?page="+e;var r="//api."+s+"/web/"+n+"/list/";return this.hasSessionStorage("page")?(r+=this.getSessionStorage("page")+"/"+t,this.hasSessionStorage("type")&&(r+="/"+this.getSessionStorage("type"),this.hasSessionStorage("date")&&(r+="/"+this.getSessionStorage("date"))),r):r+"direct/"+t+"?page="+e},getRelatedBoxURL:function(t){var e,o;return e=window.location.host.split("."),o=e[0],e.splice(0,1),"//api."+e.join(".")+"/web/"+o+"/related/"+t},getFeatureURL:function(t,e){var o,i;return o=window.location.host.split("."),i=o[0],o.splice(0,1),"//api."+o.join(".")+"/web/"+i+"/feature/"+t+"/"+e},getPromotionUrl:function(t){var e,o;return e=window.location.host.split("."),o=e[0],e.splice(0,1),"//api."+e.join(".")+"/web/"+o+"/promotion/"+t}}}("undefined"!=typeof Tnl?Tnl:this.Tnl={});
!function(t){t.article=t.article||{},t.article.recommend=t.article.recommend||{},t.article.recommend=function(t){this.$.App=t},t.article.recommend.prototype={constructor:t.article.recommend,$:{$posts:null,$postsContainer:null,$progressBar:null,$progressContainer:null,$topZone:null,$titleBar:null,$progressShare:null,$loaderContainer:null,$wineLegalContainer:null,$topZoneRelatedContainer:null},variable:{infiniteScrollPercentage:.5,hkRecommendPercentage:{infiniteScroll:0,popinBox:0,dableBox:0,relatedBox:1},recommend_method:{"up-to-you":"infiniteScroll","tnl-related":"relatedBox",popin:"popinBox",dable:"dableBox"},readingTrackIntervalNum:4,ajaxReady:!0,$dfp_advertisement:[],allPostInfo:[],currentPageId:null,currentPageUrl:null,wineLegalTagName:"未滿十八歲請勿飲酒"},init:function(){t.Util.forceRefreshInitScrollTop(),this.initDOM(),this.setPostInfo(tnlInfo),this.setCurrentPage(tnlInfo.page_id,tnlInfo.page_url),this.setWineLegal(),this.setRecommendType(),this.bind(),this.setTopRecommendArticle()},initDOM:function(){this.$.$posts=this.$.App.find(".article-zone"),this.$.$postsContainer=this.$.App.find(".article-section"),this.$.$progressContainer=this.$.App.find(".scrollProgress-container"),this.$.$topZone=this.$.App.find(".top-zone"),this.$.$titleBar=this.$.App.find("#title-bar"),this.$.$progressShare=this.$.App.find(".progress-share"),this.$.$loaderContainer=this.$.App.find(".loader-container"),this.$.$topZoneRelatedContainer=this.$.App.find("#topZone-related-container")},setRecommendType:function(){var t,e,i,n;t=window.location.host.split("."),e=t[0];var a=this.variable.infiniteScrollPercentage;if(tnlInfo&&tnlInfo.infinite_scroll_percentage>=0&&(a=tnlInfo.infinite_scroll_percentage),a=parseFloat(a,10),console.log(a),i=window.location.search,i.split("?").length>1){if(n=i.split("?")[1].split("&"),n.indexOf("tnl-related=force")>-1)return void this.relatedBox.init(this);if(n.indexOf("tnl-infinite=force")>-1)return void this.infiniteScroll.init(this)}if(this.getPostInfoValue("xdfp"))return void this.relatedBox.init(this);switch(e){case"www":Math.random()<a?this.infiniteScroll.init(this):this.relatedBox.init(this);break;case"hk":case"international":case"asean":if(tnlInfo&&tnlInfo.article_bottom_recommend&&tnlInfo.article_bottom_recommend.type){var o=tnlInfo.article_bottom_recommend.type,r="infiniteScroll";this.variable.recommend_method[o]&&(r=this.variable.recommend_method[o]),console.log("[Article Bottom Recommend Method]",r),r?this[r].init(this):this.infiniteScroll.init(this)}else this.infiniteScroll.init(this);break;default:this.infiniteScroll.init(this)}},getAllPostInfoIds:function(){return _.pluck(this.variable.allPostInfo,"page_id")},getOrder:function(t){t=t||this.variable.currentPageId;var e=this.getAllPostInfoIds().indexOf(t.toString());if(e===-1)throw new Error("can't find this page id");return e+1},getPostSEOTitle:function(t){t=t||this.variable.currentPageId;var e,i,n=this.getPostInfoValue("post_title",t.toString());switch(e=window.location.host.split("."),e[0]){case"hk":case"www":case"asean":i="The News Lens 關鍵評論網";break;case"international":i="The News Lens International Edition"}return n+" - "+i},getPostUrl:function(t,e){return t=t||!1,e=e||this.variable.currentPageUrl,t&&(e=e.replace(location.origin,"")),e},getPostInfoObject:function(t){t=t||this.variable.currentPageId;var e=_.where(this.variable.allPostInfo,{page_id:t.toString()});if(!e.length)throw new Error("can't find this page id info");return e[0]},getPostInfoValue:function(t,e){e=e||this.variable.currentPageId;var i=this.getPostInfoObject(e.toString());return void 0!==i[t]?i[t]:""},setCurrentPage:function(t,e){var i=!1;this.variable.currentPageId!==t.toString()&&(null!==this.variable.currentPageId&&(i=!0),this.variable.currentPageId=t.toString()),this.variable.currentPageUrl!==e.toString()&&(null!==this.variable.currentPageUrl&&(i=!0),this.variable.currentPageUrl=e.toString()),i&&this.setTopInfo()},setPostInfo:function(t){if(void 0===t.page_id)throw new Error("not include page id");t.page_id=t.page_id.toString(),this.getAllPostInfoIds().indexOf(t.page_id)>-1?this.variable.allPostInfo[this.getAllPostInfoIds().indexOf(t.page_id)]=_.extend(this.variable.allPostInfo[this.getAllPostInfoIds().indexOf(t.page_id)],t):this.variable.allPostInfo.push(t)},setPostHeightAndOffsetAndDOM:function(e){var i=e.find("article").eq(0);this.setPostInfo({page_id:e.data("id").toString(),post_title:e.data("title").toString(),height:e.height()-t.$.$window.outerHeight(),offset_top:e.offset().top,article_height:i.height(),article_offset_top:i.offset().top,$DOM:e})},setReadingTrackRecord:function(t){for(var e=t.data("id").toString(),i=t.data("title").toString(),n=this.variable.readingTrackIntervalNum,a=[],o=1;o<n;o++)a.push({threshold:(o/n*100).toFixed(0),isTrigger:!1});this.setPostInfo({page_id:e,post_title:i,reading_track:_.indexBy(a,"threshold")})},updateReadingTrackThresholdIsTrigger:function(t,e){e=e||this.variable.currentPageId;var i=this.getPostInfoValue("reading_track",e);if(void 0===i[t])throw new Error("Reading Track Threshold Not Corrected");i[t].isTrigger=!0,this.setPostInfo({page_id:e,reading_track:i})},updatePostHeightAndOffset:function(e){e=e||this.variable.currentPageId;var i=this.getPostInfoValue("$DOM",e),n=i.find("article").eq(0),a=this.getPostInfoValue("offset_top",e),o=this.getPostInfoValue("height",e),r=this.getPostInfoValue("article_height",e),s=this.getPostInfoValue("article_offset_top",e);a===i.offset().top&&o===i.height()-t.$.$window.outerHeight()&&r===n.height()&&s===n.offset().top||this.setPostInfo({page_id:i.data("id"),post_title:i.data("title"),height:i.height()-t.$.$window.outerHeight(),offset_top:i.offset().top,article_height:n.height(),article_offset_top:n.offset().top})},showTopInfoBar:function(){this.$.$progressContainer.hasClass("fadeOut")||this.$.$progressContainer.addClass("fadeOut")},hideTopInfoBar:function(){this.$.$progressContainer.hasClass("fadeOut")&&this.$.$progressContainer.removeClass("fadeOut")},setTopInfo:function(){var e=t.Bind.Progressbar.init(),i=this.getPostInfoValue("post_title");e.setReadTitle(i),this.$.$progressShare.attr("data-title",i).attr("data-url",this.getPostUrl()),this.updatePostHeightAndOffset(),this.setWineLegal(),this.changePage()},sendContentInsight:function(){return!0},changePage:function(){History.replaceState(null,this.getPostSEOTitle(),this.getPostUrl(!0)),this.sendAnalyticsRecord()},setWineLegal:function(){var e=this,i=this.getPostInfoValue("tags_list").split(", ");this.$.$wineLegalContainer&&this.$.$wineLegalContainer.length?t.Util.inArray(this.variable.wineLegalTagName,i)?this.$.$wineLegalContainer.removeClass("wine-legal-disable").show():this.$.$wineLegalContainer.addClass("wine-legal-disable").show():t.Util.inArray(this.variable.wineLegalTagName,i)&&t.API.Setting.Template.getTemplate("isWineLegal",function(i){i&&i.result&&i.result.view&&(t.$.$body.append(i.result.view),e.$.$wineLegalContainer=t.$.$document.find("#tnl-wine-legal"),e.$.$wineLegalContainer.length&&e.setWineLegal())})},sendRecordThrottle:function(t){t=t||this.variable.currentPageId;var e=this.getPostInfoValue("send_timestamp"),i=+new Date;return(!e||i>e+1e3)&&(this.setPostInfo({page_id:t,send_timestamp:i}),!0)},sendAnalyticsRecord:function(){if(this.sendRecordThrottle()){var e=this.getPostSEOTitle(),i=this.getPostUrl(),n=this.getPostUrl(!0),a=this.getPostInfoValue("page_id"),o=this.getPostInfoValue("post_type_keyword"),r=this.getAllPostInfoIds()[0],s=this.getOrder(),l=this.getPostInfoValue("is_sponsor",a);t.analytics.getInfo("view",s,this.getPostInfoObject()),l&&t.analytics.sendGreedySnakeTrack("sponsor_pv","sponsorRead",{page_id:a,position:s.toString()}),ga("send","pageview",{title:e,location:i,page:n}),ga("send","event","infinitescroll",a,r,s,{page:n,nonInteraction:!0}),ga("send",{hitType:"event",eventCategory:"ArticleTypeVisit",eventAction:o,eventLabel:null,nonInteraction:!0}),t.track.mediaLab.sendPixelTrack(this.getPostInfoObject()),t.track.tnla.sendInfiniteTrack(this.getPostInfoObject())}},setPostReadingTrack:function(t){var e=this;new Waypoint({offset:"100%",element:t,handler:function(i){var n=(this.element,t.data("id").toString());switch(i){case"up":break;case"down":console.log("[RT]-PV",n),e.sendReadingTrackAnalytics("progress",{type:"pv",page_id:n})}this.destroy()}}),new Waypoint({offset:"100%",element:t.find("article").eq(0),handler:function(t){var i=(this.element,e.variable.currentPageId);switch(t){case"up":break;case"down":console.log("[RT]-META",i),e.sendReadingTrackAnalytics("progress",{type:"meta",page_id:i})}this.destroy()}}),new Waypoint({offset:"bottom-in-view",element:t.find("article").eq(0),handler:function(t){var i=(this.element,e.variable.currentPageId);switch(t){case"up":break;case"down":console.log("[RT]-FOOTER",i),e.sendReadingTrackAnalytics("progress",{type:"footer",page_id:i})}this.destroy()}})},sendReadingTrackAnalytics:function(e,i){t.analytics.sendGreedySnakeTrack(e,"readProgress",i)},bind:function(){var e=this,i=0,n=t.Bind.Progressbar.init();t.$.$document.on("scroll",function(){var a=t.$.$window.scrollTop()-e.getPostInfoValue("offset_top"),o=a/e.getPostInfoValue("height")*100;n.setReadPercent(o),a>10&&!e.$.$topZone.hasClass("short-top-zone")&&e.$.$topZone.addClass("short-top-zone"),a<-10&&0==e.getOrder()&&e.$.$topZone.removeClass("short-top-zone"),t.$.$window.scrollTop()>i?e.showTopInfoBar():e.hideTopInfoBar(),e.$.$topZoneRelatedContainer.length&&e.$.$topZoneRelatedContainer.is(":visible")&&e.$.$topZoneRelatedContainer.fadeOut(700);var r=e.variable.currentPageId,s=e.getPostInfoValue("article_offset_top"),l=e.getPostInfoValue("article_height"),d=t.$.$window.scrollTop()+t.$.$window.outerHeight()-s,h=d/l*100,c=e.getPostInfoValue("reading_track");_.each(c,function(t,i){if(!t.isTrigger&&h>t.threshold){console.log("[RT]-REACH"+t.threshold,r,d,l*t.threshold/100,l);t.threshold;e.sendReadingTrackAnalytics("progress",{type:"c_"+t.threshold,page_id:r,y:d,full:l}),e.updateReadingTrackThresholdIsTrigger(t.threshold,r)}});var p,f,g=e.variable.$dfp_advertisement;for(var u in g)if(p=g[u],!p.is_processing&&!p.is_already_display){if(p.is_processing=!0,!p.$dom.offset())break;f=p.$dom.offset().top,window_offset_top=t.$.$window.scrollTop(),f-t.$.$window.height()-50<window_offset_top&&(t.advertisement.dfp.show(p.ad_group_list),p.is_already_display=!0,delete g[u]),p.is_processing=!1}i=t.$.$window.scrollTop()}),t.$.$document.on("click",".progress-share",function(){var t=e.variable.currentPageId,i=e.getPostSEOTitle(),n=e.getOrder(),a=e.getPostUrl(!0),o=e.getAllPostInfoIds()[0];ga("send","event","InfiniteShare",t,o,n,{title:i,page:a,nonInteraction:!0})}),t.$.$document.on("click",".top_recommend_article_btn",function(i){t.Util.eventStop(i),e.$.$topZoneRelatedContainer.fadeToggle(700)})},setTopRecommendArticle:function(){var e=this;e.$.$topZoneRelatedContainer.length&&t.$.$document.ready(function(){var i,n=t.article.tools.getRelatedBoxURL(e.variable.currentPageId);search=window.location.search,search.split("?").length>1&&(params=search.split("?")[1].split("&"),params.indexOf("tnl-type=tag")>-1?i="tag":params.indexOf("tnl-type=also_read")>-1?i="also_read":params.indexOf("tnl-type=fb_hot")>-1&&(i="fb_hot"));var a={device:t.device.getDeviceType(),force:i,show:"top"};try{var o=$.url("?large_photo_width"),r=$.url("?large_photo_height"),s=$.url("?large_photo_quality"),l=$.url("?small_photo_width"),d=$.url("?small_photo_height"),h=$.url("?small_photo_quality");o&&(a.large_photo_width=o),r&&(a.large_photo_height=r),s&&(a.large_photo_quality=s),l&&(a.small_photo_width=l),d&&(a.small_photo_height=d),h&&(a.small_photo_quality=h)}catch(t){console.log(t)}$.ajax({type:"GET",url:n,data:a,contentType:"application/json"}).success(function(t){var i=$(t.html),n=i.data("recommendType");console.log("top recommend type",n),e.$.$topZoneRelatedContainer.html(i)})})},infiniteScroll:{parent:null,variable:{sponsorContentPercentage:1,totalPost:0,hitAjaxTimes:0,emailPosition:0},setCurrentPage:function(t,e){this.parent.setCurrentPage(t,e)},init:function(t){this.parent=t;var e=this.parent.$.$posts.eq(0);this.infinitePreparation(),this.fetchInfiniteScrollPost(),this.processEachHTMLDOM(e),this.bind()},infinitePreparation:function(){this.parent.$.App.find("footer#tnl-footer").hide()},bind:function(){var e=this;t.$.$document.on("click",".progress-next",function(){var t=e.parent.variable.currentPageId,i=e.parent.getPostSEOTitle(),n=e.parent.getOrder(),a=e.parent.getPostUrl(!0),o=e.parent.getAllPostInfoIds()[0],r=e.parent.$.$postsContainer.find(".article-zone").eq(n);0!=r.length?(ga("send","event","InfiniteClickNext",t,o,n,{title:i,page:a,nonInteraction:!0}),$("html, body").animate({scrollTop:r.offset().top},1e3)):e.fetchInfiniteScrollPost()})},beforeFetchPreparation:function(){this.parent.variable.ajaxReady=!1,this.variable.hitAjaxTimes++,this.variable.emailPosition=1==this.variable.hitAjaxTimes?1:0},fetchInfiniteScrollPost:function(){this.parent.variable.ajaxReady&&(this.beforeFetchPreparation(),$.ajax({type:"GET",url:this.getSponsorContentOrNormalURL(),data:{email:this.variable.emailPosition},contentType:"application/json"}).success(function(t){this.afterFetchProcession(t)}.bind(this)))},afterFetchProcession:function(e){if("error"===e.status&&1===this.variable.hitAjaxTimes&&(this.parent.variable.ajaxReady=!0,this.fetchInfiniteScrollPost()),""!==e.html){var i=this;$(e.html).each(function(){var t=$(this);if(void 0!==t.data("id")){if(i.parent.getAllPostInfoIds().indexOf(t.data("id").toString())>-1)return;var n=_.findWhere(e.post_info_list,{page_id:t.data("id")});i.parent.setPostInfo(n)}i.processEachHTMLDOM(t)});var n;_.each(e.dfp_advertisement_config_list,function(t){_.each(t,function(e,a){n=t[a].ad_slot_id,i.parent.variable.$dfp_advertisement[n]={$dom:$("#"+n),ad_group_list:t[a],is_processing:!1,is_already_display:!1}})}),Waypoint.refreshAll(),t.$.$document.trigger("initBeforeAfterImage"),this.parent.variable.ajaxReady=!0}},processEachHTMLDOM:function(t){t.hasClass("article-zone")&&(this.variable.totalPost++,t.attr("data-order",this.variable.totalPost)),t.hasClass("article-zone")&&void 0!==t.attr("id")&&this.parent.$.$postsContainer.find("#"+t.attr("id")).length||this.parent.$.$postsContainer.append(t),t.hasClass("article-zone")&&(this.parent.setPostHeightAndOffsetAndDOM(t),this.parent.setReadingTrackRecord(t),this.setPostHitViewportTop(t),this.setPostHitViewportBottom(t),this.setPostContentHitViewportTop(t),this.parent.setPostReadingTrack(t),this.setFacebookComment(t),2===this.variable.totalPost&&this.trackSecondPostBehavior(t))},setFacebookComment:function(t){var e=t.find(".fb-comment-box").eq(0);if(e.length){var i=e.attr("id"),n=e.data("href")||i;this.variable.totalPost>1&&(this.variable.totalPost+1)%3==0&&new Waypoint({element:e,handler:function(t){FB&&FB.XFBML&&FB.XFBML.parse(),this.destroy()},offset:"200%"}),ga("require","impressionTracker",{elements:[{id:i,threshold:.5}],fieldsObj:{hitType:"event",eventCategory:"WebFacebookCommentImpression",eventAction:n,eventLabel:null,nonInteraction:!0}})}},trackSecondPostBehavior:function(t){var e=t.data("id").toString(),i=t.data("url").toString(),n=this.parent.getPostInfoValue("is_sponsor",e),a=this.parent.getPostSEOTitle(e),o=this.parent.getOrder(e),r=this.parent.getPostUrl(!0,i),s=this.parent.getAllPostInfoIds()[0],l=n?"InfiniteFirstPostView[S]":"InfiniteFirstPostView";ga("send","event",l,e,s,o,{title:a,page:r,nonInteraction:!0}),new Waypoint({element:t.find(".article-title-box").eq(0),handler:function(t){var i=n?"InfiniteSecondTitleView[S]":"InfiniteSecondTitleView";"down"==t&&(ga("send","event",i,e,s,o,{title:a,page:r,nonInteraction:!0}),this.destroy())},offset:"bottom-in-view"}),new Waypoint({element:t.find(".article-img-box").eq(0),handler:function(t){var i=n?"InfiniteSecondImageView[S]":"InfiniteSecondImageView";"down"==t&&(ga("send","event",i,e,s,o,{title:a,page:r,nonInteraction:!0}),this.destroy())}})},setPostHitViewportTop:function(t){var e=this;new Waypoint({element:t,handler:function(t){var i=this.element;e.setCurrentPage(i.data("id").toString(),i.data("url").toString())}})},setPostContentHitViewportTop:function(e){var i=this,n=e.data("id").toString(),a=e.data("url").toString(),o=i.parent.getPostInfoValue("is_sponsor",n),r=i.parent.getPostSEOTitle(n),s=i.parent.getOrder(n),l=i.parent.getAllPostInfoIds()[0],d=i.parent.getPostUrl(!0,a);new Waypoint({element:e.find(".article-main-box").eq(0),handler:function(e){if("down"==e){if(2==s){var i=o?"InfiniteSecondArticleView[S]":"InfiniteSecondArticleView";ga("send","event",i,n,l,s,{title:r,page:d,nonInteraction:!0})}if(o&&t.analytics.sendGreedySnakeTrack("sponsor_real_read","sponsorRead",{page_id:n,position:s.toString()}),!o)try{fbq("track","Lead")}catch(t){console.log(t)}this.destroy()}}})},setPostHitViewportBottom:function(t){var e=this;new Waypoint({offset:"bottom-in-view",element:t,handler:function(t){var i=this.element;switch(e.setCurrentPage(i.data("id").toString(),i.data("url").toString()),t){case"up":break;case"down":e.parent.$.$postsContainer.find(".article-zone").eq(e.parent.getOrder()+2).length||e.fetchInfiniteScrollPost(),e.parent.hideTopInfoBar()}}})},getSponsorContentOrNormalURL:function(){var t=this.getNormalContentURL();return 1===this.variable.hitAjaxTimes&&Math.random()<this.variable.sponsorContentPercentage&&(t=this.getSponsorContentURL()),t},getSponsorContentURL:function(){return t.article.tools.getInfiniteScrollUrl(this.parent.variable.currentPageId,this.variable.hitAjaxTimes,!0)},getNormalContentURL:function(){return t.article.tools.getInfiniteScrollUrl(this.parent.variable.currentPageId,this.variable.hitAjaxTimes)}},dableBox:{parent:null,variable:{type:""},init:function(t){console.log("dableBox!!"),this.parent=t,this.prepare()},prepare:function(){this.parent.$.App.find(".progress-next").hide(),this.parent.$.$loaderContainer.hide();var t=this.parent.$.$posts.eq(0);this.parent.setPostHeightAndOffsetAndDOM(t),this.parent.setPostReadingTrack(t),this.parent.setReadingTrackRecord(t),this.parent.$.App.find(".article-relative-container").hide(),this.parent.$.App.find("._popIn_recommend").show()}},popinBox:{parent:null,variable:{type:""},init:function(t){console.log("popinBox!!"),this.parent=t,this.prepare()},prepare:function(){this.parent.$.App.find(".progress-next").hide(),this.parent.$.$loaderContainer.hide();var t=this.parent.$.$posts.eq(0);this.parent.setPostHeightAndOffsetAndDOM(t),this.parent.setPostReadingTrack(t),this.parent.setReadingTrackRecord(t),this.parent.$.App.find(".article-relative-container").hide(),this.parent.$.App.find("._popIn_recommend").show()}},relatedBox:{parent:null,variable:{type:""},init:function(t){this.parent=t,this.test(),this.relatedPreparation(),this.fetchRelatedBox()},test:function(){console.log("Related Box Time")},relatedPreparation:function(){this.parent.$.App.find(".progress-next").hide(),this.parent.$.$loaderContainer.hide(),this.sendPreparationAnalytics();var t=this.parent.$.$posts.eq(0);this.parent.setPostHeightAndOffsetAndDOM(t),this.parent.setPostReadingTrack(t),this.parent.setReadingTrackRecord(t);var e,i;e=window.location.search,e.split("?").length>1&&(i=e.split("?")[1].split("&"),i.indexOf("tnl-type=tag")>-1?this.variable.type="tag":i.indexOf("tnl-type=also_read")>-1?this.variable.type="also_read":i.indexOf("tnl-type=fb_hot")>-1&&(this.variable.type="fb_hot"))},sendPreparationAnalytics:function(){var t=this.parent.getPostUrl(!0),e=this.parent.getPostInfoValue("page_id"),i=this.parent.getAllPostInfoIds()[0],n=this.parent.getOrder();ga("send","event","related_view",e,i,n,{page:t,nonInteraction:!0})},sendAfterFetchAnalytics:function(){var e=this.variable.type;t.analytics.sendGreedySnakeTrack("recommend_pv","thenewslens",{r_type:e})},fetchRelatedBox:function(){this.parent.variable.ajaxReady&&$.ajax({type:"GET",url:this.getRelatedBoxURL(),data:{device:t.device.getDeviceType(),force:this.variable.type},contentType:"application/json"}).success(function(t){this.afterFetchProcession(t)}.bind(this))},afterFetchProcession:function(t){var e=this;$(t.html).each(function(){var t=$(this);e.variable.type=t.data("recommendType"),e.parent.$.$postsContainer.append(t)}),e.parent.$.App.find(".article-relative-container").hide(),console.log("recommend type:"+e.variable.type),this.sendAfterFetchAnalytics()},getRelatedBoxURL:function(){return t.article.tools.getRelatedBoxURL(this.parent.variable.currentPageId)}}}}("undefined"!=typeof Tnl?Tnl:this.Tnl={});
!function(e){e.article=e.article||{},e.article.common=e.article.common||{},e.article.common=function(e){this.$.App=e},e.article.common.prototype={constructor:e.article.common,$:{},variable:{},init:function(){document.getElementById("tnl-article-normal"),this.bind(),this.action(),this.bind18x(),this.listenEditorStaticMessage(),this.listenBackendScrollMessage(),this.listenEmbedlyMessage(),this.sendBackendScrollMessage()},listenEmbedlyMessage:function(){function e(e){if(!e.data||"string"!=typeof e.data)return!1;var t;try{t=JSON.parse(e.data)}catch(e){return!1}var n=document.querySelector("iframe");if(!n||"iframe.resize"!==t.context)return!1;null===(n=document.querySelector("iframe[src='"+t.src+"']"))&&(n=document.querySelector("iframe[src='"+t.src.replace(/^https?:\/\//,"//")+"']"));var i=t.height;n.offsetWidth;n.height=i}window.addEventListener("message",e,!1)},listenEditorStaticMessage:function(){function e(e){if("https://editor-static.thenewslens.com"===e.origin){var t=JSON.parse(e.data),n=t.height,i=t.src;document.querySelectorAll("iframe[src='"+i+"']")[0].height=n}}window.addEventListener("message",e,!1)},listenBackendScrollMessage:function(){function e(e){if("http://tnl.back.dev"===e.origin||"http://admin.thenewslens.com"===e.origin){var t=JSON.parse(e.data);if("scroll"===t.message){var n=t.x;document.documentElement.scrollTop=document.body.scrollTop=n}}}window.addEventListener("message",e,!1)},sendBackendScrollMessage:function(){if(e.dom.isInFrame()){var t=document.referrer,n=t.split("/"),i=n[0],o=n[2],a=i+"//"+o;if(t.search("http://tnl.back.dev")===-1&&t.search("http://admin.thenewslens.com")===-1)return;window.addEventListener("scroll",function(e){var t=document.documentElement.scrollTop||document.body.scrollTop,n=JSON.stringify({message:"scroll",x:t,url:document.location.href});window.parent.postMessage(n,a)})}},action:function(){if(Cookies){var t=Cookies.get("font_size_favorite");t&&this.changeArticleFontStyle(t),tnlInfo&&tnlInfo.page_id&&tnlInfo.page_id==e.variable.member.tutorial_article_id&&Cookies.set("is_read_member_tutorial_article",1,{expires:9999,domain:"."+e.url.getDomain()})}if($(".FormsBox").length>0){var n=!1;if($(".FormsBox").each(function(){""==$(this).html()&&$(this).data("forms_id")>0&&(n=!0)}),n){var i=document.createElement("script");i.setAttribute("type","text/javascript"),i.setAttribute("src","/js/FormsScripts/script.js"),document.getElementsByTagName("head")[0].appendChild(i)}}},changeArticleFontStyle:function(t){var n,i="";switch(t){case"giant-font":n="giant-font",i="big-font huge-font giant-font";break;case"huge-font":n="huge-font",i="big-font huge-font";break;case"big-font":n="big-font",i="big-font";break;default:case"normal-font":n="normal-font",e.$.$body.removeClass("big-font huge-font giant-font")}e.$.$body.addClass(i),Cookies&&Cookies.set("font_size_favorite",n,{expires:180,domain:e.url.getCookieDomain(),path:"/"})},bind:function(){var t=this;this.bindCollection.wineLegal.init(this);try{fbq("track","AddToWishlist",{domain:"www",category:tnlInfo.main_category})}catch(e){console.log(e)}e.$.$document.on("click",".more-tags",function(t){e.Util.eventStop(t);var n=$(this);n.prev().find("a").removeClass("beforehidden").show(),n.parent().hasClass("visible-xs")&&n.prev().attr("class","tags-active"),n.hide()}),e.$.$document.on("click",".restricted-img",function(t){e.Util.eventStop(t),$(this).removeClass("restricted-img")}),e.$.$document.on("click",".article-next",function(t){e.Util.eventStop(t);var n=$(this).parents("a").attr("href"),i=$(this).parents(".article-zone").data("id");ga("send","event","ArticleCategoryClick",i,{hitCallback:function(){window.location.href=n}})}),e.$.$document.on("submit",".post-subscribe",function(t){t.preventDefault(),e.$.$document.off("submit",".post-subscribe");var n=$(this);ga("send","event","SubscribeSubmit","Article",{hitCallback:function(){n.submit()}})}),e.$.$document.on("click",".morecommentsbtn",function(e){console.log(e);var t=$(this),n=t.data("id");t.remove(),document.getElementById("comment-"+n).contentWindow.resetHeight()}),e.$.$document.on("click",".commentsbtn",function(n){e.Util.eventStop(n);var i=$(this),o=i.data("url"),a=i.data("title"),s=i.height();if("guavanthropology"==i.data("user"))return i.find("span").text("此作者不提供留言功能"),!1;if(window.DISQUS)$old_disqus=t.$.App.find("#disqus_thread"),$old_disqus.parent().css({"margin-bottom":$old_disqus.height()-s}).addClass("more-box").find(".commentsbtn").show(),$old_disqus.insertAfter(i),DISQUS.reset({reload:!0,config:function(){this.page.url=o,this.page.title=a,this.callbacks.onReady.push(function(){Waypoint.refreshAll()})}});else{$('<div id="disqus_thread"></div>').insertAfter(i),disqus_url=o,disqus_title=a;var r=document.createElement("script");r.type="text/javascript",r.async=!0,r.src="https://"+disqus_shortname+".disqus.com/embed.js",$("head").append(r),Waypoint.refreshAll()}i.parent().removeClass("more-box").css({"margin-bottom":0}),i.hide()}),e.$.$document.on("click",".font-btn",function(n){e.Util.eventStop(n),e.$.$body.hasClass("giant-font")?t.changeArticleFontStyle("normal-font"):e.$.$body.hasClass("huge-font")?t.changeArticleFontStyle("giant-font"):e.$.$body.hasClass("big-font")?t.changeArticleFontStyle("huge-font"):t.changeArticleFontStyle("big-font")}),e.$.$document.on("click",".speak-to-you",function(t){function n(e,t){e.html('<audio src="'+t+'" style="max-width:173px;" controls></audio>'),c.hide(),e.removeClass("speak-to-you")}e.Util.eventStop(t);var i=/(http|https):\/\/(\w+:{0,1}\w*)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%!\-\/]))?/,o=$(this),a=o.data("mp3"),s=o.data("pid"),r=o.find(".LTTA-text"),c=o.find(".LTTA-loader");e.analytics.sendEvent("tts","click",s,1),r.hide(),c.show(),i.test(a)?n(o,a):$.ajax({url:"//admin.thenewslens.com/"+s+"/gettingMp3",dataType:"jsonp",type:"GET"}).done(function(e){n(o,e.mp3)})}),e.$.$document.on("initBeforeAfterImage",function(e){t.initBeforeAfterImage()}),e.$.$window.on("resize",function(e){t.initBeforeAfterImage()}),e.$.$document.ready(function(){t.initBeforeAfterImage()}),this.bindBeforeAfterImage(),this.bindPhotoSwipe(),e.$.$document.on("click",".footnote-a, .footnote-back",function(e){e.preventDefault();var t=$(this),n=t.attr("href"),i=$(n),o=t.offset().top-t.parent().parent().offset().top+25;if("footnote-back"==t.attr("class"))return void t.parent().fadeOut(450);i.css("top",o),i.fadeToggle(450)})},bindCollection:{wineLegal:{parent:null,$:{},init:function(e){this.parent=e,this.setWineLegal()},setWineLegal:function(){var t=this,n=tnlInfo.tags_array;tnlInfo&&tnlInfo.tags_array&&(this.$.$wineLegalContainer&&this.$.$wineLegalContainer.length?e.Util.inArray(e.Config.variable.wineLegalTagName,n)?this.$.$wineLegalContainer.removeClass("wine-legal-disable").show():this.$.$wineLegalContainer.addClass("wine-legal-disable").show():e.Util.inArray(e.Config.variable.wineLegalTagName,n)&&e.API.Setting.Template.getTemplate("isWineLegal",function(n){n&&n.result&&n.result.view&&(e.$.$body.append(n.result.view),t.$.$wineLegalContainer=e.$.$document.find("#tnl-wine-legal"),t.$.$wineLegalContainer.length&&t.setWineLegal())}))}}},initBeforeAfterImage:function(){var e,t,n,i=this,o="rect(0px {right}px {bottom}px 0px)";this.$.ImageBeforeAfter={},this.$.ImageBeforeAfterList=$(".img-switch-box"),i.$.ImageBeforeAfterList.length&&i.$.ImageBeforeAfterList.each(function(a,s){s.dataset.ibas_position=a,i.$.ImageBeforeAfter[a]={},i.$.ImageBeforeAfter[a].section=i.$.ImageBeforeAfterList.eq(a),i.$.ImageBeforeAfter[a].first_image=i.$.ImageBeforeAfter[a].section.find("img:first-child"),i.$.ImageBeforeAfter[a].controller=i.$.ImageBeforeAfter[a].section.find(".img-controller"),e=i.$.ImageBeforeAfter[a].section.width(),t=i.$.ImageBeforeAfter[a].section.height(),n=o.replace("{right}",e/2),n=n.replace("{bottom}",t),i.$.ImageBeforeAfter[a].first_image.css("clip",n),i.$.ImageBeforeAfter[a].controller.css("left",e/2+"px")})},bind18x:function(){!store.get("alreadyAdult")&&tnlInfo&&tnlInfo.x18&&e.API.Setting.Template.getTemplate("isAdultMask",function(t){if(t&&t.result&&t.result.view){e.$.$body.append(t.result.view);var n=e.$.$document.find("#adult-check-section");n.fadeIn(700),e.$.$body.addClass("non-scroll"),e.$.$document.on("click",".already-18x",function(){n.fadeOut(700),e.$.$body.removeClass("non-scroll"),store.set("alreadyAdult",!0)}),e.$.$document.on("click",".not-yet-18x",function(){window.history.back()})}})},bindBeforeAfterImage:function(){var t,n,i,o=this,a=!1,s="rect(0px {right}px {bottom}px 0px)";e.$.$document.on("touchstart mousedown",".img-controller",function(e){a=!0}),e.$.$document.on("touchend touchcancel mouseup",".img-controller",function(e){a=!1}),e.$.$document.on("mouseleave mouseup",".img-switch-box",function(e){a=!1}),e.$.$document.on("mousemove touchmove",".img-switch-box",function(r){if(!a)return!1;if((n=this.dataset.ibas_position)&&o.$.ImageBeforeAfter[n]){i=o.$.ImageBeforeAfter[n],t=e.Util.pointerEventToXY(r);var c=t.x-i.first_image.offset().left,l=i.first_image.height(),f=i.first_image.width();c<=0&&(a=!1,c=0),c>=f&&(a=!1,c=f),cssRect=s.replace("{right}",c),cssRect=cssRect.replace("{bottom}",l),i.first_image.css("clip",cssRect),i.controller.css("left",c+"px")}})},bindPhotoSwipe:function(){var t=this,n=!1;e.$.$document.on("click",".article-img-container img:not(a img)",function(i){if(n)return n;n=!0,e.Util.eventStop(i);var o,a=$(this),s=a.attr("src-org"),r=a.attr("src-lg"),c="",l=$(window).height(),f=[];t.fetchPhotoSwipeTemplate(function(){switch(o||(o=document.querySelectorAll(".pswp")[0]),e.device.getDeviceType()){case"phones":c=r;break;case"desktops":c=s;break;default:console.log("DD")}e.Util.getImgSize(c,function(e){var t=e.width,i=e.height;f.push({src:c,w:t,h:i});var a=l/i,s={getDoubleTapZoom:function(e,t){return a}},r=new PhotoSwipe(o,PhotoSwipeUI_Default,f,s);r.init(),r.zoomTo(a,{x:r.viewportSize.x/2,y:r.viewportSize.y/2}),n=!1})})})},fetchPhotoSwipeTemplate:function(t){var n=this;this.$.PhotoSwipeSection?t&&t():e.API.Setting.Template.getTemplate("photo-swipe",function(i){i&&i.result&&i.result.view&&(e.$.$body.append(i.result.view),n.$.PhotoSwipeSection=e.$.$document.find("#photo-swipe-section")),t&&t()})},bindVideoArticle:function(){},bindNormalArticle:function(){}}}("undefined"!=typeof Tnl?Tnl:this.Tnl={});
!function(n){n.article=n.article||{},n.article.normal=n.article.normal||{},n.article.normal=function(n){this.$.App=n},n.article.normal.prototype={constructor:n.article.normal,$:{},variable:{},init:function(){this.analytics()},bind:function(){},analytics:function(){ga("set","dimension1",tnlInfo.author_name),ga("send","event","visit","author",tnlInfo.author_name,1,{nonInteraction:!0}),ga("set","dimension2",tnlInfo.main_category),ga("send","event","visit","category",tnlInfo.main_category,1,{nonInteraction:!0}),ga("send","event","visit","classification",tnlInfo.post_type,1,{nonInteraction:!0}),tnlInfo.post_type_keyword&&ga("send",{hitType:"event",eventCategory:"ArticleTypeVisit",eventAction:tnlInfo.post_type_keyword,eventLabel:null,nonInteraction:!0});try{fbq("track","ViewContent")}catch(n){console.log(n)}}},n.$.$document.ready(function(){var t=n.$.$document.find("#tnl-article-normal");t.length&&(n.article.common=new n.article.common(t),n.article.common.init(),n.article.normal=new n.article.normal(t),n.article.normal.init(),n.article.recommend=new n.article.recommend(t),n.article.recommend.init())})}("undefined"!=typeof Tnl?Tnl:this.Tnl={});
!function(e){e.article=e.article||{},e.article.video=e.article.video||{},e.article.video=function(e){this.$.App=e},e.article.video.prototype={constructor:e.article.video,$:{},variable:{reading_track_interval_num:4,reading_track:[]},init:function(){this.initTracking(),this.initDom(),this.analytics(),this.bind()},initDom:function(){this.$.$videoArticleContainer=this.$.App.find("#tnl-video-article-container"),this.$.$videoArticleContent=this.$.$videoArticleContainer.find("article"),"desktops"==e.device.getDeviceType()&&(this.$.videoPlayer=this.$.App.find("#tnl-article-video-player"),this.$.videoPlayerBox=this.$.videoPlayer.parent(),this.$.videoPlayerBox.height(this.$.videoPlayer.height()),this.scrollAndPlayRightBottom())},initTracking:function(){for(var e=this.variable.reading_track_interval_num,i=1;i<e;i++)this.variable.reading_track.push({threshold:(i/e*100).toFixed(0),isTrigger:!1})},bind:function(){this.bindCollection.ScrollProgress.init(this)},sendReadingTrackAnalytics:function(i,t){e.analytics.sendGreedySnakeTrack(i,"readProgress",t)},bindCollection:{ScrollProgress:{parent:null,init:function(e){this.parent=e,this.bindScrollProgress(),this.bindPostReadingTrack()},bindPostReadingTrack:function(){var e=this.parent;new Waypoint({offset:"100%",element:e.$.$videoArticleContainer,handler:function(i){var t=tnlInfo.page_id;switch(i){case"up":break;case"down":console.log("[RT]-PV",t),e.sendReadingTrackAnalytics("progress",{type:"pv",page_id:t})}this.destroy()}}),new Waypoint({offset:"100%",element:e.$.$videoArticleContainer.find("article"),handler:function(i){var t=tnlInfo.page_id;switch(i){case"up":break;case"down":console.log("[RT]-META",t),e.sendReadingTrackAnalytics("progress",{type:"meta",page_id:t})}this.destroy()}}),new Waypoint({offset:"bottom-in-view",element:e.$.$videoArticleContainer.find("article"),handler:function(i){var t=tnlInfo.page_id;switch(i){case"up":break;case"down":console.log("[RT]-FOOTER",t),e.sendReadingTrackAnalytics("progress",{type:"footer",page_id:t})}this.destroy()}})},bindScrollProgress:function(){var i=this.parent,t=e.Bind.Progressbar.init(),n=i.$.$videoArticleContainer.scrollTop(),o=i.$.$videoArticleContainer.height()-e.$.$window.outerHeight();e.$.$document.on("scroll",function(){var r=e.$.$window.scrollTop()-n,a=r/o*100;t.setReadPercent(a);var l=i.$.$videoArticleContent.height(),c=i.$.$videoArticleContent.offset().top,s=e.$.$window.scrollTop()-c,d=s/l*100,h=tnlInfo.page_id;_.each(i.variable.reading_track,function(e,t){if(!e.isTrigger&&d>e.threshold){console.log("[RT]-REACH"+e.threshold,h,s,l*e.threshold/100,l);e.threshold;i.sendReadingTrackAnalytics("progress",{type:"c_"+e.threshold,page_id:h,y:s,full:l}),i.variable.reading_track[t].isTrigger=!0}})})}}},analytics:function(){var e=this.$.App.data("typekeyword");e&&ga("send","event","ArticleTypeVisit",e,null,{nonInteraction:!0}),fbq("track","ViewContent")},scrollAndPlayRightBottom:function(){var e=this;new Waypoint.Inview({element:e.$.videoPlayerBox,enter:function(i){"up"==i&&e.$.videoPlayer.removeAttr("style")},exited:function(i){"down"==i&&e.$.videoPlayer.css({position:"fixed",bottom:"30px",left:"30px",width:"400px",zIndex:"1000"})}})}},e.$.$document.ready(function(){var i=e.$.$document.find("#tnl-article-video");i.length&&(e.article.common=new e.article.common(i),e.article.common.init(),e.article.video=new e.article.video(i),e.article.video.init())})}("undefined"!=typeof Tnl?Tnl:this.Tnl={});
!function(e){e.article=e.article||{},e.article.feature=e.article.feature||{},e.article.feature=function(e){this.$.App=e},e.article.feature.prototype={constructor:e.article.feature,$:{$ProjectInnerTitleBox:null,$ProjectInnerNaviBox:null,$ScrollProgressBar:null,$listBox:null,$list:null,$posts:null,$container:null,$next:null,$titleBar:null,$mobileBtn:null,$mobileBox:null,$mobileBar:null,$progressContainer:null,$progressShare:null,$loader:null,$wineLegalContainer:null},variable:{ajaxReady:!0,scrollReady:!0,feature_slug:"",allPostInfo:[],$dfp_advertisement:[],currentPageId:null,starTravel:"macau2016",loadPosition:null,readingTrackIntervalNum:4,wineLegalTagName:"未滿十八歲請勿飲酒"},init:function(){sessionStorage.removeItem("page"),sessionStorage.removeItem("type"),sessionStorage.removeItem("date"),e.Util.forceRefreshInitScrollTop(),this.initDOM(),this.bind(),this.initVar(),this.scrollListBox(),this.variable.feature_slug==this.variable.starTravel&&this.initStarTravelForm(),this.initFeatureArticle(),this.setWineLegal(),this.setTopRecommendArticle()},initVar:function(){var t=this;this.variable.feature_slug=this.$.$list.eq(0).data("id"),this.$.$list.each(function(){var i=$(this),o=i.data("id")||"";e.Util.isNumber(o)||(o="");var a=i.data("typekeyword")||"",r=i.clone().children().remove().end().text().trim();tnlInfo!=={}&&o==tnlInfo.page_id&&t.setPostInfo(tnlInfo),t.setPostInfo({page_id:o,post_title:r,post_type_keyword:a,is_display:!1}),i.hasClass("active-li")&&(t.variable.currentPageId=o)}),this.$.$posts.each(function(){var e=$(this),i=e.data("id")||"",o=e.data("posttypeid")||"",a=e.data("maincategoryid")||"",r=e.data("sponsor")||!1;t.setPostInfo({page_id:i,post_type_id:o,main_category_id:a,is_sponsor:r,is_display:!0})})},initDOM:function(){this.$.$ProjectInnerTitleBox=this.$.App.find(".projectInner-title-box"),this.$.$ProjectInnerNaviBox=this.$.App.find(".projectInner-navi-box"),this.$.$ScrollProgressBar=this.$.App.find(".scrollProgress-container"),this.$.$listBox=this.$.App.find(".projectInner-list-box"),this.$.$list=this.$.App.find(".projectInner-list-box li"),this.$.$posts=this.$.App.find(".projectBox"),this.$.$container=this.$.App.find(".projectInner-main-container"),this.$.$titleBar=this.$.App.find("#title-bar"),this.$.$loader=this.$.App.find("#tnl-project-loader"),this.$.$mobileBox=this.$.App.find(".projectInner-title-box"),this.$.$mobileBar=this.$.App.find(".mobile-project-bar"),this.$.$progressContainer=this.$.App.find("#scroll_progress_container"),this.$.$progressShare=this.$.App.find("#scroll_progress_container .progress-share"),this.$.$topZoneRelatedContainer=this.$.App.find("#topZone-related-container")},initStarTravelForm:function(){function e(){$(".projectBox").each(function(e,i){0==$(i).find(".startrvelForm").length&&$(i).find("footer").after(t)});var e=$("#travel-form").outerHeight()+"px";$(".travel-form").css("height",e)}var t="";$.get("/startravel/form.html",function(i){t=i,e()})},initFeatureArticle:function(){var e=this;this.$.$posts.each(function(){var t=$(this);e.processEachHTMLDOM(t)})},bind:function(){this.variable.loadPosition=e.$.$window.scrollTop();var t=this,i=0,o=this.variable.loadPosition+150,a=this.variable.loadPosition-50;e.$.$document.on("click",".fa-th-list-desktop",function(){t.variable.loadPosition=e.$.$window.scrollTop(),o=t.variable.loadPosition+350,a=t.variable.loadPosition-250,t.$.$ProjectInnerTitleBox.toggleClass("projectInner-title-box-hide")}),e.$.$document.on("scroll",function(){if(t.variable.scrollReady){e.$.$window.scrollTop()>i?t.showTopInfoBar():t.hideTopInfoBar(),i=e.$.$window.scrollTop();var r=t.variable.currentPageId,n=t.getPostInfoValue("article_offset_top"),s=t.getPostInfoValue("article_height"),l=e.$.$window.scrollTop()+e.$.$window.outerHeight()-n,d=l/s*100,c=t.getPostInfoValue("reading_track");t.$.$topZoneRelatedContainer.length&&t.$.$topZoneRelatedContainer.is(":visible")&&t.$.$topZoneRelatedContainer.fadeOut(700),void 0!==c&&_.each(c,function(e,i){if(!e.isTrigger&&d>e.threshold){0===r.length&&(r=t.variable.feature_slug),console.log("[RT]-REACH"+e.threshold,r,l,s*e.threshold/100,s);e.threshold;r===t.variable.feature_slug&&(r=""),t.updateReadingTrackThresholdIsTrigger(e.threshold,r)}});var h,f,p=t.variable.$dfp_advertisement;for(var u in p)if(h=p[u],!h.is_processing&&!h.is_already_display){if(h.is_processing=!0,!h.$dom.offset())break;f=h.$dom.offset().top,window_offset_top=e.$.$window.scrollTop(),f-e.$.$window.height()-50<window_offset_top&&(e.advertisement.dfp.show(h.ad_group_list),h.is_already_display=!0,delete p[u]),h.is_processing=!1}var g=e.$.$window.scrollTop();(g>o||g<a)&&(g>700&&(t.$.$ProjectInnerNaviBox.removeClass("projectInner-navi-hide"),t.$.$ProjectInnerTitleBox.addClass("projectInner-title-box-hide")),g<700&&(t.$.$ProjectInnerNaviBox.addClass("projectInner-navi-hide"),t.$.$ProjectInnerTitleBox.removeClass("projectInner-title-box-hide")))}}),e.$.$document.on("click",".top_recommend_article_btn",function(i){e.Util.eventStop(i),t.$.$topZoneRelatedContainer.fadeToggle(700)}),e.$.$document.on("click",".travel-form-btn",function(){$(this).parent().find(".travel-form").toggleClass("closed")}),e.$.$document.on("submit",".startrvel-qa-form",function(){var e=$(this).find(".startrvel-btn"),t=$(this).parent().parent().parent(),i=$(this).find(".travel-error-area"),o=$(this).parent().parent().parent().next(".travel-form-btn");if(e.prop("disabled"))return!1;if(e.prop("disabled",!0),!$(this).find("input[name=agree1]").prop("checked"))return i.text("請同意燦星旅遊專人聯繫"),!1;if(!$(this).find("input[name=agree2]").prop("checked"))return i.text("請閱讀並同意「個資收集前告知事項」"),!1;var a,r={UserID:"TNSUser",UserPW:"!QAZ2wsx",CName:$(this).find("input[name=CName]").val(),TEL:$(this).find("input[name=TEL]").val(),EMail:$(this).find("input[name=EMail]").val(),PeopleNumber:$(this).find("input[name=PeopleNumber]").val(),PlanDate:"20161111"};return a=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),a.onreadystatechange=function(){if(4==a.readyState&&200==a.status){var r=$.parseJSON(a.responseText);r.IsSuccess?(console.log(JSON.stringify(a.responseText)),o.addClass("disabled"),t.toggleClass("closed"),t.remove()):(console.log(JSON.stringify(a.responseText)),console.log(r.Message),i.text(r.Message),e.prop("disabled",!1))}},a.open("POST","https://www.startravel.com.tw/startravel.web.api/api/TNS/AddCustomData",!0),a.setRequestHeader("Content-type","application/json"),a.send(JSON.stringify(r)),!1}),t.$.$list.on("click",function(){var e=$(this),i=e.data("order");t.$.$mobileBar.is(":visible")&&t.setMobilePostList(),console.log("cccc"),t.changeActivePostByClickOrder(i)}),e.$.$document.on("click",".projectInner-next",function(){var e=t.getOrder()+1;t.changeActivePostByClickOrder(e)}),e.$.$document.on("click",".project-menu-btn",function(){t.setMobilePostList()}),e.$.$document.on("click",".project-mobile-prev",function(){var e=t.getOrder()-1;t.changeActivePostByClickOrder(e)}),e.$.$document.on("click",".project-mobile-next",function(){var e=t.getOrder()+1;t.changeActivePostByClickOrder(e)}),e.$.$document.on("click",".progress-next",function(){var e=t.getOrder()+1;t.changeActivePostByClickOrder(e)}),e.$.$document.on("click","#navi_menu_next_article",function(){var e=t.getOrder()+1;t.changeActivePostByClickOrder(e)}),e.$.$document.on("click","#navi_menu_previous_article",function(){var e=t.getOrder()-1;t.changeActivePostByClickOrder(e)}),e.$.$document.on("click","#navi_menu_home_article",function(){t.changeActivePostByClickOrder(0)}),e.dom.scrollGuard(t.$.$listBox)},setTopRecommendArticle:function(){var t=this;t.$.$topZoneRelatedContainer.length&&e.$.$document.ready(function(){if(console.log("setTopRecommendArticle"),t.variable.currentPageId){var i,o=e.article.tools.getRelatedBoxURL(t.variable.currentPageId);search=window.location.search,search.split("?").length>1&&(params=search.split("?")[1].split("&"),params.indexOf("tnl-type=tag")>-1?i="tag":params.indexOf("tnl-type=also_read")>-1?i="also_read":params.indexOf("tnl-type=fb_hot")>-1&&(i="fb_hot")),$.ajax({type:"GET",url:o,data:{device:e.device.getDeviceType(),force:i,show:"top"},contentType:"application/json"}).success(function(e){var i=$(e.html),o=i.data("recommendType");console.log("top recommend type",o),t.$.$topZoneRelatedContainer.html(i)})}})},changeActivePostByClickOrder:function(t){if(void 0===t)throw new Error("No order in parameter can't change post");var i=this.getOrder(),o=this.getAllPostInfoIds().length-1;if(console.log(11111111),t!==i&&this.variable.scrollReady){this.variable.scrollReady=!1,t>o&&(e.$.$body.animate({scrollTop:$("#project-end").offset().top-50},700),setTimeout(function(){this.variable.scrollReady=!0}.bind(this),800)),console.log(22222222);var a=this.getPageIdByOrder(t);if(void 0===a)return void(this.variable.scrollReady=!0);if(this.getIsDisplayByOrder(t))this.setCurrentPageId(a),$("html, body").animate({scrollTop:$('.projectBox[data-order="'+t+'"]').offset().top-50},700,function(){this.variable.scrollReady=!0}.bind(this));else{e.$.$body.animate({scrollTop:e.$.$window.scrollTop()+1800},600),this.$.$container.animate({opacity:0},500,function(){e.$.$body.animate({scrollTop:55},0),this.$.$loader.show()}.bind(this));var r=t-1;this.fetchFeaturePost(r)}}},setMobilePostList:function(){this.$.$mobileBox.slideToggle(300),e.dom.stopScrollGuard(this.$.$listBox),e.dom.scrollGuard(this.$.$mobileBox),setTimeout(function(){this.$.$mobileBox.is(":visible")||this.$.$mobileBox.attr("style","")}.bind(this),300)},setTopInfo:function(){var e=this.getPostInfoValue("post_title");this.$.$titleBar.html((this.getPostInfoValue("is_sponsor")?'<span class="sponsored-info">【SPONSORED】</span>':"")+e),this.$.$progressShare.attr("data-title",e).attr("data-url",this.getPostUrl()),this.setFeatureActivePostList(),this.updatePostHeightAndOffset(),this.setWineLegal(),this.changePage()},setFeatureActivePostList:function(){this.$.$list.removeClass("active-li");var e=this.getOrder();this.$.$listBox.find('[data-order="'+e+'"]').addClass("active-li"),this.scrollListBox()},changePage:function(){History.replaceState(null,this.getPostSEOTitle(),this.getPostUrl(!0)),this.sendAnalyticsRecord()},setWineLegal:function(){var t=this,i=this.getPostInfoValue("tags_list");this.$.$wineLegalContainer&&this.$.$wineLegalContainer.length?e.Util.inArray(this.variable.wineLegalTagName,i)?this.$.$wineLegalContainer.removeClass("wine-legal-disable").addClass("wine-legal-feature").show():this.$.$wineLegalContainer.addClass("wine-legal-disable wine-legal-feature").show():e.Util.inArray(this.variable.wineLegalTagName,i)&&e.API.Setting.Template.getTemplate("isWineLegal",function(i){i&&i.result&&i.result.view&&(e.$.$body.append(i.result.view),t.$.$wineLegalContainer=e.$.$document.find("#tnl-wine-legal"),t.$.$wineLegalContainer.length&&t.setWineLegal())})},sendAnalyticsRecord:function(){if(this.sendRecordThrottle()){var t=this.getPostSEOTitle(),i=this.getPostUrl(),o=this.getPostUrl(!0),a=this.getPostInfoValue("page_id"),r=this.getPostInfoValue("post_type_keyword"),n=(this.getFeatureMainUrl(),this.getOrder()+1),s=this.getPostInfoValue("is_sponsor",a);e.analytics.getInfo("view",n,this.getPostInfoObject()),s&&e.analytics.sendGreedySnakeTrack("sponsor_pv","sponsorRead",{page_id:a,position:n.toString()}),ga("send","pageview",{title:t,location:i,page:o}),""!==r&&ga("send",{hitType:"event",eventCategory:"ArticleTypeVisit",eventAction:r,eventLabel:null,nonInteraction:!0})}},AMEendReadingTrackAnalytics:function(t,i){e.analytics.sendGreedySnakeTrack(t,"readProgress",i)},sendRecordThrottle:function(e){e=e||this.variable.currentPageId;var t=this.getPostInfoValue("send_timestamp"),i=+new Date;return(!t||i>t+1e3)&&(this.setPostInfo({page_id:e,send_timestamp:i}),!0)},updateDOM:function(){this.$.$posts=this.$.App.find(".projectBox")},showTopInfoBar:function(){this.$.$progressContainer.hasClass("fadeOut")||this.$.$progressContainer.addClass("fadeOut")},hideTopInfoBar:function(){this.$.$progressContainer.hasClass("fadeOut")&&this.$.$progressContainer.removeClass("fadeOut")},getAllPostInfoIds:function(){return _.pluck(this.variable.allPostInfo,"page_id")},getOrder:function(e){e=void 0===e?this.variable.currentPageId:e;var t=this.getAllPostInfoIds().indexOf(e.toString());if(t===-1)throw new Error("can't find this page id");return t},getPostSEOTitle:function(e){e=void 0===e?this.variable.currentPageId:e;var t,i,o=this.getPostInfoValue("post_title",e.toString());switch(t=window.location.host.split("."),t[0]){case"hk":case"www":case"asean":i="The News Lens 關鍵評論網";break;case"international":i="The News Lens International Edition"}return o+" - "+i},getFeatureMainUrl:function(e){e=e||!1;var t=this.variable.feature_slug;return e?"/feature/"+t:window.location.origin+"/feature/"+t},getPostUrl:function(e,t){e=e||!1,t=void 0===t?this.variable.currentPageId:t;var i=this.variable.feature_slug;return e?"/feature/"+i+(""==t?"":"/"+t):window.location.origin+"/feature/"+i+(""==t?"":"/"+t)},getPostInfoObject:function(e){e=void 0===e?this.variable.currentPageId:e;var t=_.where(this.variable.allPostInfo,{page_id:e.toString()});if(!t.length)throw new Error("can't find this page id info");return t[0]},getPostInfoValue:function(e,t){t=void 0===t?this.variable.currentPageId:t;var i=this.getPostInfoObject(t.toString());return void 0!==i[e]?i[e]:""},getIsDisplayByOrder:function(e){if(void 0===e)throw new Error("Must pass order in parameter");return _.pluck(this.variable.allPostInfo,"is_display")[e]},getPageIdByOrder:function(e){if(void 0===e)throw new Error("Must pass order in parameter");return this.getAllPostInfoIds()[e]},setCurrentPageId:function(t){if(t=t.toString(),e.Util.isNumber(t)||(t=""),this.variable.currentPageId!==t){var i=this.variable.currentPageId;this.variable.currentPageId=t,null!=i&&this.setTopInfo()}},setPostInfo:function(t){if(void 0===t.page_id)throw new Error("not include page id");t.page_id=t.page_id.toString(),e.Util.isNumber(t.page_id)||(t.page_id=""),this.getAllPostInfoIds().indexOf(t.page_id)>-1?this.variable.allPostInfo[this.getAllPostInfoIds().indexOf(t.page_id)]=_.extend(this.variable.allPostInfo[this.getAllPostInfoIds().indexOf(t.page_id)],t):this.variable.allPostInfo.push(t)},setPostHeightAndOffsetAndDOM:function(t){var i=t.find("article").eq(0);this.setPostInfo({page_id:t.data("id").toString(),height:t.height()-e.$.$window.outerHeight(),offset_top:t.offset().top,article_height:i.height(),article_offset_top:i.offset().top,$DOM:t})},updatePostHeightAndOffset:function(t){t=void 0===t?this.variable.currentPageId:t;var i=this.getPostInfoValue("$DOM",t),o=i.find("article").eq(0),a=this.getPostInfoValue("offset_top",t),r=this.getPostInfoValue("height",t),n=this.getPostInfoValue("article_height",t),s=this.getPostInfoValue("article_offset_top",t);a!==i.offset().top||r!==i.height()-e.$.$window.outerHeight()||n!==o.height()||s!==o.offset().top?(this.setPostInfo({page_id:i.data("id"),height:i.height()-e.$.$window.outerHeight(),offset_top:i.offset().top,article_height:o.height(),article_offset_top:o.offset().top}),console.log("NOT SAME")):console.log("SAME")},setReadingTrackRecord:function(e){for(var t=e.data("id").toString(),i=this.variable.readingTrackIntervalNum,o=[],a=1;a<i;a++)o.push({threshold:(a/i*100).toFixed(0),isTrigger:!1});this.setPostInfo({page_id:t,reading_track:_.indexBy(o,"threshold")})},setPostReadingTrack:function(e){var t=this;new Waypoint({offset:"100%",element:e,handler:function(i){if(t.variable.scrollReady){var o=(this.element,e.data("id").toString());switch(i){case"up":break;case"down":console.log("[RT]-PV",o)}this.destroy()}}}),new Waypoint({offset:"100%",element:e.find("article").eq(0),handler:function(e){if(t.variable.scrollReady){var i=(this.element,t.variable.currentPageId);switch(0===i.length&&(i=t.variable.feature_slug),e){case"up":break;case"down":console.log("[RT]-META",i)}this.destroy()}}}),new Waypoint({offset:"bottom-in-view",element:e.find("article").eq(0),handler:function(e){if(t.variable.scrollReady){var i=(this.element,t.variable.currentPageId);switch(0===i.length&&(i=t.variable.feature_slug),e){case"up":break;case"down":console.log("[RT]-FOOTER",i)}this.destroy()}}})},updateReadingTrackThresholdIsTrigger:function(e,t){t=void 0===t?this.variable.currentPageId:t;var i=this.getPostInfoValue("reading_track",t);if(void 0===i[e])throw new Error("Reading Track Threshold Not Corrected");i[e].isTrigger=!0,this.setPostInfo({page_id:t,reading_track:i})},scrollListBox:function(){var t=this.$.$listBox,i=t.find(".active-li");e.dom.scrollTo(t,i)},beforeFetchPreparation:function(){this.variable.ajaxReady=!1},fetchFeaturePost:function(e){this.variable.ajaxReady&&(this.beforeFetchPreparation(),$.ajax({type:"GET",url:this.getFeatureRequestURL(e),data:{html:1},contentType:"application/json"}).success(function(e){this.afterFetchProcession(e)}.bind(this)))},afterFetchProcession:function(t){if("error"!==t.status&&""!==t.html){var i=this,o=null;$(t.html).each(function(){var t=$(this),a=t.find(".projectBox");if(void 0!==a.data("id")){var r=a.data("id").toString();if(e.Util.isNumber(r)||(r=""),null==o&&(o=r),i.getPostInfoValue("is_display",r))return}i.processEachHTMLDOM(t)}),void 0!==t.last&&0==$("#project-end").length&&i.$.$container.append(t.last);var a;if(_.each(t.dfp_advertisement_config_list,function(e){_.each(e,function(t,o){a=e[o].ad_slot_id,i.variable.$dfp_advertisement[a]={$dom:$("#"+a),ad_group_list:e[o],is_processing:!1,is_already_display:!1}})}),this.variable.scrollReady)this.variable.ajaxReady=!0;else{this.setCurrentPageId(o);var r=this.getOrder();e.$.$body.animate({scrollTop:$('.projectBox[data-order="'+r+'"]').offset().top-50},400,function(){i.$.$loader.hide()}),i.$.$container.animate({opacity:1},800,function(){Waypoint.refreshAll(),i.variable.ajaxReady=!0,i.variable.scrollReady=!0})}}},processEachHTMLDOM:function(e){var t=e.hasClass("projectBox")?e:e.find(".projectBox"),i=this,o=t.data("id");if(!this.$.$container.find("#"+t.attr("id")).length){var a=t.data("order"),r=0;this.updateDOM(),this.$.$posts.each(function(){r++;var t=$(this),o=t.data("order");if(o>a)return t.parent().before(e),!1;o<a&&r==i.$.$posts.length&&t.parent().after(e)});var n=t.data("sponsor")||!1;i.setPostInfo({page_id:o,is_display:!0,is_sponsor:n})}if(t.hasClass("projectBox")){this.setPostHeightAndOffsetAndDOM(t),this.setPostHitViewportTop(t),this.setPostHitViewportBottom(t),this.setReadingTrackRecord(t),this.setPostReadingTrack(t);var s=[];t.find(".topic-tags-zone a").each(function(){var e=$(this);s.push(e.text())}),i.setPostInfo({page_id:o,tags_list:s})}},setPostHitViewportTop:function(e){var t=this;new Waypoint({element:e,handler:function(e){if(t.variable.scrollReady){var i=this.element;t.setCurrentPageId(i.data("id").toString())}}})},setPostHitViewportBottom:function(e){var t=this;new Waypoint({element:e,offset:"bottom-in-view",handler:function(e){if(t.variable.scrollReady){var i=this.element;t.setCurrentPageId(i.data("id").toString()),"up"==e||"down"==e&&t.needFetchFeatureByScroll()&&t.fetchFeaturePost()}}})},needFetchFeatureByScroll:function(e){if((e=e||this.getOrder())<this.variable.allPostInfo.length){if(this.getIsDisplayByOrder(e+2)===!1)return this.$.$loader.show(),!0;if(this.getIsDisplayByOrder(e+1)===!1)return this.$.$loader.show(),!0}return!1},getLastIsDisplayOrder:function(){var e=_.pluck(this.variable.allPostInfo,"is_display"),t=e.length,i=e.reverse(),o=null;return _.each(i,function(e,t){e&&!o&&(o=t)}),t-o-1},getFeatureRequestURL:function(t){var i=this.variable.feature_slug;return t=void 0===t?this.getLastIsDisplayOrder():t,e.article.tools.getFeatureURL(i,t)}},e.$.$document.ready(function(){var t=e.$.$document.find("#tnl-article-project");t.length&&(e.article.common=new e.article.common(t),e.article.common.init(),e.article.feature=new e.article.feature(t),e.article.feature.init())})}("undefined"!=typeof Tnl?Tnl:this.Tnl={});
!function(e){e.article=e.article||{},e.article.featureArticle=e.article.featureArticle||{},e.article.featureArticle=function(e){this.$.App=e},e.article.featureArticle.prototype={constructor:e.article.featureArticle,$:{},variable:{reading_track_interval_num:4,reading_track:[]},init:function(){this.initTracking(),this.initDOM(),this.bind()},initTracking:function(){for(var e=this.variable.reading_track_interval_num,t=1;t<e;t++)this.variable.reading_track.push({threshold:(t/e*100).toFixed(0),isTrigger:!1})},initDOM:function(){this.$.$ArticleFeatureContainer=this.$.App.find("#tnl-article-feature-container"),this.$.$FeatureArticleContentSection=this.$.$ArticleFeatureContainer.find("#tnl-feature-article-content-section"),this.$.$FeatureArticleContent=this.$.$ArticleFeatureContainer.find("article")},bind:function(){this.bindCollection.ScrollProgress.init(this)},sendReadingTrackAnalytics:function(t,i){e.analytics.sendGreedySnakeTrack(t,"readProgress",i)},bindCollection:{ScrollProgress:{parent:null,init:function(e){this.parent=e,this.bindScrollProgress(),this.bindPostReadingTrack()},bindPostReadingTrack:function(){var e=this.parent;new Waypoint({offset:"100%",element:e.$.$ArticleFeatureContainer,handler:function(t){var i=tnlInfo.page_id;switch(t){case"up":break;case"down":console.log("[RT]-PV",i),e.sendReadingTrackAnalytics("progress",{type:"pv",page_id:i})}this.destroy()}}),new Waypoint({offset:"100%",element:e.$.$ArticleFeatureContainer.find("article"),handler:function(t){var i=tnlInfo.page_id;switch(t){case"up":break;case"down":console.log("[RT]-META",i),e.sendReadingTrackAnalytics("progress",{type:"meta",page_id:i})}this.destroy()}}),new Waypoint({offset:"bottom-in-view",element:e.$.$ArticleFeatureContainer.find("article"),handler:function(t){var i=tnlInfo.page_id;switch(t){case"up":break;case"down":console.log("[RT]-FOOTER",i),e.sendReadingTrackAnalytics("progress",{type:"footer",page_id:i})}this.destroy()}})},bindScrollProgress:function(){var t=this.parent,i=e.Bind.Progressbar.init(),n=t.$.$FeatureArticleContentSection.scrollTop(),r=t.$.$FeatureArticleContentSection.height()-e.$.$window.outerHeight();e.$.$document.on("scroll",function(){var a=e.$.$window.scrollTop()-n,o=a/r*100;i.setReadPercent(o);var c=t.$.$FeatureArticleContent.height(),l=t.$.$FeatureArticleContent.offset().top,s=e.$.$window.scrollTop()-l,d=s/c*100,u=tnlInfo.page_id;_.each(t.variable.reading_track,function(e,i){if(!e.isTrigger&&d>e.threshold){console.log("[RT]-REACH"+e.threshold,u,s,c*e.threshold/100,c);e.threshold;t.sendReadingTrackAnalytics("progress",{type:"c_"+e.threshold,page_id:u,y:s,full:c}),t.variable.reading_track[i].isTrigger=!0}})})}}}},e.$.$document.ready(function(){var t=e.$.$document.find("#tnl-feature-article-app");t.length&&(e.article.common=new e.article.common(t),e.article.common.init(),e.article.featureArticle=new e.article.featureArticle(t),e.article.featureArticle.init())})}("undefined"!=typeof Tnl?Tnl:this.Tnl={});
!function(t){t.article=t.article||{},t.article.featureArticleList=t.article.featureArticleList||{},t.article.featureArticleList=function(t){this.$.App=t},t.article.featureArticleList.prototype={constructor:t.article.featureArticleList,$:{},variable:{},init:function(){this.initDOM(),this.bind()},initDOM:function(){this.$.$ArticleListMaskPhoto=this.$.App.find(".mask > img")},bind:function(){var i=this;t.$.$document.on("scroll",function(){var e=t.$.$window.scrollTop(),r="translateY("+.2*e+"px)";i.$.$ArticleListMaskPhoto.css("transform",r)})}},t.$.$document.ready(function(){var i=t.$.$document.find("#tnl-feature-article-list-app");i.length&&(t.article.common=new t.article.common(i),t.article.common.init(),t.article.featureArticleList=new t.article.featureArticleList(i),t.article.featureArticleList.init())})}("undefined"!=typeof Tnl?Tnl:this.Tnl={});
!function(t){t.article=t.article||{},t.article.promotion=t.article.promotion||{},t.article.promotion=function(t){this.$.App=t},t.article.promotion.prototype={constructor:t.article.promotion,$:{},variable:{},init:function(){this.bind()},bind:function(){this.bindCollection.Quiz.init(this)},bindCollection:{Quiz:{parent:null,init:function(t){this.parent=t,this.bindQuiz()},bindQuiz:function(){var i=this.parent,n=t.article.tools.getPromotionUrl("article");$.ajax({type:"get",url:n,data:{},success:function(t){if(t.status&&t.data&&t.data.html){var n=i.$.App.find("#article-bottom-social-button-section");n.length&&n.before(t.data.html)}},error:function(t){console.log(t)}})}}}},t.$.$document.ready(function(){var i=t.$.$document.find("#tnl-article-normal");i.length&&(t.article.promotion=new t.article.promotion(i),t.article.promotion.init())})}("undefined"!=typeof Tnl?Tnl:this.Tnl={});
!function(e){e.member=e.member||{},e.member.common=e.member.common||{},e.member.common=function(e){this.$.App=e},e.member.common.prototype={constructor:e.member.common,$:{},variable:{},init:function(){"Y"!=e.auth.variable.member.privacy_status&&e.auth.fetchTemplate(function(){e.auth.$.termsModal.find(".member-remove").remove(),e.auth.showTermsModal()});var t=this.$.App;this.$.editModal=t.find(".edit-profile-container"),this.$.editSuccess=t.find("#tnl-member-edit-success"),this.$.editReturn=t.find("#tnl-member-edit-return"),this.$.avatarPreview=t.find("#tnl-member-avatar-preview"),this.$.avatarSave=t.find("#tnl-member-edit-avatar-save"),this.$.editAlert=t.find("#tnl-member-edit-alert"),this.$.editLoader=t.find("#tnl-member-edit-loader"),this.bind()},bind:function(){var t=this;e.$.$document.on("click","#tnl-terms-return",function(e){History.back()}),e.$.$document.on("click",".tnl-member-edit-modal",function(){t.$.editModal.fadeIn(300)}),e.$.$document.on("click","#tnl-member-edit-success",function(){if($(this).hasClass("disabled"))return!1;t.$.App.find("#update-profile-form").submit()}),e.$.$document.on("click","#tnl-member-edit-return",function(){t.$.App.find(".edit-profile-container").fadeOut(400)}),e.$.$document.on("submit","#update-profile-form",function(i){e.Util.eventStop(i);var a=$(this);t.$.editLoader.fadeIn(300),t.$.editSuccess.addClass("disabled"),a.ajaxSubmit({success:function(e){if(t.$.editLoader.fadeOut(300),t.$.editSuccess.removeClass("disabled"),"error"==e.status)return t.ajaxFail(e),!1;window.location.reload()}})}),e.$.$document.on("change","#tnl-member-edit-upload",function(){t.$.App.find("#upload-avatar-form").submit()}),e.$.$document.on("submit","#upload-avatar-form",function(i){e.Util.eventStop(i);var a=$(this);t.$.editLoader.fadeIn(300),t.$.editSuccess.addClass("disabled"),t.$.avatarPreview.hide(),a.ajaxSubmit({success:function(e){if(t.$.editLoader.fadeOut(300),t.$.editSuccess.removeClass("disabled"),"error"==e.status)return t.ajaxFail(e),!1;t.$.avatarPreview.attr("src",e.avatar_absolute).show(),t.$.avatarSave.val(e.avatar_relative)}})})},ajaxFail:function(e){console.log(e),this.$.editAlert.find("ul").html("<li>"+e.error_message+"</li>")}}}("undefined"!=typeof Tnl?Tnl:this.Tnl={});
!function(e){e.member=e.member||{},e.member.trackArticle=e.member.trackArticle||{},e.member.trackArticle=function(e){this.$.App=e},e.member.trackArticle.prototype={constructor:e.member.trackArticle,$:{},variable:{page:2,ajaxStart:!1},init:function(){sessionStorage.setItem("page","favorite/article"),sessionStorage.removeItem("type"),sessionStorage.removeItem("date"),this.$.moreContainer=this.$.App.find(".more-box"),this.$.listContainer=this.$.App.find("#list-container"),this.bind()},bind:function(){var e=this;e.$.App;e.$.moreContainer.on("click",function(){1!=e.variable.ajaxStart&&(e.variable.ajaxStart=!0,$.ajax({type:"GET",url:e.parseAjaxUrl(),data:{html:1,page:e.variable.page},contentType:"application/json"}).success(function(t){e.$.listContainer.append(t.html),t.current_page>=t.last_page?e.$.moreContainer.hide():e.$.moreContainer.show(),e.variable.page++,e.variable.ajaxStart=!1}))})},parseAjaxUrl:function(){return e.url.getNotDomainAjaxUrl()}},e.$.$document.ready(function(){var t=e.$.$document.find("#tnl-member-track-article");t.length&&(e.member.common=new e.member.common(t),e.member.common.init(),e.member.trackArticle=new e.member.trackArticle(t),e.member.trackArticle.init())})}("undefined"!=typeof Tnl?Tnl:this.Tnl={});
!function(e){e.member=e.member||{},e.member.trackAuthorArticle=e.member.trackAuthorArticle||{},e.member.trackAuthorArticle=function(e){this.$.App=e},e.member.trackAuthorArticle.prototype={constructor:e.member.trackAuthorArticle,$:{},variable:{page:2,ajaxStart:!1},init:function(){sessionStorage.setItem("page","favorite/author-article"),sessionStorage.removeItem("type"),sessionStorage.removeItem("date"),this.$.moreContainer=this.$.App.find(".more-box"),this.$.listContainer=this.$.App.find("#list-container"),this.bind()},bind:function(){var e=this;e.$.App;e.$.moreContainer.on("click",function(){1!=e.variable.ajaxStart&&(e.variable.ajaxStart=!0,$.ajax({type:"GET",url:e.parseAjaxUrl(),data:{html:1,page:e.variable.page},contentType:"application/json"}).success(function(t){e.$.listContainer.append(t.html),t.current_page>=t.last_page?e.$.moreContainer.hide():e.$.moreContainer.show(),e.variable.page++,e.variable.ajaxStart=!1}))})},parseAjaxUrl:function(){return e.url.getNotDomainAjaxUrl()}},e.$.$document.ready(function(){var t=e.$.$document.find("#tnl-member-track-author-article");t.length&&(e.member.common=new e.member.common(t),e.member.common.init(),e.member.trackAuthorArticle=new e.member.trackAuthorArticle(t),e.member.trackAuthorArticle.init())})}("undefined"!=typeof Tnl?Tnl:this.Tnl={});
!function(t){t.member=t.member||{},t.member.trackAuthorEdit=t.member.trackAuthorEdit||{},t.member.trackAuthorEdit=function(t){this.$.App=t},t.member.trackAuthorEdit.prototype={constructor:t.member.trackAuthorEdit,$:{},variable:{},init:function(){t.dom.resetHeight(".authors-container .col-md-4"),this.bind()},bind:function(){t.$.$document.on("click",".tnl-author-follow",function(o){t.Util.eventStop(o);var e=$(this),n=e.data("id");e.data("lock")||(e.data("lock",!0),e.hasClass("unfollow-btn")?$.ajax({url:"/favorite/author/"+n,type:"DELETE",success:function(t){console.log(t),e.text(e.data("follow")),e.addClass("follow-btn").removeClass("unfollow-btn")},error:function(t){console.log(t)},complete:function(){e.data("lock",!1)}}):$.ajax({url:"/favorite/author/"+n,type:"POST",success:function(t){console.log(t),e.text(e.data("unfollow")),e.addClass("unfollow-btn").removeClass("follow-btn")},error:function(t){console.log(t)},complete:function(){e.data("lock",!1)}}))})}},t.$.$document.ready(function(){var o=t.$.$document.find("#tnl-member-track-author");o.length&&(t.member.common=new t.member.common(o),t.member.common.init(),t.member.trackAuthorEdit=new t.member.trackAuthorEdit(o),t.member.trackAuthorEdit.init())})}("undefined"!=typeof Tnl?Tnl:this.Tnl={});
!function(e){e.member=e.member||{},e.member.subscribe=e.member.subscribe||{},e.member.subscribe=function(e){this.$.App=e},e.member.subscribe.prototype={constructor:e.member.subscribe,$:{},variable:{},init:function(){var e=this.$.App;this.$.$dailyTW=e.find('input[name="dailyTW"]'),this.$.$weekHot=e.find('input[name="weekHot"]'),this.$.$weekIntl=e.find('input[name="weekIntl"]'),this.$.$weekVideo=e.find('input[name="weekVideo"]'),this.$.$member=e.find('input[name="member"]'),this.$.$dailyIntlEng=e.find('input[name="dailyIntlEng"]'),this.$.subscribeBtn=e.find("#tnl-member-subscribe-submit"),this.$.subscribeMessage=e.find("#tnl-member-subscribe-submit-message"),this.bind()},bind:function(){var i=this;this.$.App.find("input.styled-checkbox").click(function(){$(this).toggleClass("changed"),i.$.App.find("input.styled-checkbox.changed").length?i.$.subscribeBtn.fadeIn(300):i.$.subscribeBtn.fadeOut(300)}),e.$.$document.on("click",".tnl-member-resend-confirmation",function(n){e.Util.eventStop(n);var t=$(this);i.$.App.find(".tnl-member-email-verify-loader").fadeIn(300),t.parent().hide(),$.ajax({url:"/auth/member/confirmation/resend",method:"POST",success:function(e){if(i.$.App.find(".tnl-member-email-verify-loader").fadeOut(300),"error"==e.status)return!1;var n=i.$.App.find(".tnl-member-email-verify-message");n.html(e.message+n.find("a")[0].outerHTML),n.show()}})}),e.$.$document.on("click",".tnl-member-resend-subscribe",function(n){e.Util.eventStop(n);var t=$(this);i.$.App.find(".tnl-member-email-verify-loader").fadeIn(300),t.parent().hide(),$.ajax({url:"/auth/member/confirmation/resend",method:"POST",success:function(e){if(i.$.App.find(".tnl-member-email-verify-loader").fadeOut(300),"error"==e.status)return!1;var n=i.$.App.find(".tnl-member-subscribe-message");n.html(e.message+n.find("a")[0].outerHTML),n.show()}})}),e.$.$document.on("click","#tnl-member-subscribe-submit",function(){i.$.App.find("#subscribe-form").submit()}),e.$.$document.on("submit","#subscribe-form",function(n){e.Util.eventStop(n);var t=$(this);return i.$.subscribeBtn.attr("disabled",""),i.$.App.find(".tnl-member-subscribe-submit-loader").fadeIn(300),$.ajax({url:t.attr("action"),method:"PUT",data:{dailyTW:i.$.$dailyTW.is(":checked")?1:0,weekHot:i.$.$weekHot.is(":checked")?1:0,weekIntl:i.$.$weekIntl.is(":checked")?1:0,weekVideo:i.$.$weekVideo.is(":checked")?1:0,member:i.$.$member.is(":checked")?1:0,dailyIntlEng:i.$.$dailyIntlEng.is(":checked")?1:0},success:function(n){if(i.$.subscribeBtn.attr("disabled",!1),i.$.App.find(".tnl-member-subscribe-submit-loader").fadeOut(300),"error"==n.status)return e.auth.ajaxError(n),i.$.subscribeMessage.html("<p>"+n.error_message+"</p>"),!1;i.$.subscribeMessage.html('<span><i class="fa fa-check-circle"></i>'+n.output+"</span>").show(),i.$.App.find("input.styled-checkbox.changed").removeClass("changed")}}),!1})}},e.$.$document.ready(function(){var i=e.$.$document.find("#tnl-member-subscribe");i.length&&(e.member.common=new e.member.common(i),e.member.common.init(),e.member.subscribe=new e.member.subscribe(i),e.member.subscribe.init())})}("undefined"!=typeof Tnl?Tnl:this.Tnl={});
!function(e){e.index=e.index||{},e.index={init:function(){null!=document.getElementById("tnl-index")&&e.index.call()},call:function(){function e(){var e=(window.location.pathname,window.location.host.split(".")),t=e[0];return"//api."+e[1]+"."+e[2]+"/web/"+t+"/index"}$(".slider").each(function(){function e(e){var a,n;t(),o.is(":animated")||l===e||(s[l].removeClass("active"),s[e].addClass("active"),e>l?(n="100%",a="-100%"):(n="-100%",a="100%"),i.eq(e).css({display:"block",left:n}),o.animate({left:a},function(){i.eq(l).css({display:"none"}),i.eq(e).css({left:0}),o.css({left:0}),l=e}))}function t(){clearTimeout(a),a=setTimeout(function(){e(l<i.length-1?l+1:0)},4e3)}var a,n=$(this),o=n.find(".slide_group"),i=n.find(".slide"),s=[],l=0;$(".next_btn").on("click",function(){e(l<i.length-1?l+1:0)}),$(".previous_btn").on("click",function(){e(0!==l?l-1:3)}),$.each(i,function(t){var a=$('<a class="slide_btn">&bull;</a>');t===l&&a.addClass("active"),a.on("click",function(){e(t)}).appendTo(".slide_buttons"),s.push(a)}),t()}),sessionStorage.setItem("page","index"),sessionStorage.removeItem("type"),sessionStorage.removeItem("date");var t=2,a=!1;$(".more-box").on("click",function(){1!=$(this).data("ajaxStart")&&($(this).data("ajaxStart",!0),$.ajax({type:"GET",url:e()+"?page="+t,contentType:"application/json"}).success(function(e){t++,$(".more-box").before(e.html),$(".more-box").data("ajaxStart",!1),$(".more-box").hide();var n,o,i,s,l;for(var d in e.dfp_advertisement_config_list){s=e.dfp_advertisement_config_list[d];for(var c in s)n=s[c].slot_name,i=s[c].ad_size_list,o=s[c].ad_slot_id,googletag.cmd.push(function(){l=googletag.defineSlot(n,i,o).addService(googletag.pubads()),googletag.pubads().enableSingleRequest(),googletag.enableServices(),googletag.display(o),googletag.pubads().refresh([l])})}a=!0}))}),$(window).scroll(function(){$(window).scrollTop()+300>=$(document).height()-$(window).height()&&a&&1!=$(this).data("ajaxStart")&&($(this).data("ajaxStart",!0),$.ajax({type:"GET",url:e()+"?page="+t,contentType:"application/json"}).success(function(e){t++,$(".more-box").before(e.html);var a,n,o,i,s;for(var l in e.dfp_advertisement_config_list){i=e.dfp_advertisement_config_list[l];for(var d in i)a=i[d].slot_name,o=i[d].ad_size_list,n=i[d].ad_slot_id,googletag.cmd.push(function(){s=googletag.defineSlot(a,o,n).addService(googletag.pubads()),googletag.pubads().enableSingleRequest(),googletag.enableServices(),googletag.display(n),googletag.pubads().refresh([s])})}$(window).data("ajaxStart",!1)}))})}},e.$.$document.ready(function(){e.index.init()})}("undefined"!=typeof Tnl?Tnl:this.Tnl={});
!function(e){e.author=e.author||{},e.author=function(e){this.$.App=e},e.author.prototype={constructor:e.author,$:{},variable:{page:2,ajaxStart:!1},init:function(){sessionStorage.setItem("page","author"),sessionStorage.setItem("type","latest"),sessionStorage.removeItem("date"),this.$.filterContainer=this.$.App.find(".filter-container"),this.$.timeFilterContainer=this.$.App.find(".time-filter-container"),this.$.moreContainer=this.$.App.find(".more-box"),this.$.listContainer=this.$.App.find("#list-container"),this.$.filterMonth=this.$.App.find("#filter-month"),this.bind()},bind:function(){var e=this,t=e.$.App;e.$.moreContainer.on("click",function(){1!=e.variable.ajaxStart&&(e.variable.ajaxStart=!0,$.ajax({type:"GET",url:e.parseAjaxUrl(),data:{html:1,page:e.variable.page},contentType:"application/json"}).success(function(t){e.$.listContainer.append(t.html),t.current_page>=t.last_page?e.$.moreContainer.hide():e.$.moreContainer.show(),e.variable.page++,e.variable.ajaxStart=!1}))}),t.find("#filter-latest").on("click",function(){e.$.filterContainer.find("li.active").removeClass("active"),$(this).addClass("active"),sessionStorage.setItem("type","latest"),sessionStorage.removeItem("date"),e.$.timeFilterContainer.is(":visible")&&e.$.timeFilterContainer.slideToggle(400),e.sendFilterAjax()}),t.find("#filter-hot").on("click",function(){e.$.filterContainer.find("li.active").removeClass("active"),e.$.timeFilterContainer.find("li.active").removeClass("active"),e.$.filterMonth.addClass("active"),$(this).addClass("active"),sessionStorage.setItem("type","hot"),sessionStorage.setItem("date","month"),e.$.timeFilterContainer.is(":visible")||e.$.timeFilterContainer.slideToggle(400),e.sendFilterAjax()}),t.find("#filter-social").on("click",function(){e.$.filterContainer.find("li.active").removeClass("active"),e.$.timeFilterContainer.find("li.active").removeClass("active"),e.$.filterMonth.addClass("active"),$(this).addClass("active"),sessionStorage.setItem("type","social"),sessionStorage.setItem("date","month"),e.$.timeFilterContainer.is(":visible")||e.$.timeFilterContainer.slideToggle(400),e.sendFilterAjax()}),t.find("#filter-today").on("click",function(){e.$.timeFilterContainer.find("li.active").removeClass("active"),$(this).addClass("active"),sessionStorage.setItem("date","today"),e.sendFilterAjax()}),t.find("#filter-week").on("click",function(){e.$.timeFilterContainer.find("li.active").removeClass("active"),$(this).addClass("active"),sessionStorage.setItem("date","week"),e.sendFilterAjax()}),t.find("#filter-month").on("click",function(){e.$.timeFilterContainer.find("li.active").removeClass("active"),$(this).addClass("active"),sessionStorage.setItem("date","month"),e.sendFilterAjax()}),t.find("#filter-year").on("click",function(){e.$.timeFilterContainer.find("li.active").removeClass("active"),$(this).addClass("active"),sessionStorage.setItem("date","year"),e.sendFilterAjax()}),t.find("#filter-last-year").on("click",function(){e.$.timeFilterContainer.find("li.active").removeClass("active"),$(this).addClass("active"),sessionStorage.setItem("date","lastYear"),e.sendFilterAjax()}),t.find("#filter-history").on("click",function(){e.$.timeFilterContainer.find("li.active").removeClass("active"),$(this).addClass("active"),sessionStorage.setItem("date","history"),e.sendFilterAjax()})},parseAjaxUrl:function(){return e.url.getAjaxUrl()},sendFilterAjax:function(){var e=this;$.ajax({type:"GET",url:e.parseAjaxUrl(),data:{html:1},contentType:"application/json"}).success(function(t){e.$.listContainer.html(t.html),t.current_page>=t.last_page?e.$.moreContainer.hide():e.$.moreContainer.show(),e.variable.page=1})}},e.$.$document.ready(function(){var t=e.$.$document.find("#tnl-author");t.length&&(e.author=new e.author(t),e.author.init())})}("undefined"!=typeof Tnl?Tnl:this.Tnl={});
!function(t){t.authors=t.authors||{},t.authors={init:function(){null!=document.getElementById("tnl-authors")&&t.authors.call()},call:function(){t.dom.resetHeight(".authors-container .col-md-4")}},t.$.$document.ready(function(){t.authors.init()})}("undefined"!=typeof Tnl?Tnl:this.Tnl={});
!function(e){e.business=e.business||{},e.business={init:function(){null!=document.getElementById("tnl-business")&&e.business.call()},call:function(){function e(){var e=window.location.pathname.replace("/business-blog","/author"),t=window.location.host.split("."),s=t[0],n=t[1]+"."+t[2];return null!=sessionStorage.getItem("type")&&null!=sessionStorage.getItem("date")?"//api."+n+"/web/"+s+e+"/"+sessionStorage.getItem("type")+"/"+sessionStorage.getItem("date"):null!=sessionStorage.getItem("type")?"//api."+n+"/web/"+s+e+"/"+sessionStorage.getItem("type"):"//api."+n+"/web/"+s+e}var t=$(".more-box"),s=1;window.location.pathname.split("/")[2];sessionStorage.setItem("page","business"),sessionStorage.removeItem("type"),sessionStorage.removeItem("date"),t.on("click",function(){console.log(1!=$(this).data("ajaxStart")),1!=$(this).data("ajaxStart")&&($(this).data("ajaxStart",!0),s++,$.ajax({type:"GET",url:e()+"?html=1&page="+s,contentType:"application/json"}).success(function(e){$("#list-container").append(e.html),e.current_page>=e.last_page?t.hide():t.show(),t.data("ajaxStart",!1)}))})}},e.$.$document.ready(function(){e.business.init()})}("undefined"!=typeof Tnl?Tnl:this.Tnl={});
!function(s){s.businessList=s.businessList||{},s.businessList={init:function(){null!=document.getElementById("tnl-business-list")&&s.businessList.call()},call:function(){sessionStorage.setItem("page","businesses"),sessionStorage.removeItem("type"),sessionStorage.removeItem("date")}},s.$.$document.ready(function(){s.businessList.init()})}("undefined"!=typeof Tnl?Tnl:this.Tnl={});
!function(e){e.category=e.category||{},e.category={init:function(){document.getElementById("tnl-category")},call:function(){function e(){$.ajax({type:"GET",url:t()+"?html=1",contentType:"application/json"}).success(function(e){$("#list-container").html(e.html),e.current_page>=e.last_page?s.hide():s.show(),o=1})}function t(){var e=window.location.pathname,t=window.location.host.split("."),i=t[0],a=t[1]+"."+t[2];return null!=sessionStorage.getItem("type")&&null!=sessionStorage.getItem("date")?"//api."+a+"/web/"+i+e+"/"+sessionStorage.getItem("type")+"/"+sessionStorage.getItem("date"):null!=sessionStorage.getItem("type")?"//api."+a+"/web/"+i+e+"/"+sessionStorage.getItem("type"):"//api."+a+"/web/"+i+e}var i=$(".filter-container"),a=$(".time-filter-container"),s=$(".more-box"),o=1,n=window.location.pathname.split("/")[1],l=window.location.pathname.split("/")[2];l?sessionStorage.setItem("page","category-"+l):sessionStorage.setItem("page",n),sessionStorage.setItem("type","latest"),sessionStorage.removeItem("date"),s.on("click",function(){console.log(1!=$(this).data("ajaxStart")),1!=$(this).data("ajaxStart")&&($(this).data("ajaxStart",!0),o++,$.ajax({type:"GET",url:t()+"?html=1&page="+o,contentType:"application/json"}).success(function(e){$("#list-container").append(e.html),e.current_page>=e.last_page?s.hide():s.show(),s.data("ajaxStart",!1)}))}),$("#filter-latest").on("click",function(){i.find("li.active").removeClass("active"),$(this).addClass("active"),sessionStorage.setItem("type","latest"),sessionStorage.removeItem("date"),a.is(":visible")&&a.slideToggle(400),e()}),$("#filter-hot").on("click",function(){i.find("li.active").removeClass("active"),a.find("li.active").removeClass("active"),$("#filter-month").addClass("active"),$(this).addClass("active"),sessionStorage.setItem("type","hot"),sessionStorage.setItem("date","month"),a.is(":visible")||a.slideToggle(400),e()}),$("#filter-social").on("click",function(){i.find("li.active").removeClass("active"),a.find("li.active").removeClass("active"),$("#filter-month").addClass("active"),$(this).addClass("active"),sessionStorage.setItem("type","social"),sessionStorage.setItem("date","month"),a.is(":visible")||a.slideToggle(400),e()}),$("#filter-today").on("click",function(){a.find("li.active").removeClass("active"),$(this).addClass("active"),sessionStorage.setItem("date","today"),e()}),$("#filter-week").on("click",function(){a.find("li.active").removeClass("active"),$(this).addClass("active"),sessionStorage.setItem("date","week"),e()}),$("#filter-month").on("click",function(){a.find("li.active").removeClass("active"),$(this).addClass("active"),sessionStorage.setItem("date","month"),e()}),$("#filter-year").on("click",function(){a.find("li.active").removeClass("active"),$(this).addClass("active"),sessionStorage.setItem("date","year"),e()}),$("#filter-last-year").on("click",function(){a.find("li.active").removeClass("active"),$(this).addClass("active"),sessionStorage.setItem("date","lastYear"),e()}),$("#filter-history").on("click",function(){a.find("li.active").removeClass("active"),$(this).addClass("active"),sessionStorage.setItem("date","history"),e()})}},e.$.$document.ready(function(){e.category.init()})}("undefined"!=typeof Tnl?Tnl:this.Tnl={});
!function(e){e.categoryList=e.categoryList||{},e.categoryList={state:{filterSection:{$filterContainer:!1,$filterBoxRelateTimeHotSection:!1,$filterBoxRelateTimeSocialSection:!1,$filterPublishDateSection:!1},filter_date:{year:0,month:0},text:{default_month_placeholder:""}},$:{},init:function(){null!=document.querySelector(".category_list")&&(e.categoryList.initDom(),e.categoryList.bind(),e.categoryList.initSelector())},initDom:function(){this.$.$filterContainer=e.$.$document.find("#time-filter-container"),this.$.$filterBoxRelateTimeHotSection=e.$.$document.find("#filter-box-relate-time-hot"),this.$.$filterBoxRelateTimeSocialSection=e.$.$document.find("#filter-box-relate-time-social"),this.$.$filterPublishDateSection=e.$.$document.find("#filter-box-publish-date"),this.$.$CategoryFilterTrigger=e.$.$document.find(".category_filter_trigger"),this.$.$SelectMonthSection=e.$.$document.find(".select_month_section"),this.$.$TimeSelectorBtn=e.$.$document.find(".time-selector-btn"),this.$.$SelectYearPlaceholder=e.$.$document.find(".select_year_placeholder"),this.$.$SelectMonthPlaceholder=e.$.$document.find(".select_month_placeholder"),this.$.$SelectMonthDropDownMenuFirstOption=e.$.$document.find(".select_month_drop_down_menu > option").eq(0),this.state.text.default_month_placeholder=this.$.$SelectMonthPlaceholder.html(),this.$.$filterContainer.is(":visible")&&(this.state.filterSection.$filterContainer=!0),this.$.$filterBoxRelateTimeHotSection.is(":visible")&&(this.state.filterSection.$filterBoxRelateTimeHotSection=!0),this.$.$filterBoxRelateTimeSocialSection.is(":visible")&&(this.state.filterSection.$filterBoxRelateTimeSocialSection=!0),this.$.$filterPublishDateSection.is(":visible")&&(this.state.filterSection.$filterPublishDateSection=!0)},initSelector:function(){var t,i,o,n,l,c,r=[],a=new Date,s=a.getFullYear();for(t=2013;t<=s;t++)r.push(t);if(tnlInfo&&tnlInfo.category){if(tnlInfo.category.publish_date_list)for(var $ in r)t=r[$],tnlInfo.category.publish_date_list[t]||(o=".select_year_li_"+t,l=".select_year_option_"+t,e.$.$document.find(o).hide(),e.$.$document.find(l).hide());tnlInfo.category.select_list&&(t=tnlInfo.category.select_list.year,i=tnlInfo.category.select_list.month,o=".select_year_li_"+t,n=".select_month_li_"+i,l=".select_year_option_"+t,c=".select_month_option_"+i,$SelectYearLi=e.$.$document.find(o),$SelectYearLi.trigger("click"),$SelectMonthLi=e.$.$document.find(n),$SelectMonthLi.trigger("click"),$SelectYearOption=e.$.$document.find(l),$SelectYearOption.prop("selected",!0),$SelectMonthOption=e.$.$document.find(c),$SelectMonthOption.prop("selected",!0),this.setYearMonthSelector(t))}},setYearMonthSelector:function(t){if(tnlInfo&&t&&tnlInfo.category&&tnlInfo.category.publish_date_list&&tnlInfo.category.publish_date_list[t]){var i,o,n,l=tnlInfo.category.publish_date_list[t];for(i=1;i<=12;i++)o=".select_month_li_"+i,n=".select_month_option_"+i,l.indexOf(i)==-1?(e.$.$document.find(o).hide(),e.$.$document.find(n).hide()):(e.$.$document.find(o).show(),e.$.$document.find(n).show());0==this.state.filter_date.month&&(this.$.$SelectMonthPlaceholder.html(this.state.text.default_month_placeholder),this.$.$SelectMonthDropDownMenuFirstOption.prop("selected",!0))}},setMonthSelectorToDefault:function(){this.state.filter_date.month=0,this.$.$TimeSelectorBtn.addClass("unable")},bind:function(){var t=this;e.$.$document.on("click",".select_year_li",function(e){var i=this.dataset.year;t.state.filter_date.year=i,t.setMonthSelectorToDefault(),t.setYearMonthSelector(i),t.$.$SelectMonthSection.removeClass("unable")}),e.$.$document.on("click",".select_month_li",function(e){t.state.filter_date.month=this.dataset.month,t.$.$TimeSelectorBtn.removeClass("unable")}),e.$.$document.on("change",".select_year_drop_down_menu",function(e){var i=$(this),o=i.find("option:selected"),n=o.val();t.state.filter_date.year=n,t.setMonthSelectorToDefault(),t.setYearMonthSelector(n),t.$.$SelectMonthSection.removeClass("unable")}),e.$.$document.on("change",".select_month_drop_down_menu",function(e){var i=$(this),o=i.find("option:selected");t.state.filter_date.month=o.val(),t.$.$SelectMonthSection.removeClass("unable")}),e.$.$document.on("click",".time-selector-btn",function(e){var i,o=tnlInfo.category&&tnlInfo.category.base_url,n=t.state.filter_date.year,l=t.state.filter_date.month;o&&n>0&&l>0&&(i=o+"/year/{year}/month/{month}",i=i.replace(/\{year\}/gi,n),i=i.replace(/\{month\}/gi,l),location.href=i)}),e.$.$document.on("click",".category_filter_trigger",function(i){var o,n,l=$(this),c=!0,r=!0,a={$filterBoxRelateTimeHotSection:!1,$filterBoxRelateTimeSocialSection:!1,$filterPublishDateSection:!1},s=l.data("filter-type");switch(t.$.$CategoryFilterTrigger.removeClass("active"),l.addClass("active"),s){case"PublishTime":r=!1,c=!1;break;case"hot":a.$filterBoxRelateTimeHotSection=!0;break;case"social":a.$filterBoxRelateTimeSocialSection=!0;break;case"publish_date":a.$filterPublishDateSection=!0}for(n in a)o=a[n],t.state.filterSection[n]&&!o&&(t.$[n].slideToggle(400),t.state.filterSection[n]=o);for(n in a)o=a[n],!t.state.filterSection[n]&&o&&(t.$[n].slideToggle(400),t.state.filterSection[n]=o);r!=t.state.filterSection.$filterContainer&&(t.$.$filterContainer.slideToggle(400),t.state.filterSection.$filterContainer=r),c&&e.Util.eventStop(i)})}},e.$.$document.ready(function(){e.categoryList.init()})}("undefined"!=typeof Tnl?Tnl:this.Tnl={});
!function(e){e.job=e.job||{},e.job={init:function(){null!=document.getElementById("tnl-job")&&e.job.call()},call:function(){sessionStorage.removeItem("page"),sessionStorage.removeItem("type"),sessionStorage.removeItem("date"),e.$.$document.on("click",".jobs-list li",function(){var e=$(this).index()+1,n=$(".standard-container").eq(e);$("body, html").animate({scrollTop:$(n).offset().top-80},700)})}},e.$.$document.ready(function(){e.job.init()})}("undefined"!=typeof Tnl?Tnl:this.Tnl={});
!function(e){e.officialBlog=e.officialBlog||{},e.officialBlog={init:function(){null!=document.getElementById("tnl-official-blog")&&e.officialBlog.call()},call:function(){function e(){$.ajax({type:"GET",url:t()+"?html=1",contentType:"application/json"}).success(function(e){$("#list-container").html(e.html),e.current_page>=e.last_page?s.hide():s.show(),o=1})}function t(){var e=window.location.pathname,t=window.location.host.split("."),i=t[0],a=t[1]+"."+t[2];return null!=sessionStorage.getItem("type")&&null!=sessionStorage.getItem("date")?"//api."+a+"/web/"+i+e+"/"+sessionStorage.getItem("type")+"/"+sessionStorage.getItem("date"):null!=sessionStorage.getItem("type")?"//api."+a+"/web/"+i+e+"/"+sessionStorage.getItem("type"):"//api."+a+"/web/"+i+e}sessionStorage.setItem("page","official-blog"),sessionStorage.setItem("type","latest"),sessionStorage.removeItem("date");var i=$(".filter-container"),a=$(".time-filter-container"),s=$(".more-box"),o=1;s.on("click",function(){console.log(1!=$(this).data("ajaxStart")),1!=$(this).data("ajaxStart")&&($(this).data("ajaxStart",!0),o++,$.ajax({type:"GET",url:t()+"?html=1&page="+o,contentType:"application/json"}).success(function(e){$("#list-container").append(e.html),e.current_page>=e.last_page?s.hide():s.show(),s.data("ajaxStart",!1)}))}),$("#filter-latest").on("click",function(){i.find("li.active").removeClass("active"),$(this).addClass("active"),sessionStorage.setItem("type","latest"),sessionStorage.removeItem("date"),a.is(":visible")&&a.slideToggle(400),e()}),$("#filter-hot").on("click",function(){i.find("li.active").removeClass("active"),a.find("li.active").removeClass("active"),$("#filter-month").addClass("active"),$(this).addClass("active"),sessionStorage.setItem("type","hot"),sessionStorage.setItem("date","month"),a.is(":visible")||a.slideToggle(400),e()}),$("#filter-social").on("click",function(){i.find("li.active").removeClass("active"),a.find("li.active").removeClass("active"),$("#filter-month").addClass("active"),$(this).addClass("active"),sessionStorage.setItem("type","social"),sessionStorage.setItem("date","month"),a.is(":visible")||a.slideToggle(400),e()}),$("#filter-today").on("click",function(){a.find("li.active").removeClass("active"),$(this).addClass("active"),sessionStorage.setItem("date","today"),e()}),$("#filter-week").on("click",function(){a.find("li.active").removeClass("active"),$(this).addClass("active"),sessionStorage.setItem("date","week"),e()}),$("#filter-month").on("click",function(){a.find("li.active").removeClass("active"),$(this).addClass("active"),sessionStorage.setItem("date","month"),e()}),$("#filter-year").on("click",function(){a.find("li.active").removeClass("active"),$(this).addClass("active"),sessionStorage.setItem("date","year"),e()}),$("#filter-last-year").on("click",function(){a.find("li.active").removeClass("active"),$(this).addClass("active"),sessionStorage.setItem("date","lastYear"),e()}),$("#filter-history").on("click",function(){a.find("li.active").removeClass("active"),$(this).addClass("active"),sessionStorage.setItem("date","history"),e()})}},e.$.$document.ready(function(){e.officialBlog.init()})}("undefined"!=typeof Tnl?Tnl:this.Tnl={});
!function(e){e.press=e.press||{},e.press={init:function(){null!=document.getElementById("tnl-press")&&e.press.call()},call:function(){function e(){var e,t="",s=window.location.host.split("."),a=s[0],n=s[1]+"."+s[2],o=window.location.pathname.split("/");for(var i in o)e=o[i],e.length&&(t+="/"+e);return null!=sessionStorage.getItem("type")&&null!=sessionStorage.getItem("date")?"//api."+n+"/web/"+a+t+"/"+sessionStorage.getItem("type")+"/"+sessionStorage.getItem("date"):null!=sessionStorage.getItem("type")?"//api."+n+"/web/"+a+t+"/"+sessionStorage.getItem("type"):"//api."+n+"/web/"+a+t}sessionStorage.setItem("page","press"),sessionStorage.removeItem("type"),sessionStorage.removeItem("date");var t=$(".more-box"),s=1;t.on("click",function(){console.log(1!=$(this).data("ajaxStart")),1!=$(this).data("ajaxStart")&&($(this).data("ajaxStart",!0),s++,$.ajax({type:"GET",url:e()+"?html=1&page="+s,contentType:"application/json"}).success(function(e){$("#list-container").append(e.html),e.current_page>=e.last_page?t.hide():t.show(),t.data("ajaxStart",!1)}))})}},e.$.$document.ready(function(){e.press.init()})}("undefined"!=typeof Tnl?Tnl:this.Tnl={});
!function(e){e.projects=e.projects||{},e.projects={init:function(){null!=document.getElementById("tnl-projects")&&e.projects.call()},call:function(){sessionStorage.removeItem("page"),sessionStorage.removeItem("type"),sessionStorage.removeItem("date")}},e.$.$document.ready(function(){e.projects.init()})}("undefined"!=typeof Tnl?Tnl:this.Tnl={});
!function(t){t.tag=t.tag||{},t.tag={init:function(){null!=document.getElementById("tnl-tag")&&t.tag.call()},call:function(){t.dom.resetHeight(".row .col-sm-4")}},t.$.$document.ready(function(){t.tag.init()})}("undefined"!=typeof Tnl?Tnl:this.Tnl={});
!function(e){e.video=e.video||{},e.video={init:function(){null!=document.getElementById("tnl-video")&&e.video.call()},call:function(){sessionStorage.removeItem("page"),sessionStorage.removeItem("type"),sessionStorage.removeItem("date"),e.dom.resetHeight(".col-sm-4")}},e.$.$document.ready(function(){e.video.init()})}("undefined"!=typeof Tnl?Tnl:this.Tnl={});
!function(e){e.videoCategory=e.videoCategory||{},e.videoCategory={init:function(){null!=document.getElementById("tnl-video-category")&&e.videoCategory.call()},call:function(){$(".filter-container"),$(".sub-filter-container"),$(".time-filter-container");sessionStorage.removeItem("page"),sessionStorage.removeItem("type"),sessionStorage.removeItem("date"),e.dom.resetHeight(".videoCat-container .col-sm-4")}},e.$.$document.ready(function(){e.videoCategory.init()})}("undefined"!=typeof Tnl?Tnl:this.Tnl={});
!function(i){i.subscribe=i.subscribe||{},i.subscribe=function(i){this.$.App=i},i.subscribe.prototype={constructor:i.subscribe,$:{},variable:{},init:function(){var t=this.$.App;this.$.$mailchimpBtn=t.find("#mailchimp-submit"),this.$.$mailchimpOutput=t.find("#mailchimp-output"),this.$.$email=t.find("#mailchimp-email"),this.$.$dailyTW=t.find('input[name="dailyTW"]'),this.$.$weekHot=t.find('input[name="weekHot"]'),this.$.$weekIntl=t.find('input[name="weekIntl"]'),this.$.$weekVideo=t.find('input[name="weekVideo"]'),this.$.$dailyIntlEng=t.find('input[name="dailyIntlEng"]'),this.$.$member=t.find('input[name="member"]'),i.Util.isEmptyObject(i.auth.variable.member)&&i.auth.fetchTemplate(function(){var t=i.auth.$.loginModal.find(".tnl-login-message");t.text(t.data("email")),i.auth.$.loginModal.show()}),this.bind()},bind:function(){var t=this;i.$.$document.on("submit","#subscribe-form",function(e){i.Util.eventStop(e);var n=$(this);return t.$.$mailchimpBtn.attr("disabled",""),t.$.$mailchimpOutput.html('<i class="fa fa-cog fa-spin fa-2x fa-fw margin-bottom" style="margin-top: 5px;"></i>'),$.ajax({url:n.attr("action"),method:"PUT",data:{dailyTW:t.$.$dailyTW.is(":checked")?1:0,weekHot:t.$.$weekHot.is(":checked")?1:0,weekIntl:t.$.$weekIntl.is(":checked")?1:0,weekVideo:t.$.$weekVideo.is(":checked")?1:0,dailyIntlEng:t.$.$dailyIntlEng.is(":checked")?1:0,member:t.$.$member.is(":checked")?1:0},success:function(e){if(t.$.$mailchimpBtn.attr("disabled",!1),"error"==e.status)return i.auth.ajaxError(e),t.$.$mailchimpOutput.html("<p>"+e.error_message+"</p>"),!1;t.$.$mailchimpOutput.html("<p>"+e.output+"</p>")},error:function(i){console.log(i)}}),!1})},changeEmail:function(i){this.$.App.find('input[name="email"]').val(i).attr("readonly",!0).attr("disabled",!0)}},i.$.$document.ready(function(){var t=i.$.$document.find("#tnl-subscribe");t.length&&(i.subscribe=new i.subscribe(t),i.subscribe.init())})}("undefined"!=typeof Tnl?Tnl:this.Tnl={});
!function(n){n.search=n.search||{},n.search={init:function(){null!=document.getElementById("tnl-search")&&n.search.call()},call:function(){fbq("track","Search")}},n.$.$document.ready(function(){n.search.init()})}("undefined"!=typeof Tnl?Tnl:this.Tnl={});
!function(t){t.forgetPassword=t.forgetPassword||{},t.forgetPassword=function(t){this.$.App=t},t.forgetPassword.prototype={constructor:t.forgetPassword,$:{},variable:{ajaxStart:!1},init:function(){this.$.$memberAlertContainer=this.$.App.find(".member-alert-container"),this.$.$memberAlertMessage=this.$.App.find(".member-alert-container ul li"),this.$.$submitFormBtn=this.$.App.find(".tnl-submit-btn"),this.bind()},bind:function(){var e=this;t.$.$document.on("submit","#tnl-forget-password-form",function(r){if(t.Util.eventStop(r),e.variable.ajaxStart)return!1;e.variable.ajaxStart=!0,e.$.$submitFormBtn.addClass("disabled");var a=$(this);a.find(".tnl-forget-password-loader").fadeIn(300),$.ajax({url:a.attr("action"),method:a.attr("method"),data:{email:a.find("input[name='email']").val()},success:function(t){if(a.find(".tnl-forget-password-loader").fadeOut(300),"error"==t.status)return console.log(t),!1;e.$.$memberAlertMessage.text(t.message),e.$.$memberAlertContainer.show(),e.changeAjaxStart()}})})},changeAjaxStart:function(){var t=this;setTimeout(function(){t.$.$submitFormBtn.removeClass("disabled"),t.variable.ajaxStart=!1},5e3)}},t.$.$document.ready(function(){var e=t.$.$document.find("#tnl-forget-password");e.length&&(t.forgetPassword=new t.forgetPassword(e),t.forgetPassword.init())})}("undefined"!=typeof Tnl?Tnl:this.Tnl={});
!function(t){t.resetPassword=t.resetPassword||{},t.resetPassword=function(t){this.$.App=t},t.resetPassword.prototype={constructor:t.resetPassword,$:{},variable:{ajaxStart:!1},init:function(){this.$.$memberAlertContainer=this.$.App.find(".member-alert-container"),this.$.$memberAlertMessage=this.$.App.find(".member-alert-container ul li"),this.$.$submitFormBtn=this.$.App.find(".tnl-submit-btn"),this.bind()},bind:function(){var e=this;t.$.$document.on("submit","#tnl-reset-password-form",function(s){if(t.Util.eventStop(s),e.variable.ajaxStart)return!1;e.variable.ajaxStart=!0,e.$.$submitFormBtn.addClass("disabled");var a=$(this);a.find(".tnl-reset-password-loader").fadeIn(300),$.ajax({url:a.attr("action"),method:a.attr("method"),data:{password:a.find("input[name='password']").val(),password_confirmation:a.find("input[name='password_confirmation']").val(),token:a.find("input[name='token']").val()},success:function(t){if(a.find(".tnl-reset-password-loader").fadeOut(300),"error"==t.status)return console.log(t),!1;e.$.$memberAlertMessage.text(t.message),e.$.$memberAlertContainer.show(),e.changeAjaxStart()}})})},changeAjaxStart:function(){var t=this;setTimeout(function(){t.$.$submitFormBtn.removeClass("disabled"),t.variable.ajaxStart=!1},5e3)}},t.$.$document.ready(function(){var e=t.$.$document.find("#tnl-reset-password");e.length&&(t.resetPassword=new t.resetPassword(e),t.resetPassword.init())})}("undefined"!=typeof Tnl?Tnl:this.Tnl={});
!function(t){t.security=t.security||{},t.security=t.security||{},t.security=function(t){this.$.$App=t},t.security.prototype={constructor:t.security,$:{template:{}},variable:{},init:function(){this.initDom(),this.bind()},initDom:function(){this.$.$SecurityCountDown=this.$.$App.find("#count-down"),this.$.$SecurityProgressBar=this.$.$App.find("#security-progress-bar")},bind:function(){this.bindUnderAttack()},bindUnderAttack:function(){var i=this;t.$.$document.ready(function(){function t(){n>-1&&(i.$.$SecurityCountDown.text(n),n--,setTimeout(t,1100))}var n=5;i.$.$SecurityProgressBar.css("width","100%"),t()})}},t.$.$document.ready(function(){var i=t.$.$document.find("#tnl-security");i.length&&(t.security=new t.security(i),t.security.init())})}("undefined"!=typeof Tnl?Tnl:this.Tnl={});
!function(e){e.aces2017=e.aces2017||{},e.aces2017.member=e.aces2017.member||{},e.aces2017.member=function(e){console.log("aces2017 member"),this.$.App=e},e.aces2017.member.prototype={constructor:e.aces2017.member,$:{},variable:{},init:function(){this.initDom(),this.bind()},initDom:function(){this.$.termsNext=e.$.$document.find("#tnl-aces2017-terms-next"),this.$.MemberAccountMessageInfo=e.$.$document.find("#member-account-message-info")},bind:function(){this.BindCollection.MemberSignUp.init(this),this.BindCollection.MemberTerms.init(this),this.BindCollection.MemberVerifyEmail.init(this),this.BindCollection.MemberSignIn.init(this)},BindCollection:{MemberSignIn:{parent:null,variable:{resend_status:!1},init:function(e){this.parent=e,this.bindMemberSignIn()},bindMemberSignIn:function(){this.parent;window.addEventListener("message",function(n){~n.origin.indexOf(e.url.variable.domain)&&(console.log(n.data),"login_success"==n.data.status&&(console.log("success"),window.location="/events/aces2017/booking-ticket"),"login_error"==n.data.status&&alert(n.data.error_message))}),e.$.$document.on("click",".fb-aces2017-sign-up-btn",function(n){e.Util.eventStop(n);e.dom.PopupCenter("/events/aces2017/auth/member/facebook/sign-in","Facebook Login","600","450")}),e.$.$document.on("click",".google-aces2017-sign-up-btn",function(n){e.Util.eventStop(n);e.dom.PopupCenter("/events/aces2017/auth/member/google/sign-in","Google Login","600","450")}),e.$.$document.on("click",".tnl-aces2017-sign-in-btn",function(n){e.Util.eventStop(n),window.location="/events/aces2017/auth/member/sign-in"}),e.$.$document.on("click",".tnl-aces2017-sign-up-btn",function(n){e.Util.eventStop(n),window.location="/events/aces2017/auth/member/sign-up"}),e.$.$document.on("click",".tnl-aces2017-sign-in-process-btn:not(.disabled)",function(){$(this).parents("form").submit()}),e.$.$document.on("submit","#tnl-aces2017-sign-in-form",function(n){e.Util.eventStop(n);var t=$(this);t.find(".tnl-sign-in-loader").fadeIn(300),$.ajax({url:t.attr("action"),method:t.attr("method"),data:{email:t.find("input[name='email']").val(),password:t.find("input[name='password']").val()},success:function(e){t.find(".tnl-sign-in-loader").fadeOut(300),"success"==e.status?(console.log("success"),window.location="/events/aces2017/booking-ticket"):alert(e.error_message)}})})}},MemberVerifyEmail:{parent:null,variable:{resend_status:!1,check_status:!1},init:function(e){this.parent=e,this.bindMemberVerifyEmail()},bindMemberVerifyEmail:function(){var n=this.parent,t=this;e.$.$document.on("click","#tnl-aces2017-go-to-get-ticket-btn",function(i){if(e.Util.eventStop(i),t.variable.check_status)return void alert("檢查中，請稍候...");t.variable.check_status=!0,n.$.App.find(".tnl-sign-up-loader").fadeIn(300),n.$.MemberAccountMessageInfo.fadeOut(300),$.ajax({url:"/events/aces2017/auth/confirmation/verify-mail-status",method:"POST",success:function(e){if(console.log(e),n.$.App.find(".tnl-sign-up-loader").fadeOut(300),"error"==e.status)return alert(e.error_message),!1;t.variable.check_status=!1,"N"==e.message.email_verify_status?n.$.MemberAccountMessageInfo.fadeIn(300):window.location="/events/aces2017/booking-ticket"}})}),e.$.$document.on("click",".tnl-aces2017-resend-confirmation",function(i){e.Util.eventStop(i);var s=$(this);if(t.variable.resend_status)return void alert("寄送驗證信中，請稍候...");t.variable.resend_status=!0,n.$.App.find(".tnl-sign-up-loader").fadeIn(300),s.parent().hide(),$.ajax({url:"/events/aces2017/auth/confirmation/verify-mail-resend",method:"POST",success:function(e){if(console.log(e),n.$.App.find(".tnl-sign-up-loader").fadeOut(300),s.parent().show(),"error"==e.status)return alert(e.error_message),!1;alert("驗證信重寄成功"),t.variable.resend_status=!1}})})}},MemberTerms:{parent:null,init:function(e){this.parent=e,this.bindMemberTerms()},bindMemberTerms:function(){var n=this.parent;e.$.$document.on("click","#tnl-aces2017-terms-check",function(e){$(this).is(":checked")?n.$.termsNext.removeClass("disabled"):n.$.termsNext.addClass("disabled")}),e.$.$document.on("click","#tnl-aces2017-terms-return",function(e){window.location="https://aces2017.thenewslens.com/"}),e.$.$document.on("click","#tnl-aces2017-terms-next",function(e){var n=$(this);if(n.hasClass("disabled"))return alert("尚未勾選同意隱私權"),!1;n.parent().find(".tnl-terms-loader").fadeIn(300),$.ajax({url:"/events/aces2017/auth/member/agree-privacy",type:"POST",success:function(e){if(n.parent().find(".tnl-terms-loader").fadeOut(300),"error"==e.status)return alert(e.error_message),!1;window.location="/events/aces2017/auth/confirmation/verify-mail"},error:function(e){console.log(e)}})})}},MemberSignUp:{parent:null,init:function(e){this.parent=e,this.bindMemberAuth()},bindMemberAuth:function(){this.parent;console.log("bind auth"),e.$.$document.on("click",".tnl-aces2017-member-sign-up-submit-btn:not(.disabled)",function(){$(this).parents("form").submit()}),e.$.$document.on("submit","#tnl-aces2017-sign-up-form",function(n){e.Util.eventStop(n);var t=$(this);t.find(".tnl-sign-up-loader").fadeIn(300),$.ajax({url:t.attr("action"),method:t.attr("method"),data:{full_name:t.find("input[name='full-name']").val(),email:t.find("input[name='email']").val(),password:t.find("input[name='password']").val(),password_confirmation:t.find("input[name='password-confirmation']").val()},success:function(e){console.log(e),t.find(".tnl-sign-up-loader").fadeOut(300),"success"==e.status?(console.log("success"),window.location="/events/aces2017/auth/member/terms"):alert(e.error_message)}})})}}}},e.$.$document.ready(function(){var n=e.$.$document.find("#tnl-aces2017-member-auth");n.length&&(e.aces2017.member=new e.aces2017.member(n),e.aces2017.member.init())})}("undefined"!=typeof Tnl?Tnl:this.Tnl={});
try{if(tnlInfo=tnlInfo||{},tnlInfo&&tnlInfo.page_id&&!tnlInfo.is_draft){var content_insight_sites={1:"1382",2:"2172",3:"2173",4:"2174"},content_insight_id=content_insight_sites[tnlInfo.SID];tnlInfo=tnlInfo||{},tnlInfo.post_title=tnlInfo.post_title||"",tnlInfo.main_category=tnlInfo.main_category||"",tnlInfo.publish_time=tnlInfo.publish_time||"",tnlInfo.author_name=tnlInfo.author_name||"",tnlInfo.tags_list=tnlInfo.tags_list||"";var maincontent_selector="#article-title-{post_id}, #article-content-{post_id}";maincontent_selector=maincontent_selector.replace(new RegExp("{post_id}","g"),tnlInfo.page_id);var _ain={id:content_insight_id,url:window.location.href,postid:tnlInfo.page_id,maincontent:maincontent_selector,title:tnlInfo.post_title,pubdate:tnlInfo.publish_time,authors:tnlInfo.author_name,sections:tnlInfo.main_category,tags:tnlInfo.tracking_tags_list,comments:"0",word_count:Tnl.Util.getArticleWordCount().toString()};!function(t,n){var o=t.createElement(n);o.type="text/javascript",o.async=!0,o.src=("https:"==t.location.protocol?"https://d7d3cf2e81d293050033-3dfc0615b0fd7b49143049256703bfce.ssl.cf1.rackcdn.com":"http://t.contentinsights.com")+"/stf.js";var e=t.getElementsByTagName(n)[0];e.parentNode.insertBefore(o,e)}(document,"script")}}catch(t){console.log("== Content Insight ==",t)}
!function(e,t,n,c,o,a,f){e.fbq||(o=e.fbq=function(){o.callMethod?o.callMethod.apply(o,arguments):o.queue.push(arguments)},e._fbq||(e._fbq=o),o.push=o,o.loaded=!0,o.version="2.0",o.queue=[],a=t.createElement(n),a.async=!0,a.src="https://connect.facebook.net/en_US/fbevents.js",f=t.getElementsByTagName(n)[0],f.parentNode.insertBefore(a,f))}(window,document,"script"),fbq("init","1632209740378706"),fbq("track","PageView");