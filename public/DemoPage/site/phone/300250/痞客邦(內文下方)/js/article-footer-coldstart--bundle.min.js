!function(){"use strict";var t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e=function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)};function n(t){if(!t)return"";var e,n,r=window.location.search.substring(1).split("&");for(e=0;e<r.length;e++)if((n=r[e].split("="))[0]===t)return decodeURIComponent(n[1]);return""}function r(t){if(window.localStorage){var e=window.localStorage.getItem(t);return"string"==typeof e?window.JSON.parse(e):e}}function o(e,n){if(window.localStorage){if("object"===(void 0===n?"undefined":t(n)))return void window.localStorage.setItem(e,window.JSON.stringify(n));window.localStorage.setItem(e,n)}}function a(t){return t[Math.floor(Math.random()*t.length)]}function i(t){var e=!1;return function(n){n&&!e&&(e=!0,n.innerHTML=t)}}var c={initGA:function(){window.ga("create",y,"auto","articleFooterColdstart")},trackEvent:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=!1;return function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!e){t&&(e=!0);var r=n.category,o=n.action,a=n.label,i=n.value;window.ga("articleFooterColdstart.send","event",r,o,a,i),window._piq.push(["trackEvent",r,o,a,i])}}}},l=!1,s=!1,d=!1,u=!1,v=0,m={related:function(t){var e=document.querySelector(".pix-related-post"),n=document.querySelectorAll('.relative-item:not([data-source^="ad_mobile_"])');e&&!u&&this.isScrolledIntoView(e)&&(u=!0,v=(new Date).getTime()),n.length&&this.bindRelatedImpsEvent(n,t),n.length&&!l&&(l=!0,this.bindRelatedClickEvent(n,t))},bindRelatedImpsEvent:function(t,n){var r=this;[].concat(e(t)).forEach(function(t,e){var o=t.querySelector(".thumb-img"),a=t.querySelector(".relative__main-date"),i="b";o&&(i=r.getListStyleType(o,120));var c={category:n+"_imp",action:"relatedArticle"+r.pad(e+1)+"_"+i+"Pic",label:a&&a.innerHTML};r.bindImpsEvent(t,c)})},bindRelatedClickEvent:function(t,n){var r=this;[].concat(e(t)).forEach(function(t,e){var o=t.querySelector(".thumb-img"),a=t.querySelector(".relative__main-date"),i="b";o&&(i=r.getListStyleType(o,120));var l={category:n+"_click",action:"relatedArticle0"+(e+1)+"_"+i+"Pic",label:a&&a.innerHTML};t.addEventListener("click",function(){l.value=(new Date).getTime()-v,c.trackEvent()(l)})})},stream:function(t){var n=this,r=document.querySelector(".discover-stream__list");if(r){var o=r.querySelectorAll(".discover-stream__item");o.length&&[].concat(e(o)).forEach(function(e,r){var o=e.querySelector(".discover-stream__topic-discussion").innerHTML,a=e.querySelector(".discover-stream__topic-cover"),i="b";a&&(i=n.getListStyleType(a,115));var c={category:t+"_imp",action:"band"+n.pad(r+1)+"_"+i+"Pic",label:o.replace(/\D/g,"")};n.bindImpsEvent(e,c)}),o.length&&!s&&(s=!0,[].concat(e(o)).forEach(function(e,r){var o=e.querySelector(".discover-stream__topic-discussion").innerHTML,a=e.querySelector(".discover-stream__topic-cover"),i="b";a&&(i=n.getListStyleType(a,115));var l={category:t+"_click",action:"band0"+(r+1)+"_"+i+"Pic",label:o.replace(/\D/g,"")};e.addEventListener("click",function(){l.value=(new Date).getTime()-v,c.trackEvent()(l)})}))}},hotArticles:function(t){var e=this,n=document.querySelectorAll(".hot-article"),r=document.querySelectorAll(".hot-articles"),o=n.length;if(n.length)for(var a=0;a<o;a++){var i=n[a],l=i.querySelector(".hot-article__cover"),s="b";l&&(s=this.getListStyleType(l,120));var u={category:t+"_imp",action:"hotArticle"+this.pad(a+1)+"_"+s+"Pic",label:i.querySelector(".hot-article__data").innerHTML};this.bindImpsEvent(i,u)}if(n.length&&r.length&&!d){d=!0;for(var m=function(r){var o=n[r],a=o.querySelector(".hot-article__cover"),i="b";a&&(i=e.getListStyleType(a,120));var l={category:t+"_click",action:"hotArticle"+e.pad(r+1)+"_"+i+"Pic",label:o.querySelector(".hot-article__data").innerHTML};o.addEventListener("click",function(){l.value=(new Date).getTime()-v,c.trackEvent()(l)})},p=0;p<o;p++)m(p)}},pad:function(t){return t<10?"0"+t:t},isScrolledIntoView:function(t){if(t){var e=t.getBoundingClientRect(),n=e.top,r=e.bottom;return n<=window.innerHeight&&r>0}},getListStyleType:function(t,e){return t.offsetWidth>e?"b":"s"},bindImpsEvent:function(t,e){t&&(this.isScrolledIntoView(t)&&!t.dataset.imp&&(t.dataset.imp=!0,c.trackEvent()(e)))},bindAdImpEvents:function(t){var e=this;[{selector:document.querySelector(".article-ad"),action:"黃金腰帶"},{selector:document.querySelector(".article-ad1732"),action:"黃金熱門"},{selector:document.querySelector("#pixad1138"),action:"黃金立地1"},{selector:document.querySelector("#pixad1741"),action:"hotAD01"},{selector:document.querySelector("#pixad1742"),action:"hotAD02"},{selector:document.querySelector("#pixad2391"),action:"hotAD03"}].forEach(function(n){e.bindImpsEvent(n.selector,{category:t+"_imp",action:n.action})})}};var p=document.getElementById("header-prompt"),f=!1,_={init:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];t&&p?this.showToast("發生錯誤，請稍候再試！"):p&&this.showToast(e)},showToast:function(t){var e=t?'<a class="header-prompt__link" href="https://www.pixnet.net">關注成功!到 <span>首頁興趣牆</span> 持續追蹤</a>':"已取消關注！";p.innerHTML=e,p.classList.add("prompt-success");var n=p.querySelector(".header-prompt__link");n&&n.addEventListener("click",function(){_.recordToastEvent("click-toast-to-index")}),f||(f=!0,setTimeout(function(){p.classList.remove("prompt-success"),f=!1},8e3)),this.recordToastEvent("imps-toast-to-index","關注成功")},recordToastEvent:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";window.ga("articleFooterColdstart.send","event","mobileClick",t,e),_piq.push(["trackEvent","mobileClick",t,e])}},y="UA-69603077-7",h=location.host.indexOf("pixnet.work")>-1,q=window.pix&&window.pix.domain_append,b=7092,g=315,w=12,S=(window.articleFooterTest||{}).articleId,E={a:{displayAnswer:!0,displayInfos:!1},b:{title:"這些網友需要你的幫忙",subTitle:"登入回答他吧！",buttonText:"我要回答",displayAnswer:!1,displayInfos:!0,utmMedium:"Blog_Qcard_B_answer"},c:{title:"敲碗！想知道答案～",subTitle:"按下好奇，在首頁興趣牆持續關注最新回答",buttonText:"<span>我也好奇</span>",displayAnswer:!1,displayInfos:!0,utmMedium:"Blog_Qcard_C_curious"}},L={enableRound1:function(){var t,e,r,o,c=n("v")||a(["a","b","c","d"]);if(["b","c","d"].indexOf(c)>-1){var l=document.querySelector("#main");l.classList.add("articles--footer-coldstart"),l.classList.add("footer-coldstart--"+c)}e="R1_version"+(t=c).toUpperCase(),r=i("你可能會有興趣的文章"),o=i("發現有趣的邦邦討論"),window.addEventListener("scroll",function(){if("a"!==t){var n=document.querySelector(".relative-tilte"),a=document.querySelector(".discover-stream__title");r(n),o(a)}m.related(e),m.stream(e),m.hotArticles(e),m.bindAdImpEvents(e)},!!function(){var t=!1;try{var e=Object.defineProperty({},"passive",{get:function(){t=!0}});window.addEventListener("test",null,e)}catch(t){}return t}&&{passive:!0})},enableQcard1:async function(){var t=r("qcard")&&r("qcard").version,l=n("qcard")||t||a(["a","b","c"]),s="Q_R1_version"+l.toUpperCase(),d=E[l],u=window.location,v=window.pix&&window.pix.member_token,m="utm_source=PIXNET&utm_medium="+d.utmMedium,p=document.querySelector(".article-body > .qcard"),f=p.querySelector(".qcard__cards"),y=await axios.get(u.protocol+"//"+u.host+"/apiblog/qna?article_id="+S),L=y.data&&y.data.data,k=L.qcards&&L.qcards.length,T="https://api.pixnet.cc/topics/"+b+"/follow",x=axios.create({baseURL:T,headers:{Authorization:v}});if(!L.error&&k){var I=L.qcards.map(function(t){var e=t.answer.author,n=""+t.link,r="a"===l||"b"===l&&v?n:function(t){if("c"===l&&v)return"";var e="b"===l?t+"?"+m:u.href+(u.search?"&":"?")+m,n=h?"http:":"https:";return n+"//panel.pixnet.cc"+q+"/login/openid?openid="+n+"//member.pixnet.cc"+q+"/login&easy_login=1&done="+encodeURIComponent(e)}(n);return'<li class="qcard__card">\n            <a href="'+n+'">\n                <div class="qcard__card-inner">\n                    <p class="qcard__card-question">\n                        '+t.content+'\n                    </p>\n                    <p class="qcard__card-infos">\n                        <span class="qcard-info qcard-info--answer">'+t.comments_total+' 則回答</span>\n                    </p>\n                    <div class="qcard__card-answer">\n                        <p class="qcard__card-member">\n                            <img class="qcard__card-avatar" width=20" height="20"\n                                src="'+e.avatar+'"\n                                alt="'+e.display_name+'">\n                            '+e.display_name+' 回答\n                        </p>\n                        <p class="qcard__card-text">'+t.answer.content+'</p>\n                    </div>\n                </div>\n            </a>\n            <div class="qcard__card-bottom">\n                <a '+(r?'href="'+r+'"':"")+'>\n                    <button class="qcard-button">看其他 '+(t.comments_total-1)+" 則回答</button>\n                </a>\n            </div>\n        </li>"}).join("");p.querySelector(".qcard__cards").innerHTML=I;var A=p.querySelectorAll(".qcard__card"),C=p.querySelector(".qcard__title"),M=p.querySelector(".qcard__desc"),R=p.querySelector("#qcard-modal-button"),O=p.querySelector("#qcard-modal-dialog"),H=p.querySelector("#qcard-modal-dialog-close"),P="NOT_SUBSCRIPTION"!==L.subscription_status;"c"===t&&v&&(W(),p.scrollIntoView(),f.scrollLeft=(g+w)*(r("qcard")&&r("qcard").index||0)),t&&o("qcard",{});var D=c.trackEvent(!0),U=c.trackEvent(!0);R.addEventListener("click",function(t){O.classList.toggle("show"),t.stopPropagation();var e={category:s+"_information",action:"clickIconClose"};function n(){var t=this.classList;O.classList.remove("show"),document.removeEventListener("click",n),H.removeEventListener("click",n),t&&t.contains("qcard__modal-dialog__close-button")&&U({category:s+"_information",action:"clickClose"})}O.classList.contains("show")&&(document.addEventListener("click",n),H.addEventListener("click",n),e.action="clickIconOpen"),D(e)}),d.title&&i(d.title)(C),d.subTitle&&i(d.subTitle)(M);var B=Rx.Observable.fromEvent(p.querySelector(".qcard__cards"),"scroll"),N=Rx.Observable.fromEvent(window,"scroll"),F=Rx.Observable.merge(N,B);[].concat(e(A)).forEach(function(t,e){var n=t.querySelector(".qcard__card-answer"),r=t.querySelector(".qcard-info--answer"),a=t.querySelector(".qcard__card-infos"),u=t.querySelector(".qcard-button"),m=t.querySelector(".qcard__card-question"),p=t.querySelector(".qcard__card-member"),f=t.querySelector(".qcard__card-text");j(d.displayAnswer,n),j(d.displayInfos,a),d.buttonText&&i(d.buttonText)(u),m.dataset.action="Title",u.dataset.action="Button",Q(m,e),Q(u,e),n&&(p.dataset.action="UserName",f.dataset.action="Answer",Q(p,e),Q(f,e)),r&&(r.dataset.action="Answer",Q(r,e)),function(t,e){var n=L.qcards[e],r=c.trackEvent(),o=F.throttle(function(){return Rx.Observable.timer(200)}).map(function(){return function(t){var e=t.getBoundingClientRect(),n=window.innerWidth||document.documentElement.clientWidth,r=Math.min(n,e.right)-Math.max(0,e.left),o=window.innerHeight||document.documentElement.clientHeight,a=Math.min(o,e.bottom)-Math.max(0,e.top);return Math.max(r,0)*Math.max(a,0)/(e.width*e.height)>=1}(t)}).distinctUntilChanged().filter(function(t){return t}).subscribe(function(){var t={category:s+"_imp",action:"qCard_"+V(e+1),label:"PRECISION"===n.type?"關鍵字比對":"興趣星球分類比對",value:n.comment_id};r(t),o.unsubscribe()})}(t,e),"c"===l&&u.addEventListener("click",function(){v?W():o("qcard",{version:l,index:e})})})}else p.classList.add("hide");function j(t,e){t||e.classList.add("hide")}function Q(t,e){if(t){var n=L.qcards[e],r=c.trackEvent(!0);t.addEventListener("click",function(){var o={category:s+"_click",action:"qCard_"+V(e+1)+"_"+(v?"login":"notLogin")+"_click"+t.dataset.action,label:"PRECISION"===n.type?"關鍵字比對":"興趣星球分類比對",value:n.comment_id};r(o)})}}function V(t){return t<10?"0"+t:t}async function W(){if(!P){var t=await x.post();return _.init(t.error),void(t.error||(P=!0))}_.init(!0)}}};document.location.search;document.addEventListener("DOMContentLoaded",function(){var t;t=window.articleFooterTest,Object.keys(t).forEach(function(e){t[e]&&L[e]&&L[e]()})})}();
