!function(){"use strict";function t(t){if(!t)return"";var e,n,o=window.location.search.substring(1).split("&");for(e=0;e<o.length;e++)if((n=o[e].split("="))[0]===t)return decodeURIComponent(n[1]);return""}function e(t){if(window.localStorage){const e=window.localStorage.getItem(t);return"string"==typeof e?window.JSON.parse(e):e}}function n(t,e){if(window.localStorage){if("object"==typeof e)return void window.localStorage.setItem(t,window.JSON.stringify(e));window.localStorage.setItem(t,e)}}function o(t){return t[Math.floor(Math.random()*t.length)]}function c(t){let e=!1;return function(n){n&&!e&&(e=!0,n.innerHTML=t)}}const r={initGA(){window.ga("create",h,"auto","articleFooterColdstart")},trackEvent(t=!1){let e=!1;return function(n={}){if(e)return;t&&(e=!0);const{category:o,action:c,label:r,value:i}=n;window.ga("articleFooterColdstart.send","event",o,c,r,i),window._piq.push(["trackEvent",o,c,r,i])}}};let i=!1,a=!1,s=!1,l=!1,d=0;const u={related(t){const e=document.querySelector(".pix-related-post"),n=document.querySelectorAll('.relative-item:not([data-source^="ad_mobile_"])');e&&!l&&this.isScrolledIntoView(e)&&(l=!0,d=(new Date).getTime()),n.length&&this.bindRelatedImpsEvent(n,t),n.length&&!i&&(i=!0,this.bindRelatedClickEvent(n,t))},bindRelatedImpsEvent(t,e){[...t].forEach((t,n)=>{const o=t.querySelector(".thumb-img"),c=t.querySelector(".relative__main-date");let r="b";o&&(r=this.getListStyleType(o,120));let i={category:`${e}_imp`,action:`relatedArticle${this.pad(n+1)}_${r}Pic`,label:c&&c.innerHTML};this.bindImpsEvent(t,i)})},bindRelatedClickEvent(t,e){[...t].forEach((t,n)=>{const o=t.querySelector(".thumb-img"),c=t.querySelector(".relative__main-date");let i="b";o&&(i=this.getListStyleType(o,120));let a={category:`${e}_click`,action:`relatedArticle0${n+1}_${i}Pic`,label:c&&c.innerHTML};t.addEventListener("click",()=>{a.value=(new Date).getTime()-d,r.trackEvent()(a)})})},stream(t){const e=document.querySelector(".discover-stream__list");if(!e)return;const n=e.querySelectorAll(".discover-stream__item");n.length&&[...n].forEach((e,n)=>{const o=e.querySelector(".discover-stream__topic-discussion").innerHTML,c=e.querySelector(".discover-stream__topic-cover");let r="b";c&&(r=this.getListStyleType(c,115));let i={category:`${t}_imp`,action:`band${this.pad(n+1)}_${r}Pic`,label:o.replace(/\D/g,"")};this.bindImpsEvent(e,i)}),n.length&&!a&&(a=!0,[...n].forEach((e,n)=>{const o=e.querySelector(".discover-stream__topic-discussion").innerHTML,c=e.querySelector(".discover-stream__topic-cover");let i="b";c&&(i=this.getListStyleType(c,115));let a={category:`${t}_click`,action:`band0${n+1}_${i}Pic`,label:o.replace(/\D/g,"")};e.addEventListener("click",()=>{a.value=(new Date).getTime()-d,r.trackEvent()(a)})}))},hotArticles(t){const e=document.querySelectorAll(".hot-article"),n=document.querySelectorAll(".hot-articles"),o=e.length;if(e.length)for(let n=0;n<o;n++){const o=e[n],c=o.querySelector(".hot-article__cover");let r="b";c&&(r=this.getListStyleType(c,120));let i={category:`${t}_imp`,action:`hotArticle${this.pad(n+1)}_${r}Pic`,label:o.querySelector(".hot-article__data").innerHTML};this.bindImpsEvent(o,i)}if(e.length&&n.length&&!s){s=!0;for(let n=0;n<o;n++){const o=e[n],c=o.querySelector(".hot-article__cover");let i="b";c&&(i=this.getListStyleType(c,120));let a={category:`${t}_click`,action:`hotArticle${this.pad(n+1)}_${i}Pic`,label:o.querySelector(".hot-article__data").innerHTML};o.addEventListener("click",()=>{a.value=(new Date).getTime()-d,r.trackEvent()(a)})}}},pad:t=>t<10?"0"+t:t,isScrolledIntoView(t){if(!t)return;const e=t.getBoundingClientRect(),n=e.top,o=e.bottom;return n<=window.innerHeight&&o>0},getListStyleType:(t,e)=>t.offsetWidth>e?"b":"s",bindImpsEvent(t,e){if(!t)return;this.isScrolledIntoView(t)&&!t.dataset.imp&&(t.dataset.imp=!0,r.trackEvent()(e))},bindAdImpEvents(t){[{selector:document.querySelector(".article-ad"),action:"黃金腰帶"},{selector:document.querySelector(".article-ad1732"),action:"黃金熱門"},{selector:document.querySelector("#pixad1138"),action:"黃金立地1"},{selector:document.querySelector("#pixad1741"),action:"hotAD01"},{selector:document.querySelector("#pixad1742"),action:"hotAD02"},{selector:document.querySelector("#pixad2391"),action:"hotAD03"}].forEach(e=>{this.bindImpsEvent(e.selector,{category:`${t}_imp`,action:e.action})})}};const m=document.getElementById("header-prompt");let p=!1;const _={init(t=!1,e=!0){t&&m?this.showToast("發生錯誤，請稍候再試！"):m&&this.showToast(e)},showToast(t){const e=t?'<a class="header-prompt__link" href="https://www.pixnet.net">關注成功!到 <span>首頁興趣牆</span> 持續追蹤</a>':"已取消關注！";m.innerHTML=e,m.classList.add("prompt-success");const n=m.querySelector(".header-prompt__link");n&&n.addEventListener("click",()=>{_.recordToastEvent("click-toast-to-index")}),p||(p=!0,setTimeout(function(){m.classList.remove("prompt-success"),p=!1},8e3)),this.recordToastEvent("imps-toast-to-index","關注成功")},recordToastEvent(t,e=""){window.ga("articleFooterColdstart.send","event","mobileClick",t,e),_piq.push(["trackEvent","mobileClick",t,e])}},h="UA-69603077-7",q=location.host.indexOf("pixnet.work")>-1,y=window.pix&&window.pix.domain_append,v=7092,w=315,b=12,{articleId:f}=window.articleFooterTest||{},g={a:{displayAnswer:!0,displayInfos:!1},b:{title:"這些網友需要你的幫忙",subTitle:"登入回答他吧！",buttonText:"我要回答",displayAnswer:!1,displayInfos:!0,utmMedium:"Blog_Qcard_B_answer"},c:{title:"敲碗！想知道答案～",subTitle:"按下好奇，在首頁興趣牆持續關注最新回答",buttonText:"<span>我也好奇</span>",displayAnswer:!1,displayInfos:!0,utmMedium:"Blog_Qcard_C_curious"}},S={enableRound1:()=>{const e=t("v")||o(["a","b","c","d"]);if(["b","c","d"].indexOf(e)>-1){const t=document.querySelector("#main");t.classList.add("articles--footer-coldstart"),t.classList.add("footer-coldstart--"+e)}!function(t){const e=`R1_version${t.toUpperCase()}`,n=c("你可能會有興趣的文章"),o=c("發現有趣的邦邦討論");window.addEventListener("scroll",()=>{if("a"!==t){const t=document.querySelector(".relative-tilte"),e=document.querySelector(".discover-stream__title");n(t),o(e)}u.related(e),u.stream(e),u.hotArticles(e),u.bindAdImpEvents(e)},!!function(){var t=!1;try{var e=Object.defineProperty({},"passive",{get:function(){t=!0}});window.addEventListener("test",null,e)}catch(t){}return t}&&{passive:!0})}(e)},enableQcard1:async()=>{const i=e("qcard")&&e("qcard").version,a=t("qcard")||i||o(["a","b","c"]),s=`Q_R1_version${a.toUpperCase()}`,l=g[a],d=window.location,u=window.pix&&window.pix.member_token,m=`utm_source=PIXNET&utm_medium=${l.utmMedium}`,p=document.querySelector(".article-body > .qcard"),h=p.querySelector(".qcard__cards"),S=await axios.get(`${d.protocol}//${d.host}/apiblog/qna?article_id=${f}`),$=S.data&&S.data.data,E=$.qcards&&$.qcards.length,L=`https://api.pixnet.cc/topics/${v}/follow`,k=axios.create({baseURL:L,headers:{Authorization:u}});if($.error||!E)return void p.classList.add("hide");const T=$.qcards.map(t=>{const e=t.answer.author,n=`${t.link}`,o="a"===a||"b"===a&&u?n:function(t){if("c"===a&&u)return"";const e="b"===a?`${t}?${m}`:`${d.href}${d.search?"&":"?"}${m}`,n=q?"http:":"https:";return`${n}//panel.pixnet.cc${y}/login/openid?openid=${n}//member.pixnet.cc${y}`+`/login&easy_login=1&done=${encodeURIComponent(e)}`}(n);return`<li class="qcard__card">\n            <a href="${n}">\n                <div class="qcard__card-inner">\n                    <p class="qcard__card-question">\n                        ${t.content}\n                    </p>\n                    <p class="qcard__card-infos">\n                        <span class="qcard-info qcard-info--answer">${t.comments_total} 則回答</span>\n                    </p>\n                    <div class="qcard__card-answer">\n                        <p class="qcard__card-member">\n                            <img class="qcard__card-avatar" width=20" height="20"\n                                src="${e.avatar}"\n                                alt="${e.display_name}">\n                            ${e.display_name} 回答\n                        </p>\n                        <p class="qcard__card-text">${t.answer.content}</p>\n                    </div>\n                </div>\n            </a>\n            <div class="qcard__card-bottom">\n                <a ${o?`href="${o}"`:""}>\n                    <button class="qcard-button">看其他 ${t.comments_total-1} 則回答</button>\n                </a>\n            </div>\n        </li>`}).join("");p.querySelector(".qcard__cards").innerHTML=T;const x=p.querySelectorAll(".qcard__card"),I=p.querySelector(".qcard__title"),A=p.querySelector(".qcard__desc"),C=p.querySelector("#qcard-modal-button"),M=p.querySelector("#qcard-modal-dialog"),R=p.querySelector("#qcard-modal-dialog-close");let O="NOT_SUBSCRIPTION"!==$.subscription_status;"c"===i&&u&&(Q(),p.scrollIntoView(),h.scrollLeft=(w+b)*(e("qcard")&&e("qcard").index||0)),i&&n("qcard",{});const H=r.trackEvent(!0),P=r.trackEvent(!0);C.addEventListener("click",t=>{M.classList.toggle("show"),t.stopPropagation();const e={category:`${s}_information`,action:"clickIconClose"};function n(){const t=this.classList;M.classList.remove("show"),document.removeEventListener("click",n),R.removeEventListener("click",n),t&&t.contains("qcard__modal-dialog__close-button")&&P({category:`${s}_information`,action:"clickClose"})}M.classList.contains("show")&&(document.addEventListener("click",n),R.addEventListener("click",n),e.action="clickIconOpen"),H(e)}),l.title&&c(l.title)(I),l.subTitle&&c(l.subTitle)(A);const D=Rx.Observable.fromEvent(p.querySelector(".qcard__cards"),"scroll"),U=Rx.Observable.fromEvent(window,"scroll"),B=Rx.Observable.merge(U,D);function N(t,e){t||e.classList.add("hide")}function F(t,e){if(!t)return;const n=$.qcards[e],o=r.trackEvent(!0);t.addEventListener("click",()=>{const c={category:`${s}_click`,action:`qCard_${j(e+1)}_${u?"login":"notLogin"}_click${t.dataset.action}`,label:"PRECISION"===n.type?"關鍵字比對":"興趣星球分類比對",value:n.comment_id};o(c)})}function j(t){return t<10?"0"+t:t}async function Q(){if(!O){const t=await k.post();return _.init(t.error),void(t.error||(O=!0))}_.init(!0)}[...x].forEach((t,e)=>{const o=t.querySelector(".qcard__card-answer"),i=t.querySelector(".qcard-info--answer"),d=t.querySelector(".qcard__card-infos"),m=t.querySelector(".qcard-button"),p=t.querySelector(".qcard__card-question"),_=t.querySelector(".qcard__card-member"),h=t.querySelector(".qcard__card-text");N(l.displayAnswer,o),N(l.displayInfos,d),l.buttonText&&c(l.buttonText)(m),p.dataset.action="Title",m.dataset.action="Button",F(p,e),F(m,e),o&&(_.dataset.action="UserName",h.dataset.action="Answer",F(_,e),F(h,e)),i&&(i.dataset.action="Answer",F(i,e)),function(t,e){const n=$.qcards[e],o=r.trackEvent(),c=B.throttle(()=>Rx.Observable.timer(200)).map(()=>(function(t){const e=t.getBoundingClientRect(),n=window.innerWidth||document.documentElement.clientWidth,o=Math.min(n,e.right)-Math.max(0,e.left),c=window.innerHeight||document.documentElement.clientHeight,r=Math.min(c,e.bottom)-Math.max(0,e.top);return Math.max(o,0)*Math.max(r,0)/(e.width*e.height)>=1})(t)).distinctUntilChanged().filter(t=>t).subscribe(()=>{const t={category:`${s}_imp`,action:`qCard_${j(e+1)}`,label:"PRECISION"===n.type?"關鍵字比對":"興趣星球分類比對",value:n.comment_id};o(t),c.unsubscribe()})}(t,e),"c"===a&&m.addEventListener("click",()=>{u?Q():n("qcard",{version:a,index:e})})})}};document.location.search;document.addEventListener("DOMContentLoaded",function(){!function(){const t=window.articleFooterTest;Object.keys(t).forEach(e=>{t[e]&&S[e]&&S[e]()})}()})}();
