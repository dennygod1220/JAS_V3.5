!function(){"use strict";const t=t=>{const e=new RegExp(`[?&]${t}=([^&]*)`).exec(window.location.search);return e&&decodeURIComponent(e[1].replace(/\+/g," "))},e={post(t,e){return this.request("POST",t,e)},get(t,e=""){return this.request("GET",t,e)},request:(t,e,n)=>new Promise((i,o)=>{const a=new XMLHttpRequest;a.open(t,e,!0),a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),a.withCredentials=!0,a.onload=function(){4===a.readyState&&200===a.status&&""!==a.response?i(JSON.parse(a.response)):o(a)},a.onerror=(()=>{o(a)}),a.send(n)})},n=(t,e=!1)=>{const n=t.getFullYear(),i=`0${t.getMonth()+1}`.slice(-2),o=`0${t.getDate()}`.slice(-2);return e?`${n} 年 ${i} 月 ${o} 日`:`${n}-${i}-${o}`},i=t=>{const e=document.createElement("a");e.href=t,e.target="_blank",e.rel="noopener",e.click()},o=t=>t.replace(/ /g,"_"),a=t=>{if("SCRIPT"===t.tagName)return t.parentNode.replaceChild(s(t),t),t;let e=0,n=t.childNodes;for(;e<n.length;)a(n[e++]);return t},s=t=>{let e=document.createElement("script");e.text=t.innerHTML;for(let n=t.attributes.length-1;n>=0;n--)e.setAttribute(t.attributes[n].name,t.attributes[n].value);return e},l=t=>{const e=t.map(t=>t.priority).reduce((t,e)=>Math.min(t,e));return t.filter(t=>e===t.priority)},c="https://octopus.pixanalytics.com/widgets",r="https://octopus.pixanalytics.com/widgets/fuzzy";class h{constructor(t){this.initProperties(t)}initProperties(t){this.project_id=t.project_id,this.platform_name=t.platform_name,this.product_id=t.product_id,this.platform_data=t.platform_data||{},this.widget_type=t.widget_type,this.widget_content=t.widget_content,this.isPreview=t.isPreview,this.octopusTags=t.octopusTags,this.articleTitle=t.articleTitle,this.pv_link=t.pv_link,this.pv_load_link=t.pv_load_link,this.label=t.label||"noLabel",this.click_link=t.click_link,this.zone3_type=t.zone3_type,this.ga=t.widget_content.ga,this.delayTime=1e3,this.supportsPassive=(()=>{let t=!1;try{const e=Object.defineProperty({},"passive",{get:function(){t=!0}});window.addEventListener("test",null,e)}catch(t){}return t})()}initGoogleAnalytics(){var t,e,n,i,o;t=window,e=document,n="ga",t.GoogleAnalyticsObject=n,t.ga=t.ga||function(){(t.ga.q=t.ga.q||[]).push(arguments)},t.ga.l=1*new Date,i=e.createElement("script"),o=e.getElementsByTagName("script")[0],i.async=1,i.src="https://www.google-analytics.com/analytics.js",o.parentNode.insertBefore(i,o),ga("create",this.widget_content.ga,"auto",{name:this.gaName}),ga(`${this.gaName}.send`,"pageview")}recordPaEvent(t){if(this.isPreview)return;_piq.push(["trackEvent","octopusProject",t,this.project_id,Number.parseInt(this.project_id,10)]),_piq.push(["trackEvent","octopusSupplier",t,this.platform_name,Number.parseInt(this.project_id,10)]),_piq.push(["trackEvent","octopusWidget",t,this.widget_type,Number.parseInt(this.project_id,10)]),_piq.push(["trackEvent","octopusProductId",t,this.product_id,Number.parseInt(this.project_id,10)]);const e=this.octopusTags.length;for(let n=0;n<e;n++)_piq.push(["trackEvent","octopusTag",t,this.octopusTags[n],Number.parseInt(this.project_id,10)])}sendTrackEvent(t){(new Image).src=t}}const d=t=>{const e=t.description||"",n=t.img_link||"",i=t.title,o=t.link,a=t.price||"",s=t.original_price||"",l=t.button_name,c=t.html||"";let r="";e&&(r=`<a href="${o}" target="_blank" rel="nofollow noopener"><span class="related__subtitle">${e}</span></a>`);let h="";n&&(h=`<a href="${o}" target="_blank" rel="nofollow noopener"><img class="related__img" src="${n}"></a>`);let d="";return c&&(d=`<a href="${o}" target="_blank" rel="nofollow noopener">${c}</a>`),`\n            <div class="related" data-title="${i}" data-link="${o}" data-price="${a}" data-original-price="${s}" data-description="${e}" data-img-link="${n}" data-button-name="${l}">\n                <a href="${o}" target="_blank" rel="nofollow noopener"><h3 class="related__title">${i}</h3></a>\n                ${r}\n                ${h}\n                ${d}\n                <a class="related__reserve" href="${o}" target="_blank" rel="nofollow noopener">${l}</a>\n            </div>`};class _ extends h{initProperties(t){super.initProperties(t),this.gaName="relatedPrdTracker"}bindEvent(t){t.addEventListener("click",t=>{const e=document.querySelector(".related__content"),n=t.target,o={related__title:"title",related__subtitle:"description",related__img:"image",related__reserve:"button"};let a="other";this.isDescendant(e,n)&&(a="description");for(const t in o)if(0<=n.className.indexOf(t)){a=o[t];break}this.widget_content.link?(this.recordGaEvent("click",!0),this.recordPaEvent("click_"+a),super.sendTrackEvent(`${this.click_link}?position=${a}`),"related"===n.className&&i(`${this.widget_content.link}`)):t.preventDefault()});const e=()=>{window.requestAnimationFrame(()=>{t.offsetTop<window.pageYOffset+window.screen.height&&t.offsetTop+t.offsetHeight>window.pageYOffset&&(super.sendTrackEvent(this.pv_link),this.recordGaEvent("scroll_into_view",!0),window.removeEventListener("scroll",e))})};window.addEventListener("scroll",e,!!this.supportsPassive&&{passive:!0})}isDescendant(t,e){let n=e.parentNode;for(;null!=n;){if(n==t)return!0;n=n.parentNode}return!1}gtmImpsEvent(){dataLayer.push({event:"genericPageview",eventUA:this.widget_content.ga,eventContentGroup1:`${this.project_id}_RP`})}trace(){this.isPreview||(super.initGoogleAnalytics(),super.recordPaEvent("imps"),setTimeout(()=>{this.recordGaEvent("load",!1),this.recordPaEvent("load")},this.delayTime),this.gtmImpsEvent())}recordGaEvent(t,e){this.isPreview||ga(`${this.gaName}.send`,"event",`${this.project_id}_RP`,t,{nonInteraction:!e})}recordPaEvent(t){_piq.push(["trackEvent",`${this.project_id}_RP`,t,this.label])}compileHtml(){return d(this.widget_content)}}const p=(t,e)=>{const i=new Date,o=new Date(i.getTime()+6048e5),a=new Date(i.getTime()+6912e5),s=n(i),l=n(o),c=n(a),r=n(o,!0),h=n(a,!0),d=e.area_en||"",_=e.area_tw||"",p=e.name_en||"",u=e.name_tw||"",g=e.item_count||"",v=e.title,m=e.area_en||"",w=e.button_name||"",k=e.star_rating||"",f=e.image_url||"";let b="";"off"===e.enable_entry_date&&(b='hidden="true"');let $="";return"off"===e.enable_exit_date&&($='hidden="true"'),{hotels_compare:function(){let t="";for(let e=0;e<k;e++)t+='<span class="hotelc__info__star--yellow"></span>';for(let e=k;e<5;e++)t+='<span class="hotelc__info__star--gray"></span>';let e="";f&&(e=`style="background-image: url('${f}')"`);return`<div class="hotelc-box" data-type="hotel" data-place="${d}" data-name-en="${p}" data-name-tw="${u}">\n            <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="display: none;">\n                <defs>\n                    <g id="icon-arrow--down">\n                        <path d="M1 0l5 6.996m0 0L11 0" stroke-linecap="square" stroke="currentColor" fill="none"/>\n                    </g>\n                    <g id="icon-arrow--right" fill="none" fill-rule="evenodd">\n                        <path d="M-349-58H26V2h-375z"/>\n                        <path d="M0 12l6-6M0 0l6 6" stroke="currentColor" stroke-linecap="square"/>\n                    </g>\n                </defs>\n            </svg>\n            <div class="hotelc__header">${v}</div>\n            <div class="hotelc__block1">\n                <a id="hotelc-info" href="https://www.hotelscombined.com.tw/Hotel/Search?fileName=${p}&checkin=${l}&checkout=${c}&rooms=1&adults_1=2&languageCode=TW&a_aid=132653&label=hotelinfoSingle" target="_blank" rel="nofollow noopener">\n                    <div class="hotelc__info">\n                        <div>\n                            <div class="hotelc__info__img" ${e}></div>\n                        </div>\n                        <div>\n                            <div class="hotelc__info__name">${u}</div>\n                            <div class="hotelc__info__place">${_}</div>\n                            <div>\n                                ${t}\n                                <span class="hotelc__info__star__txt">${k}星級飯店</span>\n                            </div>\n                        </div>\n                    </div>\n                </a>\n                <div class="hotelc__date-btn-container">\n                    <div class="hotelc__date-btn" ${b}>\n                        <div class="hotelc__date-btn__text">入住日期</div>\n                        <div class="hotelc__date-btn__date">\n                            <span>${r}</span>\n                            <svg class="icon-arrow--down" viewBox="0 0 12 8">\n                                <use xlink:href="#icon-arrow--down"></use>\n                            </svg>\n                        </div>\n                    </div>\n                    <div class="hotelc__date-btn" ${$}>\n                        <div class="hotelc__date-btn__text">退房日期</div>\n                        <div class="hotelc__date-btn__date">\n                            <span>${h}</span>\n                            <svg class="icon-arrow--down" viewBox="0 0 12 8">\n                                <use xlink:href="#icon-arrow--down"></use>\n                            </svg>\n                        </div>\n                    </div>\n                    <div class="hotelc__date-inputs">\n                        <input class="hotelc__date-input" type="date" value="${l}" min="${s}">\n                        <input class="hotelc__date-input" type="date" value="${c}" min="${c}">\n                    </div>\n                </div>\n            </div>\n            \x3c!-- 資料讀取中 --\x3e\n            <div class="hotelc__loading">\n                <div class="hotelc__loading-icon">資料讀取中</div>\n                <a class="hotelc__loading-link hotelc-links" id="hotelc-link--loading-continue" href="https://www.hotelscombined.com.tw/Hotel/Search?fileName=${p}&checkin=${l}&checkout=${c}&rooms=1&adults_1=2&languageCode=TW&a_aid=132653&label=loadingSingle" target="_blank" rel="nofollow noopener">等不及了嗎，直接前往查看更多</a>\n            </div>\n            <div class="hotelc__result">\n                <ul class="hotelc__result__list single--b"></ul>\n                <div class="hotelc__notes hotelc__notes--last">\n                    <a class="hotelc-links" id="hotelc-link--more" href="https://www.hotelscombined.com.tw/Hotels/Search?destination=place:${d}&checkin=${l}&checkout=${c}&rooms=1&adults_1=2&languageCode=TW&sortField=consumerRating&a_aid=132653&label=moreSingle&sort=MinRate-asc" target="_blank" rel="nofollow noopener">看更多${_}飯店</a><br>\n                    <a class="hotelc-powerby" href="https://www.hotelscombined.com.tw?a_aid=132653&label=powerbySingle" target="_blank" rel="nofollow noopener">\n                        <img src="https://front.pixfs.net/coblog/img/logo--hotelc.png" class="hotelc-powerby__img" alt="資料提供：HotelsCombined">\n                    </a>\n                </div>\n            </div>\n            \x3c!-- 資料錯誤 --\x3e\n            <div class="hotelc__nodata">\n                <div class="hotelc__notes">\n                    由於資料過多<br>\n                    請前往 HotelsCombined 看詳細結果\n                </div>\n                <a class="hotelc__btn hotelc__btn--blue hotelc-links" id="hotelc-link--fail-continue" href="https://www.hotelscombined.com.tw/Hotel/Search?fileName=${p}&checkin=${l}&checkout=${c}&rooms=1&adults_1=2&languageCode=TW&a_aid=132653&label=nodataSingle" target="_blank" rel="nofollow noopener">\n                    立即前往\n                    <svg class="icon-arrow--right" viewBox="0 0 8 12">\n                        <use xlink:href="#icon-arrow--right"></use>\n                    </svg>\n                </a>\n            </div>\n        </div>`}(),hotels_recommend:`<div class="hotelc-box" data-type="place" data-place="${d}" data-name-en="${p}" data-name-tw="${u}" data-item-count="${g}">\n            <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="display: none;">\n                <defs>\n                    <g id="icon-arrow--down">\n                        <path d="M1 0l5 6.996m0 0L11 0" stroke-linecap="square" stroke="currentColor" fill="none"/>\n                    </g>\n                    <g id="icon-arrow--right" fill="none" fill-rule="evenodd">\n                        <path d="M-349-58H26V2h-375z"/>\n                        <path d="M0 12l6-6M0 0l6 6" stroke="currentColor" stroke-linecap="square"/>\n                    </g>\n                </defs>\n            </svg>\n            <div class="hotelc__header">${v}</div>\n            <div class="hotelc__block1">\n                <div class="hotelc__date-btn-container">\n                    <div class="hotelc__date-btn" ${b}>\n                        <div class="hotelc__date-btn__text">入住日期</div>\n                        <div class="hotelc__date-btn__date">\n                            <span>${r}</span>\n                            <svg class="icon-arrow--down" viewBox="0 0 12 8">\n                                <use xlink:href="#icon-arrow--down"></use>\n                            </svg>\n                        </div>\n                    </div>\n                    <div class="hotelc__date-btn" ${$}>\n                        <div class="hotelc__date-btn__text">退房日期</div>\n                        <div class="hotelc__date-btn__date">\n                            <span>${h}</span>\n                            <svg class="icon-arrow--down" viewBox="0 0 12 8">\n                                <use xlink:href="#icon-arrow--down"></use>\n                            </svg>\n                        </div>\n                    </div>\n                    <div class="hotelc__date-inputs">\n                        <input class="hotelc__date-input" type="date" value="${l}" min="${s}">\n                        <input class="hotelc__date-input" type="date" value="${c}" min="${c}">\n                    </div>\n                </div>\n            </div>\n            \x3c!-- 資料讀取中 --\x3e\n            <div class="hotelc__loading">\n                <div class="hotelc__loading-icon">資料讀取中</div>\n                <a class="hotelc__loading-link hotelc-links" id="hotelc-link--loading-continue" href="https://www.hotelscombined.com.tw/Hotels/Search?destination=place:${m}&checkin=${l}&checkout=${c}&rooms=1&adults_1=2&languageCode=TW&sortField=consumerRating&a_aid=132653&label=loadingArea" target="_blank" rel="nofollow noopener">等不及了嗎，直接前往查看更多</a>\n            </div>\n            <div class="hotelc__result">\n                <ul class="hotelc__result__list multi--b"></ul>\n                <a class="hotelc__btn hotelc__btn--green hotelc-links" id="hotelc-link--more" href="https://www.hotelscombined.com.tw/Hotels/Search?destination=place:${m}&checkin=${l}&checkout=${c}&rooms=1&adults_1=2&languageCode=TW&sortField=consumerRating&a_aid=132653&label=moreArea" target="_blank" rel="nofollow noopener">\n                    ${w}\n                    <svg class="icon-arrow--right" viewBox="0 0 8 12">\n                        <use xlink:href="#icon-arrow--right"></use>\n                    </svg>\n                </a>\n                <div class="hotelc__notes hotelc__notes--last">\n                    <a class="hotelc-powerby" href="https://www.hotelscombined.com.tw?a_aid=132653&label=powerbyArea" target="_blank" rel="nofollow noopener">\n                        <img src="https://front.pixfs.net/coblog/img/logo--hotelc.png" class="hotelc-powerby__img" alt="資料提供：HotelsCombined">\n                    </a>\n                </div>\n            </div>\n            \x3c!-- 資料錯誤 --\x3e\n            <div class="hotelc__nodata">\n                <div class="hotelc__notes">\n                    由於資料過多<br>\n                    請前往 HotelsCombined 看詳細結果\n                </div>\n                <a class="hotelc__btn hotelc__btn--blue hotelc-links" id="hotelc-link--fail-continue" href="https://www.hotelscombined.com.tw/Hotels/Search?destination=place:${m}&checkin=${l}&checkout=${c}&rooms=1&adults_1=2&languageCode=TW&sortField=consumerRating&a_aid=132653&label=nodataArea" target="_blank" rel="nofollow noopener">\n                    立即前往\n                    <svg class="icon-arrow--right" viewBox="0 0 8 12">\n                        <use xlink:href="#icon-arrow--right"></use>\n                    </svg>\n                </a>\n            </div>\n        </div>`,hotels_search:'<div class="hotels-search">\n            <ins class="bookingaff" data-aid="846006" data-target_aid="835804" data-prod="nsb" data-width="265" data-height="360" data-lang="xt" data-currency="TWD">\n            \x3c!-- Anything inside will go away once widget is loaded. --\x3e\n                <a href="https://www.booking.com?aid=835804" target="_blank" rel="nofollow noopener">Booking.com</a>\n            </ins>\n        </div>'}[t]||""};class u extends h{initProperties(t){super.initProperties(t),this.gaName="hotelcTracker",this.widget_content.ga="UA-65168598-12",this.platform_data.date={},this.label=t.label,this.firstResult=!0,this.isHotel="hotels_compare"===this.widget_type,this.today=new Date,this.todayStr=this.formateDate(this.today),this.stateNow="loading",this.defaultDate={hotelcCheckin:this.formateDate(new Date(this.today.getTime()+6048e5)),hotelcCheckout:this.formateDate(new Date(this.today.getTime()+6912e5))},this.isHotelRecommendDiy="hotel_recommend_diy"===t.widget_type,this.traceResult={result:()=>{this.recordGaEvent("API result","API戳成功"),this.recordHotelcPaEvent("load")},fail:()=>{this.recordGaEvent("API result","API戳失敗"),this.recordHotelcPaEvent("load hotel fail")},nodata:()=>{this.recordGaEvent("API result","API戳成功_沒有飯店"),this.recordHotelcPaEvent("load hotel fail")}}}compileHtml(){const t=Object.assign({},this.widget_content,this.platform_data);return this.isHotelRecommendDiy?this.widget_content.html:p(this.widget_type,t)}compileScript(){const t=document.createElement("script");t.innerHTML='\n            (function(d, sc, u) {\n                var s = d.createElement(sc), p = d.getElementsByTagName(sc)[0]; s.type = \'text/javascript\';\n                s.async = true;\n                s.src = u + \'?v=\' + (+new Date());\n                p.parentNode.insertBefore(s,p);\n            })(document, \'script\', \'https://aff.bstatic.com/static/affiliate_base/js/flexiproduct.js\');\n            dataLayer.push({\n                "c2a" : "hotels",\n                "event" : "hotelc2a-hcsearch-imp",\n                "eventLabel": "BK2"\n            });',document.getElementsByTagName("head")[0].appendChild(t)}trace(){if(this.isHotelRecommendDiy)return void this.initGoogleAnalytics();this.initSets();const t=this.hotelcBlock.result.querySelectorAll(".hotelc__table--avg--link"),e=t.length;for(let n=0;n<e;n++){const e=t[n].dataset.label;this.recordHotelLabelPaEvent("imps",e)}}initGoogleAnalytics(){super.initGoogleAnalytics(),this.contentGaGroup()}initSets(){this.initGoogleAnalytics(),this.initDomElement(),this.initDate()}bindEvent(t){this.isHotelRecommendDiy?this.bindScrollIntoView(t):(t.addEventListener("click",t=>{const e=t.target;let n;if(!this.hotelcBlock.result.contains(e)||e.classList.contains("hotelc__notes"))return;let i="other";if(this.hotelcBlock.hotels.contains(e)){const t={hotelc__img:"image",hotelc__info__name:"title",hotelc__info__rating:"description",hotelc__info__place:"description",hotelc__logo:"description",hotelc__price:"description",hotelc__compare:"description"};let n=this.findAncestor(e,"hotelc__table--avg--link"),o=(n&&n.dataset||{}).name;for(const n in t)if(0<=e.className.indexOf(n)){i=t[n];break}super.sendTrackEvent(`${this.click_link}?position=${i}&extra=${o}`)}switch(e.id){case"hotelc-info":return this.recordGaEvent("導流 click","click_hotel info"),void this.recordHotelcPaEvent("click_hotel info");case"hotelc-link--more":return n=this.isHotel?"click_hotel_more word":"click_hotel_more button",this.recordGaEvent("導流 click",n),this.recordHotelcPaEvent("click_button"),void super.sendTrackEvent(`${this.click_link}?position=button`);case"hotelc-link--more-price":return this.recordGaEvent("導流 click","click_price compare_button"),this.recordHotelcPaEvent("click_button"),void super.sendTrackEvent(`${this.click_link}?position=button`);case"hotelc-link--loading-continue":return void this.recordGaEvent("導流 click","click_Continue_loading");case"hotelc-link--fail-continue":return void this.recordGaEvent("導流 click","click_Continue_nodata")}if("hotelc-powerby__img"===e.className)return this.recordGaEvent("導流 click","click_hclogo"),this.recordHotelcPaEvent("click_description"),void super.sendTrackEvent(`${this.click_link}?position=description`);const o=e.dataset.label;n=this.isHotel?"click_price compare":"click_hotel_list",this.recordGaEvent("導流 click",n,o),this.recordHotelcPaEvent("click_"+i),super.recordPaEvent("click")}),this.bindInputBtn(),this.bindScrollIntoView(t))}bindScrollIntoView(t){const e=()=>{window.requestAnimationFrame(()=>{t.offsetTop<window.pageYOffset+window.screen.height&&t.offsetTop+t.offsetHeight>window.pageYOffset&&(super.sendTrackEvent(this.pv_link),super.recordPaEvent("imps"),this.recordHotelcPaEvent("imps"),this.recordGaEvent("scroll_into_view","scroll_into_view"),window.removeEventListener("scroll",e))})};window.addEventListener("scroll",e,!!this.supportsPassive&&{passive:!0})}findAncestor(t,e){return t.classList.contains(e)?t:t.classList.contains("octopus")?t:this.findAncestor(t.parentElement,e)}contentGaGroup(){const t=this.isHotel?"Hotel Compare Prices":"Hotel Recommend";ga(`${this.gaName}.set`,"contentGroup1",this.platform_data.name_en),ga(`${this.gaName}.set`,"contentGroup2",t)}initDomElement(){this.inputBtn={fake:document.getElementsByClassName("hotelc__date-btn__date"),true:document.getElementsByClassName("hotelc__date-input")},this.links=document.getElementsByClassName("hotelc-links"),this.hotelcBlock={info:document.getElementsByClassName("hotelc__info")[0],loading:document.getElementsByClassName("hotelc__loading")[0],result:document.getElementsByClassName("hotelc__result")[0],fail:document.getElementsByClassName("hotelc__nodata")[0],hotels:document.getElementsByClassName("hotelc__result__list")[0]}}initDate(){const t=t=>{const e=function(t){const e=`; ${document.cookie}`.split(`; ${t}=`);if(2===e.length)return e[1].split(";")[0];return!1}(t);return e&&e>this.defaultDate[t]?e:this.defaultDate[t]};this.changeHotelcDate(t("hotelcCheckin"),t("hotelcCheckout")),this.inputBtn.true[0].value=this.platform_data.date.checkin,this.inputBtn.true[1].value=this.platform_data.date.checkout,this.changeDateZh(0,this.platform_data.date.checkin),this.changeDateZh(1,this.platform_data.date.checkout)}getHotelData(){const t={a_aid:132653,checkin_date:this.platform_data.date.checkin,checkout_date:this.platform_data.date.checkout,label:this.label};var e,n;this.isHotel?(t.type="hotel",t.hotel_name=o(this.platform_data.name_en)):(t.type="place",t.hotel_place=o(this.platform_data.area_en),t.limit=this.widget_content.item_count||3),(e="https://hotels-collaborate.events.pixnet.net/api/hotelscombined.php",n=t,new Promise((t,i)=>{const o=new XMLHttpRequest;let a=`${e}?a_aid=${n.a_aid}&type=${n.type}&checkin_date=${n.checkin_date}&checkout_date=${n.checkout_date}&label=${n.label}&`;a+="hotel"===n.type?`hotel_name=${n.hotel_name}`:`hotel_place=${n.hotel_place}&limit=${n.limit}`,o.open("GET",a,!0),o.onload=(()=>{200===o.status?t(o.response):i(o)}),o.onerror=(()=>{i(o)}),o.send()})).then(t=>{const e=JSON.parse(t);this.isHotel&&e.order_info?this.showResult(e.order_info):e.hotels&&Array.isArray(e.hotels)?this.showResult(e.hotels):this.changeState("nodata")},()=>{this.changeState("fail")})}changeState(t){"loading"!==t&&this.traceResult[t]();(()=>{"nodata"===t&&(t="fail"),this.hotelcBlock[this.stateNow].style.display="none",this.stateNow=t,this.hotelcBlock[t].style.display="block"})()}showResult(t){let e="";const n=t.length;if(this.isHotel){for(let a=0;a<n;a++){let n=`<li class="hotelc__table--highline hotelc__table--highline--red">\n                        <a class="hotelc__table--avg hotelc__table--avg--link hotelc__table--avg--inside-border hotelc__table--avg--60" href="${t[a].book_url}" target="_blank" data-label="1-${o(t[a].logo)}-${this.platform_data.name_tw}" data-name="${t[a].name}">\n                            <div>\n                                <div class="hotelc__logo" style="background-image: url('${t[a].logo}')"></div>\n                            </div>\n                            <div>\n                                <div class="hotelc__price hotelc__price--red">NT$<span>${i(t[a].price)}</span></div>\n                            </div>\n                        </a>\n                    </li>\n                    <a class="hotelc__btn hotelc__btn--red" id="hotelc-link--more-price" href="${t[a].book_url}" target="_blank">${this.widget_content.button_name}\n                        <svg class="icon-arrow--right" viewBox="0 0 8 12"><use xlink:href="#icon-arrow--right"></use></svg>\n                    </a>`;0<a&&(n=`<li class="border-top-1">\n                            <a class="hotelc__table--avg hotelc__table--avg--link hotelc__table--avg--inside-border hotelc__table--avg--60" href="${t[a].book_url}" target="_blank" data-label="${a+1}-${o(t[a].logo)}-${this.platform_data.name_tw}">\n                                <div>\n                                    <div class="hotelc__logo" style="background-image: url('${t[a].logo}')"></div>\n                                </div>\n                                <div>\n                                    <div class="hotelc__price">NT$<span>${i(t[a].price)}</span></div>\n                                </div>\n                            </a>\n                        </li>`),"https://cdn.datahc.com/Images/providers/logos/"===t[a].logo&&(n=n.replace(` style="background-image: url('${t[a].logo}')"`,"")),e+=n}this.hotelcBlock.result.querySelectorAll(".hotelc__result__list")[0].innerHTML=e}else{for(let a=0;a<n;a++){let n=`<li class="hotelc__result--multi border-top-1">\n                        <a class="hotelc__table--avg--link" href="${t[a].book_url}" target="_blank" data-label="${a+1}-${o(t[a].logo)}-${t[a].name}" data-name="${t[a].name}">\n                            <div class="hotelc__table--avg hotelc__table--avg--scale">\n                                <div>\n                                    <div class="full-width">\n                                        <img src="${t[a].hotel_img}" class="hotelc__img">\n                                    </div>\n                                </div>\n                                <div>\n                                    <div class="full-width wrap-normal">\n                                        <span class="hotelc__info__rating">網友評分：${t[a].guest_rating}</span>\n                                        <br>\n                                        <span class="hotelc__info__name">${t[a].name}</span>\n                                        <br>\n                                        <span class="hotelc__info__place">${t[a].place_name}</span>\n                                    </div>\n                                </div>\n                            </div>\n                            <div class="hotelc__table--avg hotelc__table--avg--inside-border hotelc__table--avg--60">\n                                <div>\n                                    <div class="hotelc__logo" style="background-image: url('${t[a].logo}')"></div>\n                                </div>\n                                <div>\n                                    <div class="text-right nowrap">\n                                        <div class="hotelc__price hotelc__price--green">NT$<span>${i(t[a].price)}</span>\n                                            <svg class="icon-arrow--right" viewBox="0 0 8 12">\n                                                <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#icon-arrow--right"></use>\n                                            </svg>\n                                        </div>\n                                        <div class="hotelc__compare">比較 ${t[a].providers_num} 個網站最低價</div>\n                                    </div>\n                                </div>\n                            </div>\n                        </a>\n                    </li>`;t[a].hotel_img||(n=n.replace(`<img src="${t[a].hotel_img}">`,"")),"https://cdn.datahc.com/Images/providers/logos/"===t[a].logo&&(n=n.replace(` style="background-image: url('${t[a].logo}')"`,"")),e+=n}this.hotelcBlock.result.querySelectorAll("ul")[0].innerHTML=e}function i(t){return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}function o(t){let e=t.split("/");return e=e[e.length-1].split("-")[0].split(".")[0]}this.changeState("result")}bindInputBtn(){const t=()=>{const t=this.inputBtn.true[0].value,e=this.inputBtn.true[1].value;this.todayStr<=t&&t<e&&(this.changeHotelcDate(t,e),this.changeState("loading"),setTimeout(()=>{this.getHotelData()},500))};t();const e=()=>{const i=this.inputBtn.true[1].value,o=!isNaN(new Date(i).getTime()),a=this.inputBtn.true[1].getAttribute("min"),s=new Date(new Date(i).getTime()-864e5),l=this.formateDate(s);o?(this.changeDateZh(1,this.inputBtn.true[1].value),this.inputBtn.true[0].value>=i?(this.inputBtn.true[0].value=l,n()):t()):(this.inputBtn.true[1].value=a,this.changeDateZh(1,this.today),e())},n=()=>{const i=this.inputBtn.true[0].value,o=!isNaN(new Date(i).getTime()),a=new Date(new Date(i).getTime()+864e5),s=this.formateDate(a);!o||this.todayStr>i?(this.inputBtn.true[0].value=this.todayStr,this.changeDateZh(0,this.today),n()):(this.changeDateZh(0,i),this.inputBtn.true[1].setAttribute("min",s),this.inputBtn.true[1].value<=i?(this.inputBtn.true[1].value=s,e()):t())};this.inputBtn.fake[0].addEventListener("click",()=>{this.inputBtn.true[0].click(),this.inputBtn.true[0].focus(),this.recordGaEvent("互動 click","check in"),this.recordHotelcPaEvent("click_check in")}),this.inputBtn.fake[1].addEventListener("click",()=>{this.inputBtn.true[1].click(),this.inputBtn.true[1].focus(),this.recordGaEvent("互動 click","check out"),this.recordHotelcPaEvent("click_check out")}),this.inputBtn.true[0].addEventListener("change",n),this.inputBtn.true[1].addEventListener("change",e)}changeHotelcDate(t,e){const n=(t,e)=>{if(/^(\d{4})-(\d{2})-(\d{2})$/.test(e)&&!isNaN(new Date(e).getTime())){const n=(new Date).setTime(this.today.getTime()+6048e5);document.cookie=`${t}=${e};domain=.pixnet.net;path=/;expires=${new Date(n).toGMTString()}`}},i=`checkin=${this.platform_data.date.checkin}&checkout=${this.platform_data.date.checkout}`,o=`checkin=${t}&checkout=${e}`,a=this.links.length;for(let t=0;t<a;t++){const e=this.links[t].getAttribute("href").replace(i,o);this.links[t].setAttribute("href",e)}this.platform_data.date.checkin=t,this.platform_data.date.checkout=e,n("hotelcCheckin",t),n("hotelcCheckout",e)}changeDateZh(t,e){const n=new Date(e);this.inputBtn.fake[t].querySelectorAll("span")[0].textContent=`${n.getFullYear()} 年 ${n.getMonth()+1} 月 ${n.getDate()} 日`}formateDate(t){return`${t.getFullYear()}-${`0${t.getMonth()+1}`.slice(-2)}-${`0${t.getDate()}`.slice(-2)}`}recordGaEvent(t,e,n){ga(`${this.gaName}.send`,"event",t,e,n)}recordHotelcPaEvent(t){const e=this.isHotel?"Hotel Compare Prices":"Hotel Recommend";_piq.push(["trackEvent",e,t,this.label])}recordHotelLabelPaEvent(t,e){_piq.push(["trackEvent","octopusHotelLabel",t,`${this.label}:::${e}`])}}class g{constructor(e=[]){this.categoryId="",this.octopusTags=[],this.articleTitle="",this.widgetParams="",this.fuzzyWidgetParams="",this.articleTitle="",this.octopusDom={},this.projectId=t("project_id")||"",this.isPreview=!!this.projectId,this.zone1=[],this.zone2=[],this.zone3=[],this.activeCta="",this.activeRp="",this.init(e)}init(t){this.setConfig(t),this.serializeData()}setConfig(t){t.map(t=>{const e=t[0],n=t[1];e in this&&"function"!=typeof n&&(this[e]=n)})}serializeData(){this.fuzzyWidgetParams=`?category_id=${this.categoryId}&article_title=${encodeURIComponent(this.articleTitle)}&project_id=${this.projectId}`,this.widgetParams=this.octopusTags.map(t=>`tags[]=${encodeURIComponent(t)}`).join("&"),this.widgetParams+=`&category_id=${this.categoryId}&article_title=${encodeURIComponent(this.articleTitle)}&project_id=${this.projectId}`}async run(){try{const t=await e.get(r+this.fuzzyWidgetParams);if(0!==this.octopusTags.length||this.isPreview){const n=await e.post(c,this.widgetParams);if(t.error&&n.error)return void this.noMatchWidget();this.addWidgets(n)}else if(t.error)return void this.noMatchWidget();this.addWidgets(t),this.generate()}catch(t){}}addWidgets(t){t.error||t.widgets&&(t.widgets.Zone1&&this.zone1.push(t.widgets.Zone1),t.widgets.Zone2&&this.zone2.push(t.widgets.Zone2),t.widgets.Zone3&&this.zone3.push(t.widgets.Zone3))}generate(){const t=this.couldShowOctopus();t.zone1?this.setOctopusIntoZone(this.zone1,1):this.noMatchRelated(),t.zone2&&this.setOctopusIntoZone(this.zone2,2),t.zone3?this.setOctopusIntoZone(this.zone3,3):this.noMatchCta()}setOctopusIntoZone(t,e){const n=l(t),i=n[Math.floor(Math.random()*n.length)];let o;switch(i.isPreview=this.isPreview,i.octopusTags=this.octopusTags,e){case 1:this.activeRp=i.widget_type,o=new _(i);break;case 2:o=new u(i);break;case 3:this.activeCta=i.widget_type,window.PixnetHappixPilot&&PixnetHappixPilot.setGiftNotificationData(i)}Array.from(this.octopusDom).map(t=>{t.dataset.zone===e.toString()&&"done"!==t.dataset.process&&(t.innerHTML=o.compileHtml(),o.isHotelRecommendDiy&&(a(t),t.classList.add("recommend-diy")),o.trace(),o.bindEvent(t),t.dataset.process="done")})}couldShowOctopus(){const t={zone1:!0,zone2:!0,zone3:!0};return Array.from(this.octopusDom).some(t=>"1"===t.dataset.zone)||(t.zone1=!1),Array.from(this.octopusDom).some(t=>"2"===t.dataset.zone)||(t.zone2=!1),Array.from(this.octopusDom).some(t=>"3"===t.dataset.zone)||(t.zone3=!1),0===this.zone1.length&&(t.zone1=!1),0===this.zone2.length&&(t.zone2=!1),0===this.zone3.length&&(t.zone3=!1),"cta_diy"===this.activeCta&&(t.zone3=!1),t}noMatchRelated(){this.activeRp="ctaRelated"}noMatchCta(){window.PixnetHappixPilot&&PixnetHappixPilot.activateHappixNotificationFlow(),this.activeCta=this.activeCta||"eztableOrHotels"}noMatchWidget(){this.noMatchRelated(),this.noMatchCta()}getActiveOctopus(){return{activeRp:this.activeRp,activeCta:this.activeCta}}}(async t=>{const e=new g(t._oq);await e.run(),t.pix.activeRp=e.getActiveOctopus().activeRp,t.pix.activeCta=e.getActiveOctopus().activeCta})(window),window.OctopusSDK=g}();
