function html5localStorage(){try{return localStorage.setItem("z","z"),localStorage.removeItem("z"),!0}catch(e){return!1}}function createCookieExpireHour(e,t,o){if(o){var n=new Date;n.setTime(n.getTime()+60*o*60*1e3);var a="";a=""+n.toGMTString()}else var a="";document.cookie=e+"="+t+"; expires="+a+";path=/"}function createCookie(e,t,o){if(o){var n=new Date;n.setTime(n.getTime()+864e5);var a="";a=""+n.toGMTString()}else var a="";document.cookie=e+"="+t+"; expires="+a+";path=/"}function GetCookie(e){for(var t=e+"=",o=t.length,n=document.cookie.length,a=0;a<n;){var i=a+o;if(document.cookie.substring(a,i)==t)return GetCookieVal(i);if(a=document.cookie.indexOf(" ",a)+1,0==a)break}return null}function GetCookieVal(e){var t=document.cookie.indexOf(";",e);return t==-1&&(t=document.cookie.length),unescape(document.cookie.substring(e,t))}function setCookie(e,t,o,n,a,i){var r=encodeURIComponent(e)+"="+encodeURIComponent(t);o instanceof Date&&(r+="; expires="+o.toGMTString()),r+="; path=/",a&&(r+="; domain="+a),i&&(r+="; secure"),document.cookie=r}function DeleteCookie(e){createCookie(e,"",-1)}function initParentCommentPOImg(){function e(a){var i=58*ParentCommentPOImgCount;a<0&&(a=n/ParentCommentPOImgCount-1),a>=n/ParentCommentPOImgCount&&(a=0),TweenMax.killDelayedCallsTo(e),TweenMax.to(o,1,{left:-i*a,ease:Power3.easeInOut}),t.attr("data-channel",a)}var t=$("#ParentCommentPOImg"),o=t.find(".commentimgList"),n=o.find(".listItem").length;t.length&&(t.find(".rBtn").on("click",function(){var o=parseInt(t.attr("data-channel"));e(o+1)}),t.find(".lBtn").on("click",function(){var o=parseInt(t.attr("data-channel"));e(o-1)}))}var App={conf:{cache_root:"par.",cacheable:html5localStorage()},closeColorBox:function(){$.colorbox.close()},init:function(){setInterval(App._keepalive,3e5),App.initDropdown(),$("#menu-button").on("click",function(){$("#member-menu").slideUp(),$("#notice-menu").slideUp(),$("#main-menu").slideToggle(400,function(){$("#menu-button").toggleClass("menu-opened")}).promise().done(function(){$("body").toggleClass("fixed","block"==$("#main-menu").css("display"))})}),$(".header .user .member").on("click",function(e){$("#menu-button").removeClass("menu-opened"),$("#main-menu").slideUp(),$("#notice-menu").slideUp(),$("#member-menu").slideToggle(400,function(){$(".header .user .member").toggleClass("menu-opened")}).promise().done(function(){$("body").toggleClass("fixed","block"==$("#member-menu").css("display"))})}),$(".header .user .notice").on("click",function(e){$("#menu-button").removeClass("menu-opened"),$("#main-menu").slideUp(),$("#member-menu").slideUp(),$("#notice-menu").slideToggle(400,function(){$(".header .user .notice").toggleClass("menu-opened")}).promise().done(function(){$("body").toggleClass("fixed","block"==$("#notice-menu").css("display"))})}),$("body").on("click",".main-menu .expand",function(){$(this).toggleClass("icon-minus").toggleClass("icon-plus"),$(this).parent().find("ul").slideToggle()}),$("body").on("click",".bookmark, .follow",function(e){e.preventDefault(),App.fav.toggle(this)}),$(".clozBtn").on("click",function(e){e.preventDefault(),$.colorbox.close()}),$(".search-form").on("submit",function(e){var t=$(this).find(".siteSearch").val();return 0!=t.length||(alert("請輸入關鍵字"),!1)}),$("#memberpaper-form").on("submit",function(e){e.preventDefault(),$.post("/member/memberpaper",$("#memberpaper-form").serialize(),function(e){1==e.success?1==e.newuserflag?(alert("謝謝您完成親子天下註冊！親子幣500已入帳，可以在會員區確認唷。"),location.href="/"):alert("資料已更新！"):alert("資料更新失敗！")},"JSON")}),$("#login-form").on("submit",function(e){e.preventDefault()}),$("#login-form input[type=submit]").on("click",function(e){e.preventDefault(),App.doLogin()}),$("#send-form").on("submit",function(e){e.preventDefault()}),$("#pop_noEmail input[type=submit]").on("click",function(e){e.preventDefault(),App.sendAgain()}),$("#pop_signIn_2 a.send_again").on("click",function(e){e.preventDefault(),App.auth.showPopNoEmailDialog()}),$("#verify-form").on("submit",function(e){e.preventDefault()}),$("#pop_verifycode input[type=submit]").on("click",function(e){e.preventDefault(),App.verifycode()}),$("#mem-form").on("submit",function(e){e.preventDefault()}),$("#pop_signIn_3 input[type=submit]").on("click",function(e){e.preventDefault(),App.auth.family()}),$("#pop_thx div.closebtn").on("click",function(e){$(".popPage").addClass("hide")}),$("body").on("click",".addBookmark, .addFollow",function(e){ga("send","event","button","click","m_addBookmark"),e.preventDefault(),0==isLoggedIn?(alert("請先登入"),location.href="/login/?redir="+location.href):App.fav.toggle(this)}),$("body").on("click",".shareBtn_fb",function(e){console.log(123),ga("send","event","button","click","m_shareBtn_fb"),e.preventDefault();var t=$(this).data("type"),o=$(this).data("url");App.fbShare(t,o)}),$("body").on("click",".shareBtn_gp",function(e){ga("send","event","button","click","m_shareBtn_gp"),e.preventDefault();var t=$(this).data("type"),o=$(this).data("url");App.gpShare(t,o)}),$("#shareToMail-form").on("submit",function(e){e.preventDefault()}),$("#shareToMail-form input[type=submit]").on("click",function(e){e.preventDefault(),$(this).fadeTo(200,.25).data("loading",App._now()),App.shareToMail()})},initDropdown:function(){var e=$(".pyear-select"),t=$(".pmonth-select"),o=$(".pday-select"),n=(new Date).getFullYear();e.empty(),t.empty(),o.empty(),e.each(function(){for(var e=$(this),t=e.attr("data-val"),o=1930;o<n+1;o++)e.append('<option value="'+o+'">'+o+"</option>");e.prepend('<option value="-1" selected>年</option>'),void 0!=t&&""!=t&&e.val(t)}),t.each(function(){for(var e=$(this),t=e.attr("data-val"),o=1;o<13;o++)e.append('<option value="'+o+'">'+o+"</option>");e.prepend('<option value="-1" selected>月</option>'),void 0!=t&&""!=t&&e.val(t)}),o.each(function(){for(var e=$(this),t=e.attr("data-val"),o=1;o<32;o++)e.append('<option value="'+o+'">'+o+"</option>");e.prepend('<option value="-1" selected>日</option>'),void 0!=t&&""!=t&&e.val(t)});var a=$(".year-select"),i=$(".month-select"),n=(new Date).getFullYear();a.empty(),i.empty(),a.each(function(){for(var e=$(this),t=e.attr("data-val"),o=1990;o<n+1;o++)e.append('<option value="'+o+'">'+o+"</option>");e.prepend('<option value="-1" selected>年</option>'),void 0!=t&&""!=t&&e.val(t)}),i.each(function(){for(var e=$(this),t=e.attr("data-val"),o=1;o<13;o++)e.append('<option value="'+o+'">'+o+"</option>");e.prepend('<option value="-1" selected>月</option>'),void 0!=t&&""!=t&&e.val(t)})},initMainRightBar:function(){$("#r_recommendRankBox").find(".tabItem").on("click",function(){if(!$(this).hasClass("active")){var e=$(this);e.addClass("active").siblings().removeClass("active"),e.closest(".rankContainer").find(".articleWrap").find(".rBarList").eq(e.index()).removeClass("hide").siblings().addClass("hide")}})},showUserMenu:function(){var e=$("#user-menu");e.data("entered",App._now()).data("left",0),0==e.hasClass("on")&&$("#user-menu").addClass("on").fadeTo(0,0).css("display","block").fadeTo(100,1),setTimeout(App.hideUserMenu,2e3)},showShareToMail:function(){},shareToMail:function(e){var t=document.forms["shareToMail-form"];$.post(t.action,$("#shareToMail-form").serialize(),function(e){$("#shareToMail-form .submit").fadeTo(0,1),0==e.success&&alert(e.msg),1==e.success&&(alert("傳送成功"),t.reset(),window.close())},"json")},profile_pic:function(e){$.post("/api/profile-pic/",{pic:e},function(e){1==e.success?$("#memberBar .picWrap .profile_pic").prop("src",e.pic_uri):alert(e.msg)})},hideUserMenu:function(){var e=$("#user-menu"),t=parseInt(e.data("entered"),10),o=parseInt(e.data("left"),10);if(0!=e.hasClass("on")&&0!=o)return o-1>t||o>0&&App._now()>o+1?void e.removeClass("on").fadeTo(100,0,function(){e.css("display","none")}):void setTimeout(App.hideUserMenu,1e3)},auth:{isLoggedIn:function(){$.post("/api/isLoggedIn/",{t:1},function(e){1==e.success?($(".h_memberBox .coinNum").html(e.msg.coin),$("#h_memberBox").removeClass("hide")):$(".user .btn-green").removeClass("hide")},"json")},showLoginDialog:function(e){if("undefined"!=typeof e)location.href="/login/?"+e;else{var t=location.search;location.href="/login/"+t}},showRegisterDialog:function(e){var t=location.search;location.href="/login/register"+t},showPopNoEmailDialog:function(e){var t=location.search;location.href="/login/send-again"+t},showPopSignIn3Dialog:function(e){var t=location.search;location.href="/member/family"+t},showVerifycodeDialog:function(e){},showThxDialog:function(e){}},fav:{toggle:function(e){var t=$(e).data("method"),o="/api/"+(t?t:"fav"),n={};"undefined"!=typeof e&&("link"==$(e).data("type")&&(n.link=$(e).data("link"),n.type=$(e).data("type"),"unfav"==t?($(e).removeClass("active"),$(e).data("method","fav")):($(e).addClass("active"),$(e).data("method","unfav"))),"reading"==$(e).data("type")&&(n.link=$(e).data("link"),n.type=$(e).data("type"),"unfav"==t?($(e).removeClass("active"),$(e).data("method","fav")):($(e).addClass("active"),$(e).data("method","unfav"))),"hashtag"==$(e).data("type")&&(n.post_id=$(e).data("post"),n.type=$(e).data("type"),n.post_link=$(e).data("link"),"unfav"==t?($(e).removeClass("active"),$(e).data("method","fav")):($(e).addClass("active"),$(e).data("method","unfav"))),"columnist"==$(e).data("type")&&(n.columnist_id=$(e).data("columnist"),"unfav"==t?($(e).html('+ 追蹤 <i class="icon-heart-o"></i>'),$(e).data("method","fav")):($(e).html('- 取消追蹤 <i class="icon-heart-o"></i>'),$(e).data("method","unfav"))),"expert"==$(e).data("type")&&(n.expert_id=$(e).data("expert"),"unfav"==t?($(e).html('+ 追蹤 <i class="icon-heart-o"></i>'),$(e).data("method","fav")):($(e).html('- 取消追蹤 <i class="icon-heart-o"></i>'),$(e).data("method","unfav"))),"reading_expert"==$(e).data("type")&&(n.reading_expert_id=$(e).data("expert"),"unfav"==t?($(e).html('+ 追蹤 <i class="icon-heart-o"></i>'),$(e).data("method","fav")):($(e).html('- 取消追蹤 <i class="icon-heart-o"></i>'),$(e).data("method","unfav"))),$.post(o,n,function(o){console.log(o),1==o.success?(o.msg.length>0&&alert(o.msg),"unfav"==t&&($(e).parents(".m_followBox").remove(),$(e).parents("li.listItem").remove(),$(".memberPage_title").size()>0&&($("#mainContainer>.tabWrap>.tab:eq(2)").hasClass("active")?$(".mBox>.pTxt").html("("+$(".m_followBox").size()+")"):location.reload()))):alert(o.msg)},"json"))},doFlyingHeart:function(e,t){var o=$("#nav .n4"),n=o.offset().left+49,a=37;$("body").append('<i class="bookmark-flyer"></i>'),dur=1e3,t>600?dur=1250:t>2e3&&(dur=1500),$(".bookmark-flyer").css({left:e+"px",top:t+"px"}).animate({left:n+"px",top:a+"px"},dur,function(){$(this).fadeTo(200,0,function(){$(this).remove()})})},underline:function(){}},search:function(e){$(e).parents(".search-form").submit()},article_exchange:function(){},_now:function(){return Math.round((new Date).getTime()/1e3)},_time:function(){return(new Date).getTime()},_ts2date:function(e){var t=new Date(1e3*e),o=t.getFullYear(),n=APP._pad0(t.getMonth()+1,2),a=APP._pad0(t.getDate(),2);return""+o+"-"+n+"-"+a},_ts2time:function(e){var t=new Date(1e3*e),o=APP._pad0(t.getHours(),2),n=APP._pad0(t.getMinutes(),2),a=APP._pad0(t.getSeconds(),2);return""+o+":"+n+":"+a},_ts2human:function(e,t){var o=new Date(1e3*e),n=APP._pad0(o.getHours(),2),a=APP._pad0(o.getMinutes(),2);switch(t){default:return""+APP.conf.months[o.getMonth()]+" "+o.getDate()+", "+n+":"+a}},_mins2human:function(e,t){switch(t){case"hhmm":case"0000":return""+App._pad0(Math.floor(e/60),2)+App._pad0(Math.round(e%60),2);case"H:i":case"00:00":return App._pad0(Math.floor(e/60),2)+":"+App._pad0(Math.round(e%60),2);case"travel":return e<60?e+"分鐘":Math.floor(e/60)+"小時"+(e%60>0?e%60+"分鐘":"")}},_human2mins:function(e,t){switch(t){case"hhmm":case"0000":return 60*parseInt(e.substr(0,2),10)+parseInt(e.substr(2,2),10);case"H:i":case"00:00":return 60*parseInt(e.substr(0,2),10)+parseInt(e.substr(3,2),10)}},_pad0:function(e,t){for(var o=""+e;o.length<t;)o="0"+o;return o},_nl2br:function(e){return e.replace(/\n/g,"<br>")},_escapeHtml:function(e){var t=document.createElement("div");return t.appendChild(document.createTextNode(e)),t.innerHTML},_rand:function(e,t){var o=t-e;return e+Math.round(Math.random()*o)},_chance:function(e){return Math.random()<e},_isArray:function(e){return"[object Array]"===Object.prototype.toString.apply(e)},_log:function(e){if("undefined"!=typeof console&&console.log)try{console.log(e)}catch(e){}},_keepalive:function(){$.post("/api/keepalive/",{t:App._now()},function(e){})},_track:function(e,t,o){try{"string"!=typeof o&&(o=""),ga("send","event",e,t,o)}catch(o){App._log('_track("'+e+'","'+t+'") failed')}},getDistance:function(e,t,o,n){var a=.017453292519943295,i=Math.cos;e*=a,t*=a,o*=a,n*=a;var r=12742,s=o-e,c=n-t,l=(1-i(s)+(1-i(c))*i(e)*i(o))/2;return r*Math.asin(Math.sqrt(l))},updateURLParameter:function(e,t,o){e=e.replace(location.hash,"");var n="",a=e.split("?"),r=a[0],s=a[1],c="";if(s)for(a=s.split("&"),i=0;i<a.length;i++)a[i].split("=")[0]!=t&&(n+=c+a[i],c="&");var l=c+""+t+"="+o;return r+"?"+n+l},removeURLParameter:function(e,t){var o,n=t.split("?")[0],a=[],i=t.indexOf("?")!==-1?t.split("?")[1]:"";if(""!==i){a=i.split("&");for(var r=a.length-1;r>=0;r-=1)o=a[r].split("=")[0],o===e&&a.splice(r,1);n=n+"?"+a.join("&")}return n},doLogin:function(){},doRegister:function(){},sendAgain:function(){var e=document.forms["send-form"],t=e.email.value,o=[];if(t.length<10||t.indexOf("@")<0)return o.push("帳號 (Email)"),alert("請輸入email"),0;var n=$("#send-form input[type=submit]").data("loading"),a=App._now();"undefined"!=typeof n&&n>a-3||$.post(e.action,$("#send-form").serialize(),function(t){$("#send-form .submit").fadeTo(0,1),0==t.success&&alert(t.msg),1==t.success&&(e.reset(),alert(t.msg))},"json")},verifycode:function(){var e=document.forms["verify-form"],t=e.email.value,o=[];(t.length<10||t.indexOf("@")<0)&&o.push("帳號 (Email)");var n=$("#verify-form input[type=submit]").data("loading"),a=App._now();"undefined"!=typeof n&&n>a-3||($("#verify-form input[type=submit]").fadeTo(200,.25).data("loading",App._now()),$.post(e.action,$("#verify-form").serialize(),function(t){$("#verify-form .submit").fadeTo(0,1),0==t.success&&alert(t.msg),1==t.success&&(e.reset(),App.auth.showPopSignIn3Dialog())},"json"))},printArticle:function(e){$.print(e)},shareArticle:function(e){},fbShare:function(e,t){window.open("/api/fbshare/?type="+e+"&uri="+t,"_blank","height=400, width=700, directories=0, location=0, menubar=0, resizable=0, scrollbars=0, status=0, titlebar=1, toolbar=0")},gpShare:function(e,t){window.open("/api/gpshare/?type="+e+"&uri="+t,"_blank","height=400, width=700, directories=0, location=0, menubar=0, resizable=0, scrollbars=0, status=0, titlebar=1, toolbar=0")},etu:{loadData:function(){var e=App.cache.get("etuViewItem"),t=App.cache.get("etuViewRank"),o=[];e.forEach(function(e){o.push(e.id)});var n=t.filter(function(e){return-1==o.indexOf(e.id)}),a=Math.min(e.length,8);if(a>0)for(var i=0;i<a;i++){if(i<4)var r=$("#relatedArticleBox #etu-recommender-extend li.etuitem a.etu-target").eq(i),s=$("#relatedArticleBox #etu-recommender-extend .articlesharewrapper").eq(i);else var r=$("#relatedArticleBox2 #etu-recommender-extend li.etuitem a.etu-target").eq(i-5),s=$("#relatedArticleBox2 #etu-recommender-extend .articlesharewrapper").eq(i-5);r.parent().find("a.channelTitle").attr("href",e[i].cate_url).text(e[i].category_1_name),r.attr("href",e[i].target_url),r.find(".caption h3").text(e[i].web_title),r.find(".pic img").attr("src",e[i].photo).attr("alt",e[i].web_title),s.find("a.bookmark").attr("data-link",r.attr("href")),s.find("a.fbshare").attr("data-url",r.attr("href")),s.find("a.lineshare").attr("href","line://msg/text/"+r.attr("href"))}var a=Math.min(n.length,8);if(a>0)for(var i=0;i<a;i++){if(i<4)var r=$("#r_viewRankBox #etu-recommender-rank li.etuitem a.etu-target").eq(i),s=$("#r_viewRankBox #etu-recommender-rank .articlesharewrapper").eq(i);else var r=$("#r_viewRankBox2 #etu-recommender-rank li.etuitem a.etu-target").eq(i-5),s=$("#r_viewRankBox2 #etu-recommender-rank .articlesharewrapper").eq(i-5);r.parent().parent().find("a.channelTitle").attr("href",n[i].cate_url).text(n[i].category_1_name),r.attr("href",n[i].target_url),r.find(".caption h3").text(n[i].web_title),r.find(".pic img").attr("src",n[i].photo).attr("alt",n[i].web_title),s.find("a.bookmark").attr("data-link",r.attr("href")),s.find("a.fbshare").attr("data-url",r.attr("href")),s.find("a.lineshare").attr("href","line://msg/text/"+r.attr("href"))}}}};App.cache={get:function(e){var t=App.conf.cache_root;return null!=localStorage.getItem(t+e)?JSON.parse(localStorage.getItem(t+e)):null},set:function(e,t){localStorage.setItem(App.conf.cache_root+e,JSON.stringify(t))},del:function(e){localStorage.removeItem(App.conf.cache_root+e)}};var docw=document.write;$(function(){App.init(),initParentCommentPOImg(),$(".askBox").on("click",".t_spam",function(){0==isLoggedIn?(alert("請先登入"),App.auth.showLoginDialog("hash=backDealWrap")):$.post("/ask/spam",{id:$(this).data("id"),spam_res:"手機檢舉"},function(e){1==e.success&&alert("資料已經送出！")},"json")}),$(".a_discussBox").on("click",".t_spam",function(){0==isLoggedIn?(alert("請先登入"),App.auth.showLoginDialog("hash=backDealWrap")):$.post("/api/comment-spam",{id:$(this).data("id"),spam_res:"手機檢舉"},function(e){1==e.success&&alert("資料已經送出！")},"json")}),$(".a_discussBox").on("click",".t_like",function(){if(0==isLoggedIn)alert("請先登入"),App.auth.showLoginDialog("hash=backDealWrap");else{var e=$(this).data("id"),t=$(this).parent().find(".like_count");$.post("/comment/like",{id:e},function(e){1==e.success?e.like_count&&$(t).text(e.like_count):alert(e.msg)},"json")}}),$(".a_discussBox").on("submit",".replyForm",function(e){e.preventDefault()}),$(".a_discussBox").on("click",".t_reply",function(){if(0==isLoggedIn)alert("請先登入"),App.auth.showLoginDialog("hash=backDealWrap");else{var e=($(this).data("id"),$(this).parents(".talkItem").find(".reply"));$(e).removeClass("hide")}}),$(".a_discussBox").on("click",".btnReply",function(){if(0==isLoggedIn)alert("請先登入"),App.auth.showLoginDialog("hash=backDealWrap");else{var e=$(this).parents(".reply"),t=$(e).find(".textReply").data("id"),o=$(e).find(".textReply").val(),n=$(e).find(".textReply").data("type_no");$(e).addClass("hide"),$.post("/comment/reply",{id:t,textReply:o,type_no:n},function(t){1==t.success?($(e).find(".textReply").val(""),$(e).parents(".talkItem").find(".replyWrap").append(t.html)):alert(t.msg)},"json")}}),$("div.ad_banner").each(function(e,t){var o=$(this),n=this;document.write=function(e){n.innerHTML=e};var a=o.data("tid"),i=o.data("ip"),r=o.data("cid"),s=o.data("keywords");""!=r&&(r=parseFloat("0"+r));var c=location.href;c.indexOf("CP/community/")!=-1&&(cId="community");var l="SetAdvert('"+a+"', '"+i+"','"+r+"','"+s+"');document.write=docw;",u=document.createElement("script");u.text=l});var e=GetCookie("cpfancybox");null!=e&&""!=e||$("#pop_ad_content").size()>0&&(createCookie("cpfancybox","1",1),$.colorbox({inline:!0,href:"#pop_ad_content",width:"290px",height:"450px",opacity:.6,transition:"none"})),bookPrmoteModule.init()});var bookPrmoteModule={data:{cookieNotShowPromote:{key:"bpmcnsp",value:"1"},cookieShowTimes:{key:"bpmcst"},showCountLimit:3},init:function(){return!!this.isShow()&&($(".floatwrap").show(),$(".floatwrap .close").click(function(){bookPrmoteModule.close()}),showCount=this.countShowTimes(),void(showCount>=this.data.showCountLimit&&this.setNotShowCookie()))},close:function(){$(".floatwrap").slideToggle(),this.setNotShowCookie()},setNotShowCookie:function(){setCookie(this.data.cookieNotShowPromote.key,this.data.cookieNotShowPromote.value,this.getCookieExpre())},countShowTimes:function(){var e=this.data.cookieShowTimes.key,t=null==GetCookie(e)?0:GetCookie(e);return t++,setCookie(this.data.cookieShowTimes.key,t,this.getCookieExpre()),t},isShow:function(){var e=GetCookie(this.data.cookieNotShowPromote.key);return null==e||e!=this.data.cookieNotShowPromote.value},getCookieExpre:function(){var e=new Date(bookPrmoteModule.getTodayDate()+" 23:59:59");return e},getTodayDate:function(){var e=new Date;return this.getDate(e)},getDate:function(e){return[e.getFullYear(),e.getMonth()+1,e.getDate()].join("-")}};$(document).bind("cbox_complete",function(){$("#pop_ad_content").removeClass("hide")}),$(document).bind("cbox_cleanup",function(){$("#pop_ad_content").addClass("hide")});var ParentCommentPOImgCount=4;