(function($,undefined){$.widget("mobile.movetool",$.mobile.widget,{options:{html_tag:'<div id="xmui-go2Top">',go2top:null,pages:null,timer:null},_create:function(){var that=this,options=that.options;options.device=navigator.userAgent.match(/Android/i);$(document).one("pagebeforeshow",options.pages.view,function(e){if($(e.target).is(options.pages.view)){options.go2top=$(options.html_tag);$("body").prepend(options.go2top);$(document).on("pageshow",function(){that.move()})}else{!!options.go2top&&options.go2top.hide()}})},move:function(){var that=this,options=that.options;var $topEle=options.go2top;var baseLineTop=$.mobile.getScreenHeight()||screen.availHeight;$topEle.on("click",function(){$.xuite.silentScroll()});$(document).on("scroll",function(e){clearTimeout(options.timer);options.timer=setTimeout(function(){var isOverThreshold=$(e.target).scrollTop()>(baseLineTop*2);if(!isOverThreshold&&!$topEle.is(":hidden")){$topEle.hide()}if(isOverThreshold&&$topEle.is(":hidden")){$topEle.fadeIn()}},500)})},});$(document).one("pagecreate",function(e){var pageShowSetting={view:"#blog-show, #vlog-show, #yo-viewspotDetail, #yo-trip, #myhome, #xuite-search"};$(document).movetool({pages:pageShowSetting})})})(jQuery);(function($,undefined){$(document).one("pageinit",function(e){$.xuite.navlist={};$.xuite.navlist.elements={};$.xuite.navlist.elements.multiLogin=$("#xmui-navlist-multi-login");var $f_g_page=null;var $f_g_activePage=null;var $blackcover=$("#xmui-navlist-blackcover");var $multiLoginPanel=$("#xmui-navlist-multilogin");var scrollParameter={y:(sessionStorage.navlistScrollY)?parseInt(sessionStorage.navlistScrollY,10):0,useTransition:true,click:false};var idName="#xmui-navmenu";var $navlist=$("#navlist");var iscrollObj=new IScroll("#navlist",scrollParameter);$("#navmenu").on("panelopen",function(event,ui){iscrollObj.refresh();iscrollObj.options.click=true;var $dismiss=$(".ui-panel-dismiss");$dismiss.addClass("expand");$('<img width="0" height="0" border="0" src="http://vatrack.hinet.net/i/m_list">')}).on("panelclose",function(event,ui){iscrollObj.options.click=false;var $dismiss=$(".ui-panel-dismiss");$dismiss.removeClass("expand")});(function(){var link={element:null,timer:null};var startX=0,startY=0,isTouchmove=false;$("#navmenu").on("touchstart touchmove touchend","ul li:not([data-link='']):not(.outside)",function(e){var evt=e.originalEvent;var touchX=(evt.changedTouches)?evt.changedTouches[0].pageX:evt.pageX;var touchY=(evt.changedTouches)?evt.changedTouches[0].pageY:evt.pageY;switch(e.type){case"touchstart":if(!$(this).is(link.element)&&!!link.element){link.element.css("background-color","");clearTimeout(link.timer)}link.element=$(this);link.element.css("background-color","#333");startX=touchX;startY=touchY;isTouchmove=false;break;case"touchmove":if(((startX-10)<touchX)&&((startX+10)>touchX)&&((startY-10)<touchY)&&((startY+10)>touchY)){break}startX=0;startY=0;isTouchmove=true;link.element.css("background-color","");clearTimeout(link.timer);break;case"touchend":if(!isTouchmove){var url=link.element.data("link");if(!!url){link.timer=setTimeout(function(){$("#navmenu").panel("close");link.element.css("background-color","");if(!$.mobile.path.isFirstPageUrl(url)){setTimeout(function(){location.href=url},100)}},500)}else{link.element.css("background-color","")}startX=0;startY=0}break}}).on("click","#navlistXuiteSearch",function(){$("#navmenu").panel("close");var $link=$(this);var urlLink=$link.data("link");$("#navmenu").one("panelclose",function(event,ui){if($link.is("#navlistXuiteSearch")){if($.mobile.path.isAbsoluteUrl(urlLink)){location.href=urlLink}else{$.mobile.changePage($(urlLink))}return}})})})()})})(jQuery);(function($,undefined){$.widget("mobile.sharebox",$.mobile.widget,{options:{shareParam:{facebook:{link:"http://www.facebook.com/sharer.php?u="},plurk:{link:"http://www.plurk.com/m?qualifier=shares&content="},line:{link:"http://line.naver.jp/R/msg/text/?"}},pages:null,},_create:function(){var that=this,options=that.options;this.bindEvent();this.shareBtnTouch()},bindEvent:function(){var that=this,options=that.options;$(document).on("click",".xmui-sharebox-inside-ctrl",function(e){$("#photoshow-sharebox-nav").show();$(".photoshow-sharebar-content").scrollTop(0);$(".ui-panel-dismiss").addClass("ui-panel-dismiss-display-push ui-panel-dismiss-open expand");options.shareUrl=$.mobile.activePage.data("shareurl")||$(".pc-url",$.mobile.activePage).data("share-url")});$(document).on("pagebeforeshow",function(){$(".ui-panel-dismiss").on("click",function(){$("#photoshow-sharebox-nav").hide();$(this).removeClass("ui-panel-dismiss-display-push ui-panel-dismiss-open expand")}).on("touchmove",function(){return false});$(".ui-popup-screen, .ui-popup-container").on("touchmove",function(){return false});$("#qrcode",$.mobile.activePage).error(function(){$("#popupqr",$.mobile.activePage).popup("open");alert("無法產生 QR Code")})})},shareBtnTouch:function(){var that=this,options=that.options;var startX=0,startY=0,isTouchmove=false;function shareWork(shareSite,shareUrl){var chl="photo";var link="http://redir.xuite.net/redir/xuite/mobile/"+chl+"/sharebox/"+shareSite+"^http://m.xuite.net?";$('<img src="'+link+(new Date()).getTime()+'">');switch(shareSite){case"qr":var qr_base_url="https://chart.googleapis.com/chart?cht=qr&chs=300x300&chld=H|0&chl=";var $qrcode=$("#qrcode",$.mobile.activePage);$qrcode.attr("src",qr_base_url+encodeURIComponent(shareUrl));$("#popupqr",$.mobile.activePage).popup("open");break;case"sms":var sms="sms:";var content=$.mobile.activePage.data("subtitle")+" "+encodeURIComponent(shareUrl)+" [Xuite隨意窩]";if(navigator.userAgent.match(/iphone os [7|8|9|10]_/i)){setTimeout(function(){if(window.prompt("是否將內容以簡訊分享？\n（請先複製內容）",$.mobile.activePage.data("subtitle")+" "+shareUrl+" [Xuite隨意窩]")){window.location=sms}},100);return}else{if(navigator.userAgent.match(/iphone/i)){sms=sms+";body="}else{sms=sms+"?body="}}setTimeout(function(){window.location=sms+content;return},500);break;case"email":var mailSubject=encodeURIComponent($.mobile.activePage.data("subtitle")+" [Xuite隨意窩]");var mailBody=encodeURIComponent($.mobile.activePage.data("subtitle")+"\n"+shareUrl);var mailUrl="mailto:?subject="+mailSubject+"&body="+mailBody;window.location.href=mailUrl;break;default:break}}$("#photoshow-sharebox-nav").on("click",".photoshow-sharebar-box",function(e){var shareUrl=$.mobile.activePage.data("shareurl"),shareSite=$(e.currentTarget).data("target");setTimeout(function(){$("#photoshow-sharebox-nav").hide();$(".ui-panel-dismiss").removeClass("ui-panel-dismiss-display-push ui-panel-dismiss-open expand");if(["facebook","plurk","line","shortener","sms"].indexOf(shareSite)<0){setTimeout(function(){shareWork(shareSite,shareUrl)},200)}},500);if(shareSite==="sms"){shareWork(shareSite,shareUrl)}if(shareSite==="shortener"){$.getJSON("http://webhd.xuite.net/_api/@shorturl_add?url="+encodeURIComponent(shareUrl)+"&callback=?",function(data){$.mobile.loading("hide");if(data.ok===true){setTimeout(function(){window.prompt("已產生短網址，請自行複製分享",data.rsp)},250);return}alert("短網址產生失敗！！")})}if(["facebook","plurk","line"].indexOf(shareSite)>=0){var eUrl="%0D%0A"+encodeURIComponent(shareUrl);var openUrl=options.shareParam[shareSite].link+encodeURIComponent($.mobile.activePage.data("subtitle"));if(shareSite==="line"||shareSite==="plurk"){openUrl=openUrl+"%20"+eUrl+encodeURIComponent(" [Xuite隨意窩]");location.href=openUrl;return false}else{openUrl=options.shareParam[shareSite].link+eUrl}window.open(openUrl);return false}})},});$(document).one("pagecreate",".photo-show",function(e){$(document).sharebox()});$(document).on("pagebeforeshow","#blog-show, #photo-photos, #vlog-show, #yo-viewspotDetail, #yo-trip",function(e){$(".xmui-sharelink-shortener, .xmui-sharelink-mail, .xmui-sharelink-sms, .xmui-sharelink-qr").on("click",function(e){var shareSite=e.target.id;var chl=(function(){var channels=[".net/blog",".net/photo",".net/vlog",".net/m/"];var values=["blog","photos","vlog","yo"];for(var i=0;i<channels.length;i++){if($.mobile.navigate.history.getActive().url.indexOf(channels[i])>0){return values[i]}}})();var link="http://redir.xuite.net/redir/xuite/mobile/"+chl+"/sharebox/"+shareSite+"^http://m.xuite.net?";$('<img src="'+link+(new Date()).getTime()+'">')});shareUrl=$.mobile.activePage.data("shareurl")||$(".pc-url",$.mobile.activePage).data("share-url");$(".xmui-sharelink-shortener").on("click",function(){$.getJSON("http://webhd.xuite.net/_api/@shorturl_add?url="+encodeURIComponent(shareUrl)+"&callback=?",function(data){$.mobile.loading("hide");if(data.ok===true){setTimeout(function(){window.prompt("已產生短網址，請自行複製分享",data.rsp)},250);return}alert("短網址產生失敗！！")});return});$(".xmui-sharelink-mail").on("click",function(){var mailSubject=encodeURIComponent($.mobile.activePage.data("subtitle")+" [Xuite隨意窩]");var mailBody=encodeURIComponent($.mobile.activePage.data("subtitle")+"\n"+shareUrl);var mailUrl="mailto:?subject="+mailSubject+"&body="+mailBody;window.location.href=mailUrl});$(".xmui-sharelink-sms").on("click",function(){var sms="sms:";var content=$.mobile.activePage.data("subtitle")+" "+encodeURIComponent(shareUrl)+" [Xuite隨意窩]";if(navigator.userAgent.match(/iphone os [7|8|9|10]_/i)){setTimeout(function(){if(window.prompt("是否將內容以簡訊分享？\n（請先複製內容）",$.mobile.activePage.data("subtitle")+" "+shareUrl+" [Xuite隨意窩]")){window.location=sms}},100);return}else{if(navigator.userAgent.match(/iphone/i)){sms=sms+";body="}else{sms=sms+"?body="}}window.location=sms+content;return})})})(jQuery);